var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},__extends=function(t,e){function n(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},__assign=Object.assign||function(t){for(var e,n=1,r=arguments.length;r>n;n++){e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},__rest=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,r=Object.getOwnPropertySymbols(t);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(t,r[i])&&(n[r[i]]=t[r[i]]);return n},__decorate=function(t,e,n,r){var i,a=arguments.length,o=3>a?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(o=(3>a?i(o):a>3?i(e,n,o):i(e,n))||o);return a>3&&o&&Object.defineProperty(e,n,o),o},__param=function(t,e){return function(n,r){e(n,r,t)}},__metadata=function(t,e){return"object"==typeof Reflect&&"function"==typeof Reflect.metadata?Reflect.metadata(t,e):void 0},__awaiter=function(t,e,n,r){function i(t){return t instanceof n?t:new n(function(e){e(t)})}return new(n||(n=Promise))(function(n,a){function o(t){try{l(r.next(t))}catch(e){a(e)}}function s(t){try{l(r["throw"](t))}catch(e){a(e)}}function l(t){t.done?n(t.value):i(t.value).then(o,s)}l((r=r.apply(t,e||[])).next())})},__generator=function(t,e){function n(t){return function(e){return r([t,e])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;l;)try{if(i=1,a&&(o=2&n[0]?a["return"]:n[0]?a["throw"]||((o=a["return"])&&o.call(a),0):a.next)&&!(o=o.call(a,n[1])).done)return o;switch(a=0,o&&(n=[2&n[0],o.value]),n[0]){case 0:case 1:o=n;break;case 4:return l.label++,{value:n[1],done:!1};case 5:l.label++,a=n[1],n=[0];continue;case 7:n=l.ops.pop(),l.trys.pop();continue;default:if(o=l.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){l=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){l.label=n[1];break}if(6===n[0]&&l.label<o[1]){l.label=o[1],o=n;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(n);break}o[2]&&l.ops.pop(),l.trys.pop();continue}n=e.call(t,l)}catch(r){n=[6,r],a=0}finally{i=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,a,o,s,l={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},__exportStar=function(t,e){for(var n in t)"default"===n||e.hasOwnProperty(n)||__createBinding(e,t,n)},__createBinding=Object.create?function(t,e,n,r){void 0===r&&(r=n),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[n]}})}:function(t,e,n,r){void 0===r&&(r=n),t[r]=e[n]},__values=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},__read=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,a=n.call(t),o=[];try{for(;(void 0===e||e-->0)&&!(r=a.next()).done;)o.push(r.value)}catch(s){i={error:s}}finally{try{r&&!r.done&&(n=a["return"])&&n.call(a)}finally{if(i)throw i.error}}return o},__spread=function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(__read(arguments[e]));return t},__spreadArrays=function(){for(var t=0,e=0,n=arguments.length;n>e;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;n>e;e++)for(var a=arguments[e],o=0,s=a.length;s>o;o++,i++)r[i]=a[o];return r},__await=function(t){return this instanceof __await?(this.v=t,this):new __await(t)},__asyncGenerator=function(t,e,n){function r(t){u[t]&&(c[t]=function(e){return new Promise(function(n,r){h.push([t,e,n,r])>1||i(t,e)})})}function i(t,e){try{a(u[t](e))}catch(n){l(h[0][3],n)}}function a(t){t.value instanceof __await?Promise.resolve(t.value.v).then(o,s):l(h[0][2],t)}function o(t){i("next",t)}function s(t){i("throw",t)}function l(t,e){t(e),h.shift(),h.length&&i(h[0][0],h[0][1])}if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var c,u=n.apply(t,e||[]),h=[];return c={},r("next"),r("throw"),r("return"),c[Symbol.asyncIterator]=function(){return this},c},__asyncDelegator=function(t){function e(e,i){n[e]=t[e]?function(n){return(r=!r)?{value:__await(t[e](n)),done:"return"===e}:i?i(n):n}:i}var n,r;return n={},e("next"),e("throw",function(t){throw t}),e("return"),n[Symbol.iterator]=function(){return this},n},__asyncValues=function(t){function e(e){r[e]=t[e]&&function(r){return new Promise(function(i,a){r=t[e](r),n(i,a,r.done,r.value)})}}function n(t,e,n,r){Promise.resolve(r).then(function(e){t({value:e,done:n})},e)}if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=t[Symbol.asyncIterator];return i?i.call(t):(t="function"==typeof __values?__values(t):t[Symbol.iterator](),r={},e("next"),e("throw"),e("return"),r[Symbol.asyncIterator]=function(){return this},r)},__makeTemplateObject=function(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t},__setModuleDefault=Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t["default"]=e},__importStar=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&__createBinding(e,t,n);return __setModuleDefault(e,t),e},__importDefault=function(t){return t&&t.__esModule?t:{"default":t}},__classPrivateFieldGet=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)},__classPrivateFieldSet=function(t,e,n){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,n),n},__reflect=function(t,e,n){t.__class__=e,n?n.push(e):n=[e],t.__types__=t.__types__?n.concat(t.__types__):n};!function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var n={};return e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:r})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(e.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var i in t)e.d(r,i,function(e){return t[e]}.bind(null,i));return r},e.n=function(t){var n=t&&t.__esModule?function(){return t["default"]}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(t,e,n){n(1),n(2),n(3),n(4),n(5),n(6),n(7),n(8),n(9),n(10),n(11),n(12),n(13),n(14),n(15),n(16),n(17),n(18),n(19),n(20),n(21),n(22),n(23),n(24),n(25),n(26),n(27),n(28),n(29),n(30),n(31),n(32),n(33),n(34),n(35),n(36),n(37),n(38),n(39),n(40),n(41),n(42),n(43),n(44),n(45),n(46),n(47),n(48),n(49),n(50),n(51),n(52),n(53),n(54),n(55),n(56),n(57),n(58),n(59),n(60),n(61),n(62),n(63),n(64),n(65),n(66),n(67);var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return t=Util.createColorBG(this.stage.stageWidth,this.stage.stageHeight),this.stage.addChild(t),[4,this.loadResource()];case 1:return e.sent(),GameRoot.Ins.init(this.stage),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,4,,5]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return n.sent(),[4,this.loadTheme()];case 2:return n.sent(),[4,RES.loadGroup("preload",0,t)];case 3:return n.sent(),this.stage.removeChild(t),[3,5];case 4:return e=n.sent(),console.error(e),[3,5];case 5:return[2]}})})},e.prototype.loadTheme=function(){var t=this;return new Promise(function(e,n){var r=new eui.Theme("resource/default.thm.json",t.stage);r.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})},e}(eui.UILayer);window.Main=r,__reflect(r.prototype,"Main",[])},function(t,e){var n=function(){function t(){}return t.prototype.getAsset=function(t,e,n){function r(r){e.call(n,r,t)}if(RES.hasRes(t)){var i=RES.getRes(t);i?r(i):RES.getResAsync(t,r,this)}else RES.getResByUrl(t,r,this,RES.ResourceItem.TYPE_IMAGE)},t}();window.AssetAdapter=n,__reflect(n.prototype,"AssetAdapter",["eui.IAssetAdapter"])},function(t,e){var n="https://1062258897406555.cn-shanghai.fc.aliyuncs.com/2016-08-15/proxy/python_serve/simple_verify/";window.VERIFYURL=n},function(t,e){var n=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();window.DebugPlatform=n,__reflect(n.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new n)},function(t,e){var n=function(){function t(){}return t.prototype.getTheme=function(t,e,n,r){function i(t){e.call(r,t)}function a(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),n.call(r))}var o=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){e.call(r,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(t,n){window.JSONParseClass.setData(t),egret.callLater(function(){e.call(r,generateEUI2)},o)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(t.indexOf(".exml")>-1){var s=t.split("/");s.pop();var l=s.join("/")+"_EUI.json";generateJSON.paths[t]?egret.callLater(function(){e.call(r,generateJSON.paths[t])},this):RES.getResByUrl(l,function(n){window.JSONParseClass.setData(n),egret.callLater(function(){e.call(r,generateJSON.paths[t])},o)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){e.call(r,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),RES.getResByUrl(t,i,this,RES.ResourceItem.TYPE_TEXT)},t}();window.ThemeAdapter=n,__reflect(n.prototype,"ThemeAdapter",["eui.IThemeAdapter"])},function(t,e){var n=function(t){function e(){var e=t.call(this)||this;return e._progressLabel=new eui.Label,e._progressLabel.horizontalCenter=0,e._progressLabel.verticalCenter=0,e._progressLabel.textColor=ColorDef.Coral,e.addChild(e._progressLabel),e}return __extends(e,t),e.prototype.initial=function(){var t=Util.createColorBG(GameRoot.GameStage.stageWidth,GameRoot.GameStage.stageHeight);this.addChildAt(t,0)},e.prototype.clear=function(){this._progressLabel.text="Loading..."},e.prototype.onProgress=function(t,e){this._progressLabel.text="Loading..."+t+"/"+e},e}(eui.UILayer);window.LoadingUI=n,__reflect(n.prototype,"LoadingUI",["RES.PromiseTaskReporter"])},function(t,e){var n=function(t){function e(){var e=t.call(this)||this;return e.width=GameRoot.StageWidth,e.height=GameRoot.StageHeight,e.addEventListener(eui.UIEvent.COMPLETE,e.mainUIEventInit,e),e}return __extends(e,t),e.prototype.mainUIEventInit=function(){this.l1StartButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.tol1,this),this.l2StartButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.tol2,this)},e.prototype.tol1=function(){SceneManager.Ins.setScene(new L1MainScene)},e.prototype.tol2=function(){SceneManager.Ins.setScene(new L2MainScene)},e}(eui.Component);window.MainUI=n,__reflect(n.prototype,"MainUI",[])},function(t,e){var n=function(t){function e(){var e=t.call(this)||this;return e.width=GameRoot.StageWidth,e.height=GameRoot.StageHeight,e.addEventListener(eui.UIEvent.COMPLETE,e.panelEventInit,e),e}return __extends(e,t),e.prototype.panelEventInit=function(){this.confirmButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.confirmPswd,this),this.clearLocalButton.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){UserData.clearLocalData()},this)},e.prototype.debugTap=function(){SceneManager.Ins.setScene(new L2MainScene)},e.prototype.confirmPswd=function(t){return 0==this.pswdTextInput.text.length?void alert("验证失败"):(this.confirmButton.enabled=!1,void Util.httpGet(VERIFYURL+this.pswdTextInput.text.substring(0,10),this.onGetComplete,this.onGetIOError,this.onGetProgress,this))},e.prototype.onGetComplete=function(t){var e=t.currentTarget,n=e.response.substring(0,1);return"y"!=n?(alert("验证失败"),void(this.confirmButton.enabled=!0)):(ToastInfoManager.newRedToast("验证成功"),void setTimeout(function(){SceneManager.Ins.setScene(new MainScene)},1e3))},e.prototype.onGetIOError=function(t){alert("网络错误"),this.confirmButton.enabled=!0},e.prototype.onGetProgress=function(t){},e}(eui.Component);window.StartPanel=n,__reflect(n.prototype,"StartPanel",[])},function(t,e){var n=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(eui.UIEvent.COMPLETE,e.UIEventInit,e),e}return __extends(e,t),e.prototype.UIEventInit=function(){var t=this;this.bgRect.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.visible=!1,t.curChar=null},this),MessageManager.Ins.addEventListener(MessageType.L1BATTLECHARTAP,this.charTap,this),MessageManager.Ins.addEventListener(MessageType.L1TOUCHLABELTAP,this.touchLabelTap,this)},e.prototype.charTap=function(t){var e=t.messageContent;this.curChar=e,this.visible=!0,this.charNameLabel.text=e.name,this.maxHpLabel.text=""+e.maxHp,this.hpRateRect.percentWidth=e.curHp/e.maxHp*100,this.atkNumLabel.text=""+e.atk,this.defNumLabel.text=""+e.def,this.dodgeLabel.text=""+e.dodgePoint,this.critPLabel.text=""+e.critPoint,this.critRLabel.text=""+e.critTime,this.rangeLabel.text=""+e.rawAttr.range,this._skillTouchLabel=[];for(var n in e.skills){var r=e.skills[n],i=new L1TouchLabel(r,e,null,0);i.x=120*parseInt(n)+5,this.skillScrollerGroup.addChild(i),this._skillTouchLabel.push(i)}for(var a={},o=0,s=e.buffs.data;o<s.length;o++){var l=s[o],c=l.config.id;c in a?a[c][1]+=1:""!=l.config.name&&(a[c]=[l.config,1])}var u=0;for(var c in a){var h=a[c],f=h[0],p=h[1],i=new L1TouchLabel(null,null,f,p);i.x=120*u+5,this.buffScrollerGroup.addChild(i),u+=1}this.descrGroup.visible=!1},e.prototype.touchLabelTap=function(t){var e=t.messageContent;this.descrGroup.visible=!0;var n=e.info[0],r=e.info[2],i="";n&&(i=n.config.descr),r&&(i=r.descr),this.descrLabel.text=i},e.prototype.update=function(){if(this.curChar){var t=this.curChar;this.maxHpLabel.text=""+t.maxHp,this.hpRateRect.percentWidth=t.curHp/t.maxHp*100,this.angerRateRect.percentWidth=t.curAnger/L1CharAttr.MAXANGER*100,this.atkNumLabel.text=""+t.atk,this.defNumLabel.text=""+t.def,this.dodgeLabel.text=""+t.dodgePoint,this.critPLabel.text=""+t.critPoint,this.critRLabel.text=""+t.critTime;for(var e=0,n=this._skillTouchLabel;e<n.length;e++){var r=n[e];r.updateSkillCd()}}},e}(eui.Component);window.L1BattleInfo=n,__reflect(n.prototype,"L1BattleInfo",[])},function(t,e){var n=function(t){function e(){var e=t.call(this)||this;return e.width=GameRoot.GameStage.stageWidth,e.height=GameRoot.GameStage.stageHeight,e.addEventListener(eui.UIEvent.COMPLETE,e.UIEventInit,e),e._selectIds=[],e}return __extends(e,t),e.prototype.update=function(){this.charBattleInfo.update()},e.prototype.battleEnd=function(t){t||(this.nextLevelButton.label="Retry"),this.nextLevelButton.visible=!0},e.prototype.UIEventInit=function(){this.backButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.backToL1MainScene,this),this.battleStartButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.battleStart,this),this.nextLevelButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.toNextLevel,this),MessageManager.Ins.addEventListener(MessageType.L1BATTLEUIPORTTAP,this.portTap,this);for(var t=0;t<UserData.l1Data.UserAllCharIds.length;t++){var e=UserData.l1Data.UserAllCharIds[t],n=new L1BattleUIPort(e);n.x=90*t,this.portImageGroup.addChild(n),UserData.l1Data.UserUseCharIds.indexOf(e)>=0&&(n.select(),this._selectIds.push(n.charId))}UserData.l1Data.levelType==L1LevelType.MainStory&&(this.mainStoryLevelName.visible=!0,this.mainStoryLevelName.text=UserData.l1Data.CurMainStoryId+1+"关")},e.prototype.toNextLevel=function(){SceneManager.Ins.setScene(new L1NormalBattleScene)},e.prototype.portTap=function(t){var e=t.messageContent,n=e.charId,r=SceneManager.Ins.curScene;return e.IsSelect?(e.selectCancle(),Util.removeObjFromArray(this._selectIds,e.charId),void r.removeChar(n)):4==this._selectIds.length?void ToastInfoManager.newRedToast("已满员"):(e.select(),this._selectIds.push(e.charId),void r.addChar(n))},e.prototype.backToL1MainScene=function(){SceneManager.Ins.setScene(new L1MainScene)},e.prototype.battleStart=function(){return 0==this._selectIds.length?void ToastInfoManager.newRedToast("无上场成员"):(UserData.l1Data.UserUseCharIds=this._selectIds,this.battleStartButton.visible=!1,SceneManager.Ins.curScene.battleStart(),void(this.portScroller.visible=!1))},e}(eui.Component);window.L1BattleSceneUI=n,__reflect(n.prototype,"L1BattleSceneUI",[])},function(t,e){var n=function(t){function e(e){var n=t.call(this)||this;n.charId=e;var r=L1Config.Ins.L1CHARCFGS[e],i=r.portImageName,a=new eui.Image(i);a.width=120,a.height=120;var o=new eui.Rect(80,80);o.ellipseHeight=80,o.ellipseWidth=80,o.y=20,o.x=20,a.mask=o;var s=new eui.Rect(80,80);s.ellipseHeight=80,s.ellipseWidth=80,s.y=20,s.x=20,n._selectMask=s,s.fillColor=ColorDef.DimGray,s.alpha=.5;var l=new eui.Label;return l.text="上场",l.y=50,l.x=30,n._selectLable=l,n.addChild(a),n.addChild(o),n.addChild(s),n.addChild(l),n.selectCancle(),n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.touchTap,n),n}return __extends(e,t),Object.defineProperty(e.prototype,"IsSelect",{get:function(){return this._isSelect},enumerable:!1,configurable:!0}),e.prototype.touchTap=function(){MessageManager.Ins.sendMessage(MessageType.L1BATTLEUIPORTTAP,this)},e.prototype.select=function(){this._isSelect=!0,this._selectMask.visible=!0,this._selectLable.visible=!0},e.prototype.selectCancle=function(){this._isSelect=!1,this._selectMask.visible=!1,this._selectLable.visible=!1},e}(eui.Group);window.L1BattleUIPort=n,__reflect(n.prototype,"L1BattleUIPort",[])},function(t,e){var n=function(t){function e(){var e=t.call(this)||this;return e.width=GameRoot.GameStage.stageWidth,e.height=GameRoot.GameStage.stageHeight,e.addEventListener(eui.UIEvent.COMPLETE,e.UIEventInit,e),e}return __extends(e,t),e.prototype.UIEventInit=function(){this.backButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.backToMainScene,this),this.mainStoryButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.toL1BattleScene,this),this.roughlikeButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.toL1RoughlikeScene,this)},e.prototype.backToMainScene=function(){SceneManager.Ins.setScene(new MainScene)},e.prototype.toL1BattleScene=function(){UserData.l1Data.levelType=L1LevelType.MainStory,SceneManager.Ins.setScene(new L1NormalBattleScene)},e.prototype.toL1RoughlikeScene=function(){ToastInfoManager.newRedToast("敬请期待")},e}(eui.Component);window.L1MainUI=n,__reflect(n.prototype,"L1MainUI",[])},function(t,e){var n=function(t){function e(e,n,r,i){var a=t.call(this)||this;return a.info=[e,n,r,i],a.addEventListener(eui.UIEvent.COMPLETE,a.UIEventInit,a),a}return __extends(e,t),e.prototype.isCurSkill=function(){var t=this.info[1],e=this.info[0];return t.skills[t.curSkillIndex]==e},e.prototype.UIEventInit=function(){var t=this,e=this.info,n=e[0],r=(e[1],e[2]),i=e[3];if(n){this.nameLabel.text=n.config.name,this.skillCDLabel.visible=!0;var a=(n.config.cdMs/1e3).toFixed(2);this.skillCDLabel.text=a+"s"}r&&(this.nameLabel.text=r.name,this.buffTierLabel.visible=!0,this.buffTierLabel.text="x"+i),this.width=100,this.height=100,this.y=10,this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){MessageManager.Ins.sendMessage(MessageType.L1TOUCHLABELTAP,t)},this)},e.prototype.updateSkillCd=function(){var t=this.info[0];if(t){var e=t.CDRUN/GameRoot.GameStage.frameRate;if(0==e)this.skillCDLabel.visible=!1;else{this.skillCDLabel.visible=!0;var n=e.toFixed(2);this.skillCDLabel.text=n+"s"}this.cdRect.percentWidth=1e5*e/t.config.cdMs,this.isCurSkill()?this.skillPreStateLabel.visible=!0:this.skillPreStateLabel.visible=!1}},e}(eui.Component);window.L1TouchLabel=n,__reflect(n.prototype,"L1TouchLabel",[])},function(t,e){var n=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(eui.UIEvent.COMPLETE,e.UIEventInit,e),e}return __extends(e,t),e.prototype.UIEventInit=function(){var t=this;this.bgRect.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.visible=!1},this)},e.prototype.initial=function(){var t=SceneManager.Ins.curScene,e=t.focusChar;this.visible=!0,this.charNameLabel.text=e.name,this.maxHpLabel.text=""+e.attr.maxHp,this.hpRateRect.percentWidth=e.HP/e.attr.maxHp*100,this.atkNumLabel.text=""+e.attr.atk,this.defNumLabel.text=""+e.attr.def,this.actionSpeedLabel.text=""+e.attr.actionSpeed,this.moveRangeLabel.text=""+e.attr.moveRange,this.atkRangeLabel.text=""+e.attr.atkRange,this.descrGroup.visible=!1},e}(eui.Component);window.L2BattleInfo=n,__reflect(n.prototype,"L2BattleInfo",[])},function(t,e){var n=function(t){function e(){var e=t.call(this)||this;return e.fires=[],e.width=GameRoot.StageWidth,e.height=GameRoot.StageHeight,e.battleInfo=new L2BattleInfo,e.addChild(e.battleInfo),e.battleInfo.width=GameRoot.StageWidth,e.battleInfo.height=GameRoot.StageHeight,e.battleInfo.visible=!1,e.addEventListener(eui.UIEvent.COMPLETE,e.UIEventInit,e),e}return __extends(e,t),e.prototype.UIEventInit=function(){this.backButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.backToMainScene,this),this.timePointLabel.text="0",this.timePointLabel.textColor=ColorDef.DarkOrange,this.roundLabel.text="1",this.roundLabel.textColor=ColorDef.DarkOrange,this.commandModeLabel.visible=!1;for(var t=SceneManager.Ins.curScene,e=t.enemies.concat(t.players),n=0,r=e;n<r.length;n++){var i=r[n];this.timeBarGroup.addChild(i.timeBarPort),i.setTime(i.attr.startTime)}this.showInfoImage.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showInfo,this),this.commandButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.toCommandMod,this),this.waitButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.waitButtonTap,this)},e.prototype.showInfo=function(){this.battleInfo.initial()},e.prototype.toCommandMod=function(){SceneManager.Ins.curScene.status.toCommandMod()},e.prototype.waitButtonTap=function(){SceneManager.Ins.curScene.status.moveButtonTap()},e.prototype.removeFires=function(t){for(var e=0;t>e;e++)if(this.fires.length>0){var n=this.fires.pop();this.energyBarGroup.removeChild(n)}},e.prototype.addFires=function(t){for(var n=0;t>n;n++){var r=new egret.Shape;Util.drawCircle(r,9,ColorDef.DarkOrange),this.fires.push(r),this.energyBarGroup.addChild(r),r.x=e.fireDis*(this.fires.length-1)}},e.prototype.backToMainScene=function(){SceneManager.Ins.curScene.status.back()},e.prototype.release=function(){},e.fireDis=30,e}(eui.Component);window.L2MainUI=n,__reflect(n.prototype,"L2MainUI",[])},function(t,e){var n=function(t){function e(n,r){var i=t.call(this)||this;i["char"]=r,i.width=e.barPortWidth,i.height=i.width;var a=e.barPortWidth,o=new eui.Image(n);o.width=1.6*a,o.height=o.width;var s=(o.width-a)/2;return o.mask=new egret.Rectangle(s,s,a,a),i.addChild(o),o.x=-s,o.y=-s,i.charTimeLabel=new eui.Label,i.charTimeLabel.textColor=ColorDef.DarkRed,i.charTimeLabel.background=!0,i.charTimeLabel.backgroundColor=ColorDef.AntiqueWhite,i.charTimeLabel.textColor=r.camp==L2Camp.Player?ColorDef.LimeGreen:ColorDef.DarkRed,i.charTimeLabel.size=e.charTimeLabelSize,i.charTimeLabel.text="0",i.addChild(i.charTimeLabel),i.addEventListener(egret.TouchEvent.TOUCH_TAP,i.onTap,i),i}return __extends(e,t),e.prototype.onTap=function(){this.moveToTop(),MessageManager.Ins.sendMessage(MessageType.L2TIMEPORTTAP,this)},e.prototype.moveToTop=function(){this.parent.addChild(this)},e.prototype.setTime=function(t){var n=GameRoot.StageWidth-e.barWidthOffset;this.x=n*t/100,this.charTimeLabel.text=""+t},e.prototype.release=function(){this["char"]=null},e.charTimeLabelSize=18,e.barPortWidth=40,e.barWidthOffset=80,e}(eui.Group);window.L2TimeBarPort=n,__reflect(n.prototype,"L2TimeBarPort",[])},function(t,e){var n=function(){function t(){}return t.addOutGlowFilter=function(e){t.addFilter(e,t._outerGlowFilter)},t.removeOutGlowFilter=function(e){t.removeFilter(e,t._outerGlowFilter)},t.addGreyFilter=function(e){t.addFilter(e,t._greyColorFlilter)},t.removeGreyFilter=function(e){t.removeFilter(e,t._greyColorFlilter)},t.addYellowGlow=function(e){t.addFilter(e,t._outerGlowYellowFilter)},t.removeYellowGlow=function(e){t.removeFilter(e,t._outerGlowYellowFilter)},t.removeFilter=function(t,e){return t.filters?(Util.removeObjFromArray(t.filters,e)||console.log("object have no such filter"),void(0==t.filters.length&&(t.filters=null))):void console.log("没有发现滤镜，不应该有这个情况噢")},t.addFilter=function(t,e){t.filters?t.filters.push(e):t.filters=[e]},t._outerGlowFilter=new egret.GlowFilter(3394815,1,40,40,2,3,!1,!1),t._outerGlowYellowFilter=new egret.GlowFilter(15658496,1,40,40,2,3,!1,!1),t._greyColorFlilter=new egret.ColorMatrixFilter([.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0]),t}();window.L2Filters=n,__reflect(n.prototype,"L2Filters",[])},function(t,e){var n=function(){function t(){}return t.prototype.addFirst=function(t){},t.prototype.addLast=function(t){},t.prototype.remove=function(t){},t.prototype.popFirst=function(){return null},t.prototype.popLast=function(){return null},t.prototype.isContain=function(t){return!1},t.prototype.clear=function(){},t}();window.MyLinkedList=n,__reflect(n.prototype,"MyLinkedList",[]);var r=function(){function t(){}return t}();window.LinkedNode=r,__reflect(r.prototype,"LinkedNode",[])},function(t,e){var n=function(){function t(){this.data=[]}return t.prototype.add=function(t){var e=this.data;return e.indexOf(t)>=0?!1:(e.push(t),!0)},t.prototype.remove=function(t){return Util.removeObjFromArray(this.data,t)},t.prototype.removeAll=function(){this.data=[]},t.prototype.addList=function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];this.add(r)}},t}();window.MySet=n,__reflect(n.prototype,"MySet",[])},function(t,e){var n=function(){function t(){this._loadResouceLs=new MySet}return t.prototype.getResAsync=function(t,e,n){return this._loadResouceLs.add(t),null==e?RES.getResAsync(t):RES.getResAsync(t,e,n)},t.prototype.loadGroup=function(t,e,n){return this._loadResouceLs.add(t),RES.loadGroup(t,e,n)},t.prototype.getResAsyncAndSetValue=function(t,e,n){this.getResAsync(t,function(){n[e]=RES.getRes(t)},n)},t.prototype.releaseResource=function(){for(var t=0,e=this._loadResouceLs.data;t<e.length;t++){var n=e[t];RES.destroyRes(n)||console.warn("RES `"+n+"` destroy failed.")}},t}();window.ResAsyncLoader=n,__reflect(n.prototype,"ResAsyncLoader",[])},function(t,e){var n=function(){function t(){}return t.newToast=function(t,e,n,r,i,a,o,s,l,c,u){var h=this;void 0===e&&(e=ColorDef.DodgerBlue),void 0===n&&(n=60),void 0===r&&(r=0),void 0===i&&(i=-100),void 0===a&&(a=0),void 0===o&&(o=6e3),void 0===s&&(s=30),void 0===l&&(l=!0),void 0===c&&(c=egret.Ease.circOut),void 0===u&&(u=0);var f;f=this._labelPools.length>0?this._labelPools.pop():new eui.Label,f.textColor=e,f.horizontalCenter=r,f.y=n,f.alpha=1,f.size=s,f.text=t,f.bold=l,LayerManager.Ins.uiLayer.addChild(f),egret.Tween.get(f).to({},u).to({y:f.y+i,horizontalCenter:f.horizontalCenter+a,alpha:0},o,c).call(function(){LayerManager.Ins.uiLayer.removeChild(f),h._labelPools.push(f)})},t.newRedToast=function(e){t.newToast(e,ColorDef.Coral)},t._labelPools=[],t}();window.ToastInfoManager=n,__reflect(n.prototype,"ToastInfoManager",[])},function(t,e){var n=function(){function t(){}return t.removeObjFromArray=function(t,e){var n=t.indexOf(e);return n>=0?(t.splice(n,1),!0):!1},t.contains=function(t,e){return t.indexOf(e)>=0},t.createColorBG=function(t,e,n,r){void 0===n&&(n=ColorDef.DimGray),void 0===r&&(r=1);var i=new egret.Shape;return i.width=t,i.height=e,i.graphics.beginFill(n,r),i.graphics.drawRect(0,0,t,e),i.graphics.endFill(),i},t.safeRemoveFromParent=function(t){if(t){var e=t.parent;e&&e.removeChild(t)}},t.getRandomArray=function(t){for(var e=[],n=t.length;n>0;){var r=Math.floor(Math.random()*n);r==n&&(r-=1),e.push(t.splice(r,1)[0]),n-=1}return e},t.largeSmallTweenAnim=function(t,e,n,r){var i=t.x,a=t.y,o=t.width,s=t.height,l=o*e,c=s*n,u=i-(l-o)/2,h=a-(c-s)/2;egret.Tween.get(t,{loop:!0}).to({width:l,height:c,x:u,y:h},r).to({width:o,height:s,x:i,y:a},r)},t.httpGet=function(t,e,n,r,i){var a=new egret.HttpRequest;a.responseType=egret.HttpResponseType.TEXT,a.open(t,egret.HttpMethod.GET),a.send(),a.addEventListener(egret.Event.COMPLETE,e,i),a.addEventListener(egret.IOErrorEvent.IO_ERROR,n,i),a.addEventListener(egret.ProgressEvent.PROGRESS,r,i)},t.createBitmapByName=function(t){var e=new egret.Bitmap,n=RES.getRes(t);return e.texture=n,e},t.drawAngleCircle=function(t,e,n,i,a,o){void 0===i&&(i=0),void 0===a&&(a=ColorDef.DarkRed),void 0===o&&(o=1),t.graphics.clear(),t.graphics.beginFill(a,o),t.graphics.moveTo(0,0);var s=i*r,l=Math.cos(s)*n,c=Math.sin(s)*n;t.graphics.lineTo(l,c),t.graphics.drawArc(0,0,n,s,e*Math.PI/180),t.graphics.lineTo(0,0),t.graphics.endFill()},t.drawCircle=function(t,e,n,r,i,a){void 0===n&&(n=ColorDef.Tan),void 0===r&&(r=0),void 0===i&&(i=0),void 0===a&&(a=1),t.graphics.clear(),t.graphics.beginFill(n,a),t.graphics.drawCircle(r,i,e),t.graphics.endFill()},t.drawSquar=function(t,e,n,r){void 0===n&&(n=ColorDef.Tan),void 0===r&&(r=1),this.drawRect(t,e,e,n,r)},t.drawRect=function(t,e,n,r,i){void 0===r&&(r=ColorDef.Tan),void 0===i&&(i=1),t.graphics.clear(),t.graphics.beginFill(r,i),t.graphics.drawRect(0,0,e,n),t.graphics.endFill()},t.pointDistance=function(t,e){var n=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(n*n+r*r)},t.getRad=function(e,n){var r=t.pointDistance(e,n),i=n[1]-e[1],a=n[0]-e[0],o=a/r,s=Math.acos(i/r);return o>0?s:-s},t.isNumEqual=function(t,e,n){return void 0===n&&(n=3),Math.abs(t-e)<n},t.degNormalize=function(t){return t%=360,t>180?t-360:-180>t?t+360:t},t.clamp=function(t,e,n){return e>t?e:t>n?n:t},t}();window.Util=n,__reflect(n.prototype,"Util",[]);var r=Math.PI/180;window.angle2RadParam=r},function(t,e){var n=function(){function t(){this._initialed=!1}return Object.defineProperty(t,"GameStage",{get:function(){return t.Ins._gameStage},enumerable:!1,configurable:!0}),Object.defineProperty(t,"StageWidth",{get:function(){return t.Ins._gameStage.stageWidth},enumerable:!1,configurable:!0}),Object.defineProperty(t,"StageHeight",{get:function(){return t.Ins._gameStage.stageHeight},enumerable:!1,configurable:!0}),Object.defineProperty(t,"Ins",{get:function(){return t._instance?t._instance:(t._instance=new t,t._instance)},enumerable:!1,configurable:!0}),t.prototype.init=function(t){UserData.initialData(),this._gameStage=t,MessageManager.Ins.initial(t),LayerManager.Ins.initial(),SceneManager.Ins.initial(),this._initialed=!0,this._gameStage.addEventListener(egret.Event.ENTER_FRAME,this.update,this)
},t.prototype.update=function(){this._initialed&&SceneManager.Ins.update()},t}();window.GameRoot=n,__reflect(n.prototype,"GameRoot",[])},function(t,e){var n=function(){function t(){}return Object.defineProperty(t,"Ins",{get:function(){return null==this._instance&&(this._instance=new t),this._instance},enumerable:!1,configurable:!0}),t.prototype.initial=function(){this.loadingUI=new LoadingUI,this.loadingUI.initial(),this.uiLayer=new eui.UILayer,this.gameLayer=new egret.DisplayObjectContainer,GameRoot.GameStage.addChild(this.gameLayer),GameRoot.GameStage.addChild(this.uiLayer),this.uiLayer.touchThrough=!0,GameRoot.GameStage.addChild(this.loadingUI)},t.prototype.showLoadingUILayer=function(){this.loadingUI.clear(),this.loadingUI.visible=!0,this.loadingUI.touchEnabled=!0},t.prototype.hideLoadingUILayer=function(){this.loadingUI.visible=!1,this.loadingUI.touchEnabled=!1},t.prototype.clear=function(){this.gameLayer.removeChildren(),this.uiLayer.removeChildren()},t}();window.LayerManager=n,__reflect(n.prototype,"LayerManager",[])},function(t,e){var n=function(t){function e(){var e=t.call(this)||this;return e._listenerList=[],e}return __extends(e,t),Object.defineProperty(e,"Ins",{get:function(){return null==this.instance&&(this.instance=new e),this.instance},enumerable:!1,configurable:!0}),e.prototype.initial=function(t){t.addChild(this)},e.prototype.sendMessage=function(t,e){void 0===e&&(e=null),this.dispatchEvent(new r(e,t))},e.prototype.addEventListener=function(e,n,r){t.prototype.addEventListener.call(this,e,n,r),this._listenerList.push([e,n,r])},e.prototype.clearListener=function(){for(var t=0,e=this._listenerList;t<e.length;t++){var n=e[t],r=n[0],i=n[1],a=n[2];this.removeEventListener(r,i,a)}this._listenerList=[]},e}(egret.DisplayObject);window.MessageManager=n,__reflect(n.prototype,"MessageManager",[]);var r=function(t){function e(e,n,r,i){void 0===r&&(r=!1),void 0===i&&(i=!1);var a=t.call(this,n,r,i)||this;return a.messageContent=e,a}return __extends(e,t),e}(egret.Event);window.Message=r,__reflect(r.prototype,"Message",[])},function(t,e){var n=function(){function t(){this._timeScale=1,this._frameCount=0,this._isFrame30Play=[];for(var t=0;30>t;t++)this._isFrame30Play[t]=!0}return Object.defineProperty(t.prototype,"TimeScale",{set:function(t){if(this._frameCount=0,t>1)return void(this._timeScale=1);this._timeScale=t;var e=Math.ceil(30-30*this._timeScale);this.set30PlayArray(e),console.log(this._isFrame30Play)},enumerable:!1,configurable:!0}),Object.defineProperty(t,"Ins",{get:function(){return t._instance?t._instance:(t._instance=new t,t._instance)},enumerable:!1,configurable:!0}),t.prototype.initial=function(){},t.prototype.set30PlayArray=function(t){var e=30-t,n=!1;t>e&&(n=!0,e=t,t=30-e);for(var r=e/t,i=r,a=0,o=0;30>o;o++)e>0?i>a?(this._isFrame30Play[o]=!0,a+=1,e-=1):(this._isFrame30Play[o]=!1,i+=r):this._isFrame30Play[o]=!1;n&&this.playBoolReverse()},t.prototype.playBoolReverse=function(){for(var t=0;30>t;t++)this._isFrame30Play[t]=!this._isFrame30Play[t]},t.prototype.update=function(){return this._timeScale<.034?!1:this._timeScale>.966?!0:(this._frameCount=this._frameCount+1,this._frameCount>=30&&(this._frameCount=0),this._isFrame30Play[this._frameCount])},t}();window.TimeScaleManager=n,__reflect(n.prototype,"TimeScaleManager",[])},function(t,e){var n;!function(t){t[t.DodgerBlue=2003199]="DodgerBlue",t[t.GhostWhite=16316671]="GhostWhite",t[t.Coral=16744272]="Coral",t[t.Tan=13808780]="Tan",t[t.AntiqueWhite=16444375]="AntiqueWhite",t[t.DarkOrange=16747520]="DarkOrange",t[t.LimeGreen=3329330]="LimeGreen",t[t.DarkRed=9109504]="DarkRed",t[t.White=16777215]="White",t[t.DarkGray=11119017]="DarkGray",t[t.DimGray=6908265]="DimGray",t[t.Black=0]="Black",t[t.Chocolate=13789470]="Chocolate",t[t.Orange=16753920]="Orange",t[t.Gold=16766720]="Gold",t[t.Yellow=16776960]="Yellow",t[t.GreenYellow=11403055]="GreenYellow",t[t.DarkViolet=9699539]="DarkViolet",t[t.Red=16711680]="Red"}(n||(n={})),window.ColorDef=n},function(t,e){var n;!function(t){t.L1CRTNDESTROYED="L1CRTNDESTROYED",t.L1BATTLEUIPORTTAP="L1BATTLEUIPORTTAP",t.L1BATTLECHARTAP="L1BATTLECHARTAP",t.L1BATTLECHARPORTTAP="L1BATTLECHARPORTTAP",t.L1TOUCHLABELTAP="L1TOUCHLABELTAP",t.L2CELLTAP="L2CELLTAP",t.L2CHARTAP="L2CHARTAP",t.L2TIMEPORTTAP="L2TIMEPORTTAP",t.L2USEENERGY="L2USEFIRE",t.L2ADDENERGY="L2ADDFIRE",t.L2BuffTriggerTime="L2BuffTriggerTime"}(n||(n={})),window.MessageType=n},function(t,e){var n=function(){function t(){this.isInitialed=!1}return t.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t.prototype.initial=function(){},t.prototype.releaseResource=function(){},t.prototype.defaultRelease=function(){egret.Tween.removeAllTweens(),LayerManager.Ins.clear(),MessageManager.Ins.clearListener()},t.prototype.release=function(){},t.prototype.update=function(){},t}();window.IScene=n,__reflect(n.prototype,"IScene",[])},function(t,e){var n=function(){function t(){}return Object.defineProperty(t,"Ins",{get:function(){return t._instance?t._instance:(t._instance=new t,t._instance)},enumerable:!1,configurable:!0}),t.prototype.initial=function(){this.setScene(new StartScene)},t.prototype.setScene=function(t){LayerManager.Ins.showLoadingUILayer();var e=this.curScene;this.curScene=t,null!=e&&(e.defaultRelease(),e.release(),e.releaseResource(),e=null),this.loadScene(t)},t.prototype.loadScene=function(t){var e=this;t.loadResource().then(function(){t.initial(),t.isInitialed=!0,e.onSceneLoadingCompelete()})},t.prototype.onSceneLoadingCompelete=function(){LayerManager.Ins.hideLoadingUILayer()},t.prototype.update=function(){null!=this.curScene&&this.curScene.isInitialed&&this.curScene.update()},t}();window.SceneManager=n,__reflect(n.prototype,"SceneManager",[])},function(t,e){var n=function(){function t(){}return t.initialData=function(){var e=t.getObject("L1Data");this.l1Data=new L1Data,e&&this.l1Data.initialByData(e)},t.setObject=function(t,e){egret.localStorage.setItem(t,JSON.stringify(e))},t.getObject=function(t){return JSON.parse(egret.localStorage.getItem(t))},t.removeKey=function(t){egret.localStorage.removeItem(t)},t.clearLocalData=function(){egret.localStorage.clear(),this.initialData()},t}();window.UserData=n,__reflect(n.prototype,"UserData",[])},function(t,e){var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initial=function(){LayerManager.Ins.uiLayer.addChild(new MainUI)},e}(IScene);window.MainScene=n,__reflect(n.prototype,"MainScene",[])},function(t,e){var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initial=function(){var t=new StartPanel;LayerManager.Ins.uiLayer.addChild(t)},e}(IScene);window.StartScene=n,__reflect(n.prototype,"StartScene",[])},function(t,e){var n=function(){function t(t,e){var n=this;this.curAnger=0,this._angerAddFrame=0,this.inSkillCasting=!1,this._destPos=[0,0],this.curSkillIndex=0,this.alive=!0,this.camp=t,this.skillManager=SceneManager.Ins.curScene.skillManager,this.charId=e;var r=L1Config.Ins.L1CHARCFGS[e];this._charPort=new L1CharPortr(t,r.portImageName,e),this.name=r.name,this.rawAttr=r.attr,this.skills=r.skills.map(function(t){return L1SkillManager.Ins.newSkill(t,n)}),this.maxHp=this.rawAttr.maxHp,this.curHp=this.maxHp,this.curAnger=0,this.def=this.rawAttr.def,this.atk=this.rawAttr.atk,this.dodgePoint=this.rawAttr.dodgePoint,this.critPoint=this.rawAttr.critPoint,this.critTime=this.rawAttr.critTime,this._angerAddFrame=this.rawAttr.angerAdds/60,this.normalAttackSkill=this.skillManager.newSkill(r.normalSkill,this),this.buffStatus=new MySet,this.buffs=new MySet,MessageManager.Ins.addEventListener(MessageType.L1BATTLECHARPORTTAP,this.portTap,this)}return t.prototype.addAngerNumber=function(t){var e=this.curAnger+t;e>L1CharAttr.MAXANGER&&(e=L1CharAttr.MAXANGER),this.curAnger=e,this._charPort.initialed&&this._charPort.drawAngerCircle(e/L1CharAttr.MAXANGER)},Object.defineProperty(t.prototype,"x",{get:function(){return this._charPort.x},set:function(t){this._charPort.x=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._charPort.y},set:function(t){this._charPort.y=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pos",{get:function(){return[this.x,this.y]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rotation",{get:function(){return this._charPort.rotationCircle.rotation},set:function(t){this._charPort.rotationCircle.rotation=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"moveSpeed",{get:function(){return this.rawAttr.moveSpeed},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rotationSpeed",{get:function(){return this.rawAttr.rotationSpeed},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"curHp",{get:function(){return this._curHp},set:function(t){this.alive&&(t>this.maxHp&&(t=this.maxHp),0>=t?(this._curHp=0,this.alive=!1,this._charPort.drawHpCircle(0),this.removeFromScene()):(this._curHp=t,this._charPort.initialed&&this._charPort.drawHpCircle(t/this.maxHp)))},enumerable:!1,configurable:!0}),t.prototype.portTap=function(t){t.messageContent==this._charPort&&MessageManager.Ins.sendMessage(MessageType.L1BATTLECHARTAP,this)},t.prototype.initial=function(t,e){this.oppos=t,this.coops=e;var n=e.indexOf(this),r=this.camp==L1Camp.Player?-1:1;this.x=(130*Math.floor(n/2)+130)*r+GameRoot.GameStage.stageWidth/2,this.y=(n%2*2-1)*(70+100*Math.floor(n/2))+500,this.camp==L1Camp.Enemy&&(this.rotation=180)},t.prototype.update=function(){if(this.alive&&(this.addAngerNumber(this._angerAddFrame),!this.isDizz()&&!this.inSkillCasting&&(null!=this.normalAttakTarget&&this.normalAttakTarget.alive||(this.normalAttakTarget=this.findNormalATKTarget(this.oppos)),null!=this.normalAttakTarget))){var t=this.findATKLocation();if(this._destPos=[Math.ceil(t[0]),Math.ceil(t[1])],!this.isSamePos([this.x,this.y],this._destPos)){this.movingTo(this._destPos);var e=this.getRotationToPos(this._destPos);return e=this.getPropDestRotation(e),void this.rotTo(e)}var n=this.getRotationToPos([this.normalAttakTarget.x,this.normalAttakTarget.y]);if(n=this.getPropDestRotation(n),this.rotTo(n),Util.isNumEqual(this.rotation,n)){if(this.curAnger==L1CharAttr.MAXANGER&&!this.isSlient()){var r=this.curSkillIndex,i=this.skills[r];if(i.isCoolDown())return this.skillManager.castSkill(i),this.addAngerNumber(-L1CharAttr.MAXANGER),this.curSkillIndex=r+1,void(this.curSkillIndex==this.skills.length&&(this.curSkillIndex=0))}this.targetInRange()&&this.normalAttackSkill.isCoolDown()&&this.skillManager.castSkill(this.normalAttackSkill)}}},t.prototype.getRotationToPos=function(t){var e=Util.getRad([this.x,this.y],t);return Math.ceil(Util.degNormalize(90-e/angle2RadParam))},t.prototype.getPropDestRotation=function(t){var e=Math.abs(t-this.rotation),n=Math.abs(t+360-this.rotation),r=Math.abs(t-360-this.rotation);return e>n?t+360:e>r?t-360:t},t.prototype.isSamePos=function(t,e,n){return void 0===n&&(n=6),Math.abs(t[0]-e[0])+Math.abs(t[1]-e[1])<=n},t.prototype.movingTo=function(t){var e=Util.getRad([this.x,this.y],t),n=1/GameRoot.GameStage.frameRate,r=n*this.moveSpeed;this.x=Math.ceil(this.x+r*Math.sin(e)),this.y=Math.ceil(this.y+r*Math.cos(e))},t.prototype.startAnim=function(t,e){this._charPort.startAnim(t,e)},t.prototype.rotTo=function(t){if(!Util.isNumEqual(t,this.rotation)){var e=1/GameRoot.GameStage.frameRate,n=e*this.rotationSpeed;return Math.abs(this.rotation-t)<n?void(this.rotation=t):this.rotation>t?void(this.rotation-=n):this.rotation<t?void(this.rotation+=n):void 0}},t.prototype.findNormalATKTarget=function(t){for(var e=Number.MAX_VALUE,n=null,r=0,i=t;r<i.length;r++){var a=i[r];if(a.alive){var o=this.disFrom(a);e>o&&(n=a,e=o)}}return n},t.prototype.disFrom=function(t){return Util.pointDistance([t.x,t.y],[this.x,this.y])},t.prototype.targetInRange=function(){return this.rawAttr.range-this.disFrom(this.normalAttakTarget)>-10},t.prototype.findATKLocation=function(){var t,e,n,r;if((null==this.normalAttakTarget||this.targetInRange())&&this.isPosLegal(this.x,this.y))return[this.x,this.y];var i=this.normalAttakTarget.x,a=this.normalAttakTarget.y,o=0,s=0,l=Util.getRad([i,a],[this.x,this.y]),c=30*angle2RadParam;if(t=this.getLinePosByRad([i,a],l,this.rawAttr.range),o=t[0],s=t[1],this.isPosLegal(o,s))return[o,s];for(var u=l,h=1;12>h;h++)if(u+=c,e=this.getLinePosByRad([i,a],u,this.rawAttr.range),o=e[0],s=e[1],this.isPosLegal(o,s))return[o,s];for(var f=this.rawAttr.range-L1CharAttr.CHARMINDIS/4;f>L1CharAttr.CHARMINDIS;){if(n=this.getLinePosByRad([i,a],l,f),o=n[0],s=n[1],this.isPosLegal(o,s))return[o,s];f-=L1CharAttr.CHARMINDIS/4}f=this.rawAttr.range+L1CharAttr.CHARMINDIS/4;for(var p=this.disFrom(this.normalAttakTarget);p>f;){if(r=this.getLinePosByRad([i,a],l,f),o=r[0],s=r[1],this.isPosLegal(o,s))return[o,s];f+=L1CharAttr.CHARMINDIS/4}return[this.x,this.y]},t.prototype.getLinePosByRad=function(t,e,n){var r=t[0]+n*Math.sin(e),i=t[1]+n*Math.cos(e);return[r,i]},t.prototype.isPosLegal=function(t,e){var n=L1CharAttr.CHARMINDIS/2,r=L1CharAttr.CHARMINDIS/2,i=GameRoot.GameStage.stageWidth-L1CharAttr.CHARMINDIS/2,a=GameRoot.GameStage.stageHeight-L1CharAttr.CHARMINDIS/2;if(n>t||r>e||t>i||e>a)return!1;for(var o=0,s=[this.oppos,this.coops];o<s.length;o++)for(var l=s[o],c=0,u=l;c<u.length;c++){var h=u[c];if(h.alive&&h!=this&&Util.pointDistance([t,e],[h.x,h.y])<L1CharAttr.CHARMINDIS&&Util.pointDistance([t,e],h._destPos)<L1CharAttr.CHARMINDIS)return!1}return!0},t.prototype.addToScene=function(){LayerManager.Ins.gameLayer.addChild(this._charPort)},t.prototype.removeFromScene=function(){LayerManager.Ins.gameLayer.removeChild(this._charPort)},t.prototype.endSkillCast=function(){egret.Tween.removeTweens(this._charPort.contentGroup)},Object.defineProperty(t.prototype,"DODGE",{get:function(){return Math.min(L1CharAttr.MAXDODGEP,this.dodgePoint)},enumerable:!1,configurable:!0}),t.prototype.isDizz=function(){return L1BuffStatus.DIZZ in this.buffStatus},t.prototype.isSlient=function(){return L1BuffStatus.SLIENT in this.buffStatus},t.prototype.refreshBuffAttr=function(){for(var t=[],e=0,n=this.buffs.data;e<n.length;e++){var r=n[e],i=r.config.isAffectDudge(this,r.caster);r.config.buffType==L1BuffType.ATTRCHANGE&&i&&t.push(r)}for(var a={},o={},s=0,l=L1CharAttr.ATTRNAMES;s<l.length;s++){var c=l[s];a[c]=0,o[c]=0}for(var u=0,h=t;u<h.length;u++)for(var r=h[u],f=0,p=L1CharAttr.ATTRNAMES;f<p.length;f++){var c=p[f];c in r.config.attrAddAbs&&(a[c]+=r.config.attrAddAbs[c]),c in r.config.attrAddRatio&&(o[c]+=r.config.attrAddRatio[c])}this.atk=this.rawAttr.atk*(1+o[L1ATTRNAME.ATK])+a[L1ATTRNAME.ATK],this.def=this.rawAttr.def*(1+o[L1ATTRNAME.DEF])+a[L1ATTRNAME.DEF],this.critPoint=this.rawAttr.critPoint*(1+o[L1ATTRNAME.CRITP])+a[L1ATTRNAME.CRITP],this.dodgePoint=this.rawAttr.dodgePoint*(1+o[L1ATTRNAME.DODGEP])+a[L1ATTRNAME.DODGEP];var d=this.rawAttr.maxHp*(1+o[L1ATTRNAME.MAXHP])+a[L1ATTRNAME.MAXHP];if(d>this.maxHp){var g=d-this.maxHp;this.curHp+=g,this.maxHp=d}this.critTime=this.rawAttr.critTime*(1+o[L1ATTRNAME.CRITT])+a[L1ATTRNAME.CRITT]},t.prototype.refreshBuffStatus=function(){this.buffStatus.removeAll();for(var t=[],e=0,n=this.buffs.data;e<n.length;e++){var r=n[e],i=r.config.isAffectDudge(this,r.caster);r.config.buffType==L1BuffType.STATUS&&i&&t.push(r.config.status)}for(var a=0,o=t;a<o.length;a++){var s=o[a];this.buffStatus.add(s)}this.isDizz()?this._charPort.toDizz():this._charPort.outDizz(),this.isSlient()?this._charPort.toSlient():this._charPort.outSlient()},t}();window.L1Char=n,__reflect(n.prototype,"L1Char",[])},function(t,e){var n;!function(t){t.MAXHP="MAXHP",t.ATK="ATK",t.DEF="DEF",t.CRITP="CRITP",t.DODGEP="DODGEP",t.CRITT="CRITT"}(n||(n={})),window.L1ATTRNAME=n},function(t,e){var n=function(){function t(t,e,n,r,i,a,o,s){this.maxHp=t,this.atk=e,this.def=n,this.range=r,this.critPoint=i,this.dodgePoint=a,this.critTime=o,this.posNum=s,this.moveSpeed=160,this.rotationSpeed=180,this.angerAdds=20}return t.ATTRNAMES=[L1ATTRNAME.MAXHP,L1ATTRNAME.ATK,L1ATTRNAME.DEF,L1ATTRNAME.CRITP,L1ATTRNAME.DODGEP,L1ATTRNAME.CRITT],t.MAXANGER=100,t.CHARMINDIS=60,t.MAXDODGEP=80,t}();window.L1CharAttr=n,__reflect(n.prototype,"L1CharAttr",[])},function(t,e){var n=function(){function t(t,e,n,r,i,a){this.attr=t,this.skills=e,this.normalSkill=n,this.passiveSkills=r,this.name=i,this.portImageName=a}return t}();window.L1CharConfig=n,__reflect(n.prototype,"L1CharConfig",[])},function(t,e){var n=function(t){function e(e,n,r){void 0===r&&(r=0);var i=t.call(this)||this;return i._portImage=n,i._charId=r,i._camp=e,i.initialed=!1,i.addEventListener(eui.UIEvent.COMPLETE,i.UIEventEndInit,i),i.addEventListener(egret.TouchEvent.TOUCH_TAP,i.tapEvent,i),i}return __extends(e,t),e.prototype.tapEvent=function(){MessageManager.Ins.sendMessage(MessageType.L1BATTLECHARPORTTAP,this)},e.prototype.UIEventEndInit=function(){this.portImage.source=this._portImage,this.portImage.mask=this.portMask,this._camp==r.Player?this.hpNumCircle.fillColor=ColorDef.LimeGreen:this.hpNumCircle.fillColor=ColorDef.DarkRed,this.angerNumMask=new egret.Shape,this.contentGroup.addChild(this.angerNumMask),this.angerNumCircle.mask=this.angerNumMask,this.drawAngerCircle(0),this.hpNumMask=new egret.Shape,this.contentGroup.addChild(this.hpNumMask),this.hpNumCircle.mask=this.hpNumMask,this.drawHpCircle(1),this.rotationPoint.fillColor=this._camp==r.Player?ColorDef.LimeGreen:ColorDef.DarkRed;this.initialed=!0},e.prototype.drawHpCircle=function(t){this.hpNumMask.x=0,this.hpNumMask.y=0,this.drawCircle(this.hpNumMask,360*t,this.hpNumCircle.width/2),this.hpNumMask.x=this.contentGroup.width/2,this.hpNumMask.y=this.contentGroup.width/2},e.prototype.drawAngerCircle=function(t){this.angerNumMask.x=0,this.angerNumMask.y=0,this.drawCircle(this.angerNumMask,360*t,this.angerNumCircle.width/2),this.angerNumMask.x=this.contentGroup.width/2,this.angerNumMask.y=this.contentGroup.width/2},e.prototype.drawCircle=function(t,e,n){var r=-90;e-=90,Util.drawAngleCircle(t,e,n,r)},e.prototype.startAnim=function(t,e){egret.Tween.removeTweens(this.contentGroup);var n=this.rotationCircle.rotation*angle2RadParam,r=t[0],i=this.getAngleCoorSysPos(r,n),a=i[0],o=i[1];this.contentGroup.x=a,this.contentGroup.y=o;for(var s=egret.Tween.get(this.contentGroup),l=0;l<e.length;l++){var c=this.getAngleCoorSysPos(t[l+1],n),u=c[0],h=c[1],f=e[l];s.to({x:u,y:h},f)}},e.prototype.getAngleCoorSysPos=function(t,e){var n=t[0],r=t[1],i=Math.cos(-e),a=Math.sin(-e),o=n*i+r*a,s=r*i-n*a;return[o,s]},e.prototype.toDizz=function(){this.dizzLabel.visible=!0},e.prototype.outDizz=function(){this.dizzLabel.visible=!1},e.prototype.toSlient=function(){this.slientLabel.visible=!0},e.prototype.outSlient=function(){this.slientLabel.visible=!1},e}(eui.Component);window.L1CharPortr=n,__reflect(n.prototype,"L1CharPortr",[]);var r;!function(t){t[t.Enemy=1]="Enemy",t[t.Player=-1]="Player"}(r||(r={})),window.L1Camp=r},function(t,e){var n=function(){function t(){this.currentMainStoryId=0,this.userUseCharIds=[1,2,3,4],this.userAllCharIds=[1,2,3,4,5,6,7,8]}return Object.defineProperty(t.prototype,"CurMainStoryId",{get:function(){return this.currentMainStoryId},set:function(t){this.currentMainStoryId=t,this.writeData()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"UserUseCharIds",{get:function(){return this.userUseCharIds},set:function(t){this.userUseCharIds=t,this.writeData()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"UserAllCharIds",{get:function(){return this.userAllCharIds},enumerable:!1,configurable:!0}),t.prototype.initialByData=function(t){for(var e in t)this[e]=t[e]},t.prototype.writeData=function(){UserData.setObject("L1Data",this)},t}();window.L1Data=n,__reflect(n.prototype,"L1Data",[]);var r;!function(t){t[t.MainStory=0]="MainStory"}(r||(r={})),window.L1LevelType=r},function(t,e){var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initial=function(){LayerManager.Ins.uiLayer.addChild(new L1MainUI)},e}(IScene);window.L1MainScene=n,__reflect(n.prototype,"L1MainScene",[])},function(t,e){var n=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._resLoad=new ResAsyncLoader,e._players=[],e._enemies=[],e._battleEnd=!1,e._battleStart=!1,e}return __extends(e,t),Object.defineProperty(e.prototype,"BattleEnd",{get:function(){return this._battleEnd},set:function(t){if(this._battleEnd=t,1==t&&this._victoryCamp==L1Camp.Player){if(UserData.l1Data.levelType==L1LevelType.MainStory){var e=Object.keys(L1Config.Ins.L1LevelCFGS).length-1,n=UserData.l1Data.CurMainStoryId+1;e>=n&&(UserData.l1Data.CurMainStoryId=n)}this._battleSceneUI.battleEnd(!0)}1==t&&this._victoryCamp==L1Camp.Enemy&&this._battleSceneUI.battleEnd(!1)},enumerable:!1,configurable:!0}),e.prototype.initial=function(){this.skillManager=new L1SkillManager,this.creationManager=new L1CreationManager,this.buffManager=new L1BuffManager,this._battleSceneUI=new L1BattleSceneUI,LayerManager.Ins.uiLayer.addChild(this._battleSceneUI),this.initialGameLayer()},e.prototype.initialGameLayer=function(){for(var t=this,e=this.readEnemiesIds(),n=0,r=e;n<r.length;n++){var i=r[n],a=new L1Char(L1Camp.Enemy,i);a.addToScene(),this._enemies.push(a)}for(var o=UserData.l1Data.UserUseCharIds,s=0,l=o;s<l.length;s++){var i=l[s],a=new L1Char(L1Camp.Player,i);a.addToScene(),this._players.push(a)}this._enemies.sort(function(t,e){return t.rawAttr.posNum-e.rawAttr.posNum}),this._players.sort(function(t,e){return t.rawAttr.posNum-e.rawAttr.posNum}),this._enemies.forEach(function(e){e.initial(t._players,t._enemies)}),this._players.forEach(function(e){e.initial(t._enemies,t._players)})},e.prototype.readEnemiesIds=function(){return UserData.l1Data.levelType==L1LevelType.MainStory?L1Config.Ins.L1LevelCFGS[UserData.l1Data.CurMainStoryId]:void 0},e.prototype.battleStart=function(){this._battleStart=!0},e.prototype.removeChar=function(t){for(var e=-1,n=0;n<this._players.length;n++)if(this._players[n].charId==t){e=n;break}if(-1==e)return void console.warn("哪里不对劲");var r=this._players[e];r.removeFromScene(),this._players.splice(e,1),this.endReplace()},e.prototype.addChar=function(t){var e=new L1Char(L1Camp.Player,t);e.addToScene(),this._players.push(e),this.endReplace()},e.prototype.endReplace=function(){var t=this;this._players.sort(function(t,e){return t.rawAttr.posNum-e.rawAttr.posNum}),this._players.forEach(function(e){e.initial(t._enemies,t._players)})},e.prototype.update=function(){if(this._battleStart&&!this.BattleEnd){var t=0,e=0;if([this._enemies,this._players].forEach(function(n){n.forEach(function(n){n.alive&&(n.camp==L1Camp.Enemy&&e++,n.camp==L1Camp.Player&&t++)})}),0==t)return this._victoryCamp=L1Camp.Enemy,this.BattleEnd=!0,void ToastInfoManager.newRedToast("战斗失败");if(0==e)return this._victoryCamp=L1Camp.Player,this.BattleEnd=!0,void ToastInfoManager.newRedToast("战斗胜利");this.skillManager.update(),this.creationManager.update(),this.buffManager.update(),this._battleSceneUI.update(),[this._enemies,this._players].forEach(function(t){t.forEach(function(t){t.update()})})}},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this._resLoad.loadGroup("portrait",0,LayerManager.Ins.loadingUI)];case 1:return t.sent(),[2]}})})},e.prototype.releaseResource=function(){this._resLoad.releaseResource()},e}(IScene);window.L1NormalBattleScene=n,__reflect(n.prototype,"L1NormalBattleScene",[])},function(t,e){var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initial=function(){LayerManager.Ins.uiLayer.addChild(new L1MainUI)},e}(IScene);window.L1RoughlikeScene=n,__reflect(n.prototype,"L1RoughlikeScene",[])},function(t,e){var n=function(){function t(){this.L1CHARCFGS=this.GetCHARCFGS(),this.L1LevelCFGS=this.GetL1LevelCFGS()}return Object.defineProperty(t,"Ins",{get:function(){return this._instance?this._instance:(this._instance=new t,this._instance)},enumerable:!1,configurable:!0}),t.prototype.GetCHARCFGS=function(){var t={TEMPLATE:new L1HarmConfig(function(t,e){return[!0,0]}),HEAL01:new L1HarmConfig(function(t,e){var n=L1Harm.isRandTrue(t.critPoint),r=.2*t.maxHp;return n&&(r*=t.critTime),[n,-r]})},e={TEMPLATE:new L1BuffConfig("TEMPLATE","模版",1e3,1e3,L1BuffType.ATTRCHANGE,L1BuffStatus.NORMAL,"",{},{},function(t,e){},function(t,e){return!0}),BUFF01:new L1BuffConfig("BUFF01","攻击+10",3e3,1e3,L1BuffType.ATTRCHANGE,L1BuffStatus.NORMAL,"攻击 +10",{ATK:10}),BUFF02:new L1BuffConfig("BUFF02","每1s对自身造成10点伤害，持续10s",1e4,1e3,L1BuffType.AFFECTPERIOD,L1BuffStatus.NORMAL,"持续掉血",null,null,function(t,n){L1Harm.harm(n,[t],new L1HarmConfig(function(){return[!1,10]})),L1BuffManager.Ins.newBuff(e.BUFF01,t,n)})},n={TEMPLATE:new L1CreationConfig(100,L1CrtnFlyType.FIX,L1CrTnAffectContType.ONECE,L1CrTnAffectTargetSetType.PRESET,L1CrtnAffectTargetCamp.OTHER,400,1e3,200,function(t,e){},.9,ColorDef.DarkOrange),NORMBULLET01:new L1CreationConfig(5,L1CrtnFlyType.CHAR,L1CrTnAffectContType.ONECE,L1CrTnAffectTargetSetType.PRESET,L1CrtnAffectTargetCamp.OTHER,800,1,10,function(t,e){L1Harm.harm(e,t)},1,ColorDef.DarkOrange)},r={TEMPLATE:new L1SkillConfig("",1e3,{0:function(){}},function(t){return null},"模版"),NROMATK:new L1SkillConfig("",1e3,{0:function(t){t.caster.startAnim([[0,0],[10,0],[-5,0],[0,0]],[75,100,50]),t.caster.addAngerNumber(15)},75:function(t){L1Harm.harm(t.caster,t.targets)},225:function(){}},function(t){return[t.caster.normalAttakTarget]},"普通攻击"),NORMRANGATK:new L1SkillConfig("",1e3,{0:function(t){t.caster.startAnim([[0,0],[10,0],[-5,0],[0,0]],[75,100,50]),t.caster.addAngerNumber(15),t.newCreation(n.NORMBULLET01,t.caster,t.targets[0],t.caster.pos,t.targets[0].pos),t.newBuff(e.BUFF01,t.caster,t.caster)},225:function(){}},function(t){return[t.caster.normalAttakTarget]},"远程普通攻击"),HEALSKILL:new L1SkillConfig("风灵颂",1e4,{0:function(t){t.caster.startAnim([[0,0],[0,10],[0,-10],[0,0]],[75,150,75])},150:function(n){L1Harm.harm(n.caster,n.targets,t.HEAL01),n.newBuff(e.BUFF01,n.caster,n.caster)}},function(t){return[t.caster]},"这是一个治疗技能，回复自身最大血量的20%，但在随后的10s内每s失去10血量"),TEST01:new L1SkillConfig("测试大招",4e4,{0:function(t){t.caster.startAnim([[0,0],[0,20],[0,-20],[0,0],[-20,0],[20,0],[0,0]],[75,150,75,75,150,75])},150:function(e){L1Harm.harm(e.caster,e.targets,t.HEAL01)},600:function(t){t.caster.startAnim([[0,0],[0,20],[0,0]],[2e3,2e3])},5e3:function(t){}},function(t){return[t.caster]},"这是一个特别沙雕的技能，首先让角色进入癫痫，然后给自己治疗20%血量，之后像喝醉了一样，进入5s的贤者时间"),TEST02:new L1SkillConfig("测试小技能",2e4,{0:function(t){t.caster.startAnim([[0,0],[0,10],[0,-10],[0,0]],[75,150,75])},150:function(t){}},function(t){return[t.caster]},"这是一个无法描述的技能，因为他没有任何效果，只会让你的英雄傻站着不动")};return{1:new L1CharConfig(new L1CharAttr(1e3,200,200,400,10,10,1.2,100),[r.HEALSKILL,r.TEST01,r.TEST02],r.NORMRANGATK,[],"测试角色1","1_portrait_png"),2:new L1CharConfig(new L1CharAttr(1e3,200,200,120,10,10,1.2,0),[r.HEALSKILL,r.TEST01,r.TEST02],r.NROMATK,[],"测试角色2","2_portrait_png"),3:new L1CharConfig(new L1CharAttr(1e3,200,200,400,10,10,1.2,200),[r.HEALSKILL,r.TEST01,r.TEST02],r.NORMRANGATK,[],"测试角色3","3_portrait_png"),4:new L1CharConfig(new L1CharAttr(1e3,200,200,400,10,10,1.2,200),[r.HEALSKILL,r.TEST01,r.TEST02],r.NORMRANGATK,[],"测试角色4","4_portrait_png"),5:new L1CharConfig(new L1CharAttr(1e3,200,200,400,10,10,1.2,200),[r.HEALSKILL,r.TEST01,r.TEST02],r.NORMRANGATK,[],"测试角色5","5_portrait_png"),6:new L1CharConfig(new L1CharAttr(1e3,200,200,400,10,10,1.2,200),[r.HEALSKILL,r.TEST01,r.TEST02],r.NORMRANGATK,[],"测试角色6","6_portrait_png"),7:new L1CharConfig(new L1CharAttr(1e3,200,200,400,10,10,1.2,200),[r.HEALSKILL,r.TEST01,r.TEST02],r.NORMRANGATK,[],"测试角色7","7_portrait_png"),8:new L1CharConfig(new L1CharAttr(1e3,200,200,400,10,10,1.2,200),[r.HEALSKILL,r.TEST01,r.TEST02],r.NORMRANGATK,[],"测试角色8","8_portrait_png")}},t.prototype.GetL1LevelCFGS=function(){return{0:[1,1],1:[1,1,1],2:[1,1,2,2]}},t}();window.L1Config=n,__reflect(n.prototype,"L1Config",[])},function(t,e){var n=function(){function t(){this._castframeCount=0,this._creationManager=SceneManager.Ins.curScene.creationManager,this._buffManager=SceneManager.Ins.curScene.buffManager}return t.prototype.initial=function(t,e){this.caster=t,this.config=e;var n=GameRoot.GameStage.frameRate/1e3;this._frameCD=Math.ceil(this.config.cdMs*n);var r=this.config.timeLine,i={};for(var a in r)i[Math.ceil(parseInt(a)*n)]=r[a];this._endFrame=0;for(var a in i){var o=parseInt(a);o>this._endFrame&&(this._endFrame=o)}this._endFrame+=1,this.timeLine=i,this._runCd=0},t.prototype.release=function(){},Object.defineProperty(t.prototype,"CDRUN",{get:function(){return this._runCd},set:function(t){0>=t&&(t=0),this._runCd=t},enumerable:!1,configurable:!0}),t.prototype.isCoolDown=function(){return 0==this.CDRUN},t.prototype.findTarget=function(){this.targets=this.config.skillTargetFind(this)},t.prototype.castPrepare=function(){this._castframeCount=0,this.CDRUN=this._frameCD,this.showSkillName(),this.caster.inSkillCasting=!0},t.prototype.showSkillName=function(){if(""!=this.config.name){var t=ColorDef.DodgerBlue,e=40;ToastInfoManager.newToast(this.config.name,t,this.caster.y-60,this.caster.x-GameRoot.GameStage.stageWidth/2,-50,0,2500,e,!0,egret.Ease.quadOut)}},t.prototype.isCD=function(){return 0==this.CDRUN},t.prototype.isEnd=function(){return this._castframeCount>this._endFrame},t.prototype.castingUpdate=function(){this._castframeCount in this.timeLine&&this.timeLine[this._castframeCount](this),this._castframeCount+=1},t.prototype.endCast=function(){this.caster.inSkillCasting=!1,this.caster.endSkillCast()},t.prototype.newCreation=function(t,e,n,r,i,a){void 0===n&&(n=null),void 0===i&&(i=null),void 0===a&&(a=null),this._creationManager.newCreation(t,e,n,r,i,a)},t.prototype.newBuff=function(t,e,n){this._buffManager.newBuff(t,e,n)},t}();window.L1Skill=n,__reflect(n.prototype,"L1Skill",[])},function(t,e){var n=function(){function t(t,e,n,r,i){this.name=t,this.cdMs=e,this.timeLine=n,this.skillTargetFind=r,this.descr=i}return t}();window.L1SkillConfig=n,__reflect(n.prototype,"L1SkillConfig",[])},function(t,e){var n=function(){function t(){this._skillCastingList=new MySet,this._allSkillList=new MySet}return Object.defineProperty(t,"Ins",{get:function(){return SceneManager.Ins.curScene.skillManager},enumerable:!1,configurable:!0}),t.prototype.update=function(){for(var t=[],e=0,n=this._skillCastingList.data;e<n.length;e++){var r=n[e];r.castingUpdate(),r.isEnd()&&(r.endCast(),t.push(r))}for(var i=0,a=t;i<a.length;i++){var r=a[i];this._skillCastingList.remove(r)}for(var o=0,s=this._allSkillList.data;o<s.length;o++){var r=s[o];r.CDRUN=r.CDRUN-1}},t.prototype.castSkill=function(t){t.castPrepare(),t.findTarget(),this._skillCastingList.add(t)},t.prototype.castSkillBreak=function(t){t.endCast(),this._skillCastingList.remove(t)},t.prototype.newSkill=function(t,e){var n=new L1Skill;return n.initial(e,t),this._allSkillList.add(n),n},t}();window.L1SkillManager=n,__reflect(n.prototype,"L1SkillManager",[])},function(t,e){var n=function(){function t(){this._activateFrame=0}return t.prototype.initial=function(t,e,n){this.config=t;var r=GameRoot.GameStage.frameRate/1e3;this._periodFrame=Math.ceil(this.config.period*r),this._durationFrame=Math.ceil(this.config.duration*r),this._condPeriodFrame=Math.ceil(this.config.condCd*r),this._preCondAffectFrame=-this._condPeriodFrame,this.addToTarget(e),this._activateFrame=0,this.caster=n},t.prototype.addToTarget=function(t){this._target=t,t.buffs.add(this),this.config.buffType==L1BuffType.STATUS&&t.refreshBuffStatus(),this.config.buffType==L1BuffType.ATTRCHANGE&&t.refreshBuffAttr(),this.showBuffName()},t.prototype.showBuffName=function(){if(""!=this.config.name){var t=ColorDef.GhostWhite,e=25;ToastInfoManager.newToast(this.config.name,t,this._target.y-60,this._target.x-GameRoot.GameStage.stageWidth/2,-50,0,2500,e,!1,egret.Ease.quadOut)}},t.prototype.removeFromTarget=function(){var t=this._target;t.buffs.remove(this),this.config.buffType==L1BuffType.STATUS&&t.refreshBuffStatus(),this.config.buffType==L1BuffType.ATTRCHANGE&&t.refreshBuffAttr()
},t.prototype.update=function(){this.config.buffType==L1BuffType.AFFECTPERIOD&&this._activateFrame%this._periodFrame==0&&this.config.isAffectDudge(this._target,this.caster)&&this.config.isAffectDudge(this._target,this.caster),this.config.buffType==L1BuffType.AFFECTCOND&&this._activateFrame-this._preCondAffectFrame>=this._condPeriodFrame&&this.config.isAffectDudge(this._target,this.caster)&&(this.config.isAffectDudge(this._target,this.caster),this._preCondAffectFrame=this._activateFrame),this._activateFrame+=1},t.prototype.isLifeEnd=function(){return 0==this._durationFrame?!1:this._activateFrame>this._durationFrame},t}();window.L1Buff=n,__reflect(n.prototype,"L1Buff",[])},function(t,e){var n=function(){function t(t,e,n,a,o,s,l,c,u,h,f,p,d,g){void 0===e&&(e="测试效果描述"),void 0===n&&(n=1e3),void 0===a&&(a=500),void 0===o&&(o=r.ATTRCHANGE),void 0===s&&(s=i.NORMAL),void 0===l&&(l=""),void 0===c&&(c={}),void 0===u&&(u={}),void 0===h&&(h=function(){}),void 0===f&&(f=function(){return!0}),void 0===p&&(p=!0),void 0===d&&(d=!0),void 0===g&&(g=1e3),this.id=t,this.descr=e,this.duration=n,this.period=a,this.buffType=o,this.status=s,this.name=l,this.attrAddAbs=c,this.attrAddRatio=u,this.affectFunc=h,this.isAffectDudge=f,this.canBeClear=p,this.isGood=d,this.condCd=g}return t}();window.L1BuffConfig=n,__reflect(n.prototype,"L1BuffConfig",[]);var r;!function(t){t[t.AFFECTPERIOD=0]="AFFECTPERIOD",t[t.AFFECTCOND=1]="AFFECTCOND",t[t.ATTRCHANGE=2]="ATTRCHANGE",t[t.STATUS=3]="STATUS"}(r||(r={})),window.L1BuffType=r;var i;!function(t){t[t.NORMAL=0]="NORMAL",t[t.DIZZ=1]="DIZZ",t[t.SLIENT=2]="SLIENT",t[t.L3=3]="L3",t[t.L4=4]="L4"}(i||(i={})),window.L1BuffStatus=i},function(t,e){var n=function(){function t(){this._deadBuffs=[],this._activateBuffs=new MySet}return Object.defineProperty(t,"Ins",{get:function(){return SceneManager.Ins.curScene.buffManager},enumerable:!1,configurable:!0}),t.prototype.update=function(){for(var t=[],e=0,n=this._activateBuffs.data;e<n.length;e++){var r=n[e];r.update(),r.isLifeEnd()&&(t.push(r),r.removeFromTarget())}for(var i=0,a=t;i<a.length;i++){var r=a[i];this._activateBuffs.remove(r),this._deadBuffs.push(r)}},t.prototype.newBuff=function(t,e,n){var r=null;r=0==this._deadBuffs.length?new L1Buff:this._deadBuffs.pop(),this._activateBuffs.add(r),r.initial(t,e,n)},t.prototype.removeBuff=function(t){t.removeFromTarget(),this._deadBuffs.push(t),this._activateBuffs.remove(t)},t}();window.L1BuffManager=n,__reflect(n.prototype,"L1BuffManager",[])},function(t,e){var n=function(){function t(){this._isFly=!0,this._isAffected=!1,this._toDestFrame=Number.MAX_VALUE,this._contentGroup=new eui.Group,this._circleShape=new egret.Shape,this._contentGroup.addChild(this._circleShape)}return Object.defineProperty(t.prototype,"x",{get:function(){return this._contentGroup.x},set:function(t){this._contentGroup.x=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._contentGroup.y},set:function(t){this._contentGroup.y=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pos",{get:function(){return[this.x,this.y]},set:function(t){this.x=t[0],this.y=t[1]},enumerable:!1,configurable:!0}),t.prototype.initial=function(t,e,n,r,i,a){void 0===n&&(n=null),void 0===i&&(i=null),void 0===a&&(a=null),LayerManager.Ins.gameLayer.addChild(this._contentGroup),this._caster=e,this._config=t,this._targetChar=n,this._posDest=i,this._directRad=a;var o=GameRoot.GameStage.frameRate/1e3;this._lifeDurationFrame=Math.ceil(this._config.lifeTime*o),this._affectPeriodFrame=Math.ceil(this._config.affectPeriod*o),this._flySpeedFrame=this._config.flySpeed*o,this._activateFrame=0,this._toDestFrame=Number.MAX_VALUE,Util.drawAngleCircle(this._circleShape,360,this._config.radius,0,this._config.color,this._config.alpha),this._circleShape.x=this._circleShape.y=0,this.x=r[0],this.y=r[1],this._isFly=!0,this._isAffected=!1,this._config.flyType==L1CrtnFlyType.FIX&&(this._isFly=!1)},t.prototype.update=function(){this._isFly&&(this._config.flyType==L1CrtnFlyType.CHAR&&this.flyTo(this._targetChar.pos),this._config.flyType==L1CrtnFlyType.POSITION&&this.flyTo(this._posDest),this._config.flyType==L1CrtnFlyType.DIRECT&&this.flyToRad(this._directRad));var t=!1;if(this._config.affectContType==L1CrTnAffectContType.CONTINUE&&this._activateFrame%this._affectPeriodFrame==0&&(t=!0),this._config.affectContType==L1CrTnAffectContType.ONECE&&(this._isFly||0!=this._isAffected||(t=!0)),t){var e=this.findAffectTarget();this._config.affectFunc(e,this._caster),this._isAffected=!0}this._activateFrame+=1},t.prototype.findAffectTarget=function(){var t=[];if(this._config.affectTargetSetType==L1CrTnAffectTargetSetType.PRESET)t.push(this._targetChar);else if(this._config.affectTargetSetType==L1CrTnAffectTargetSetType.RANGE){var e=this._caster.oppos;this._config.affectTargetCamp==L1CrtnAffectTargetCamp.SELF&&(e=this._caster.coops);for(var n=0,r=e;n<r.length;n++){var i=r[n];Util.pointDistance(i.pos,this.pos)<this._config.radius&&t.push(i)}}return t},t.prototype.flyTo=function(t){if(this.closeTo(this.pos,t))return this.pos=t,this._isFly=!1,void(this._toDestFrame=this._activateFrame);var e=Util.getRad(this.pos,t);this.flyToRad(e)},t.prototype.closeTo=function(t,e){return Util.pointDistance(t,e)<this._flySpeedFrame+20},t.prototype.flyToRad=function(t){this.x=Math.ceil(this.x+this._flySpeedFrame*Math.sin(t)),this.y=Math.ceil(this.y+this._flySpeedFrame*Math.cos(t))},t.prototype.lifeEnd=function(){LayerManager.Ins.gameLayer.removeChild(this._contentGroup),this._config=null},t.prototype.isLifeEnd=function(){var t=this._toDestFrame;return(this._config.flyType==L1CrtnFlyType.FIX||this._config.flyType==L1CrtnFlyType.DIRECT)&&(t=0),this._activateFrame>this._lifeDurationFrame+t+1},t}();window.L1Creation=n,__reflect(n.prototype,"L1Creation",[])},function(t,e){var n=function(){function t(t,e,n,s,l,c,u,h,f,p,d){void 0===t&&(t=10),void 0===e&&(e=r.FIX),void 0===n&&(n=i.ONECE),void 0===s&&(s=a.RANGE),void 0===l&&(l=o.OTHER),void 0===c&&(c=1e3),void 0===u&&(u=1e3),void 0===h&&(h=1e3),void 0===f&&(f=function(t,e){L1Harm.harm(e,t)}),void 0===p&&(p=.4),void 0===d&&(d=ColorDef.White),this.radius=10,this.flyType=r.FIX,this.affectContType=i.ONECE,this.affectTargetSetType=a.RANGE,this.affectTargetCamp=o.OTHER,this.flySpeed=1e3,this.lifeTime=1e3,this.affectPeriod=1e3,this.alpha=.4,this.radius=t,this.flySpeed=c,this.flyType=e,this.affectContType=n,this.affectTargetSetType=s,this.affectTargetCamp=l,this.lifeTime=u,this.affectPeriod=h,this.affectFunc=f,this.alpha=p,this.color=d}return t}();window.L1CreationConfig=n,__reflect(n.prototype,"L1CreationConfig",[]);var r;!function(t){t[t.FIX=0]="FIX",t[t.POSITION=1]="POSITION",t[t.DIRECT=2]="DIRECT",t[t.CHAR=3]="CHAR"}(r||(r={})),window.L1CrtnFlyType=r;var i;!function(t){t[t.CONTINUE=0]="CONTINUE",t[t.ONECE=1]="ONECE"}(i||(i={})),window.L1CrTnAffectContType=i;var a;!function(t){t[t.PRESET=0]="PRESET",t[t.RANGE=1]="RANGE"}(a||(a={})),window.L1CrTnAffectTargetSetType=a;var o;!function(t){t[t.SELF=0]="SELF",t[t.OTHER=1]="OTHER"}(o||(o={})),window.L1CrtnAffectTargetCamp=o},function(t,e){var n=function(){function t(){this._deadCreations=[],this._activateCreations=new MySet}return Object.defineProperty(t,"Ins",{get:function(){return SceneManager.Ins.curScene.creationManager},enumerable:!1,configurable:!0}),t.prototype.update=function(){for(var t=[],e=0,n=this._activateCreations.data;e<n.length;e++){var r=n[e];r.update(),r.isLifeEnd()&&(r.lifeEnd(),t.push(r))}for(var i=0,a=t;i<a.length;i++){var r=a[i];this._activateCreations.remove(r),this._deadCreations.push(r)}},t.prototype.newCreation=function(t,e,n,r,i,a){void 0===n&&(n=null),void 0===i&&(i=null),void 0===a&&(a=null);var o=null;o=this._deadCreations.length>0?this._deadCreations.pop():new L1Creation,o.initial(t,e,n,r,i,a),this._activateCreations.add(o)},t}();window.L1CreationManager=n,__reflect(n.prototype,"L1CreationManager",[])},function(t,e){var n=function(){function t(){}return t.harm=function(t,e,n){var r=new L1HarmConfig;n||(n=r);for(var i=0,a=e;i<a.length;i++){var o=a[i],s=n.harmFunc(t,o),l=s[0],c=s[1];o.curHp-=c,c>=0&&o.addAngerNumber(10),this.harmFloat(o,c,l)}},t.harmFloat=function(t,e,n){if(t.alive){var r="",i="miss",a=25,o=ColorDef.GhostWhite;if(e=Math.ceil(e),0!=e){a=n?30:25;var s=0>e;i=n?"暴击 ":s?"治疗 ":"",o=s?ColorDef.LimeGreen:n?ColorDef.DarkRed:ColorDef.GhostWhite,r=""+(s?"+":"")+-e}ToastInfoManager.newToast(""+i+r,o,t.y-40,t.x-GameRoot.GameStage.stageWidth/2,-50,0,2500,a,!1,egret.Ease.quadOut)}},t.isRandTrue=function(t){return 100*Math.random()<t},t}();window.L1Harm=n,__reflect(n.prototype,"L1Harm",[])},function(t,e){var n=function(){function t(t){t?this.harmFunc=t:this.harmFunc=function(t,e){var n=L1Harm.isRandTrue(t.critPoint),r=L1Harm.isRandTrue(e.DODGE),i=0;if(!r){var a=n?t.critTime:1;i=t.atk*t.atk/(e.def+t.atk)*a}return[n,i]}}return t}();window.L1HarmConfig=n,__reflect(n.prototype,"L1HarmConfig",[])},function(t,e){var n=function(){function t(t){this.params=t}return Object.defineProperty(t.prototype,"effectRange",{get:function(){return this.params.effectRange},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"castRange",{get:function(){return this.params.castRange},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this.params.name},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"castFunc",{get:function(){return this.params.castFunc},enumerable:!1,configurable:!0}),t.harm=function(t,e,n){void 0===n&&(n=1),e.hpChange(-(t.attr.atk-e.attr.def)*n)},t}();window.L2SkillCfg=n,__reflect(n.prototype,"L2SkillCfg",[])},function(t,e){var n=function(){function t(t){this.params=t}return Object.defineProperty(t.prototype,"duration",{get:function(){return this.params.duration},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this.params.name},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"buffType",{get:function(){return this.params.buffType},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"attrNumAdd",{get:function(){return this.params.attrNumAdd},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"attrPercAdd",{get:function(){return this.params.attrPercAdd},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"triggerSkill",{get:function(){return this.params.triggerSkill},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"skillTriggerTime",{get:function(){return this.params.skillTriggerTime},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"skillTriggerDudgeFunc",{get:function(){return this.params.skillTriggerDudgeFunc},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"triggerFunc",{get:function(){return this.params.triggerFunc},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"funcTriggerType",{get:function(){return this.params.funcTriggerType},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"funcTriggerDudgeFunc",{get:function(){return this.params.funcTriggerDudgeFunc},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"status",{get:function(){return this.params.status},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isShowInPanel",{get:function(){return this.params.isShowInPanel},enumerable:!1,configurable:!0}),t}();window.L2BuffCfg=n,__reflect(n.prototype,"L2BuffCfg",[]);var r;!function(t){t[t.HpChange=0]="HpChange",t[t.BuffAdd=1]="BuffAdd",t[t.BuffRemove=2]="BuffRemove",t[t.AfterNormalAttak=3]="AfterNormalAttak",t[t.BeforeNormalAttak=4]="BeforeNormalAttak",t[t.AfterAction=5]="AfterAction",t[t.BeforeAction=6]="BeforeAction"}(r||(r={})),window.L2TriggerTimeType=r;var i;!function(t){t[t.Passive=0]="Passive",t[t.AttrChange=1]="AttrChange",t[t.Status=2]="Status"}(i||(i={})),window.L2BuffType=i;var a;!function(t){t[t.Normal=0]="Normal",t[t.Dizz=1]="Dizz",t[t.Slient=2]="Slient"}(a||(a={})),window.L2BuffStatus=a},function(t,e){var n=function(){function t(){}return t.SkillCfg={0:new L2SkillCfg({name:"普通攻击",effectRange:1,castRange:5,castFunc:function(t,e){var n=SceneManager.Ins.curScene,r=n.skillManager.currentSkillTargets[0];e.to({x:r.x,y:r.y,scaleX:1.5,scaleY:1.5},250).call(function(){console.log(t.debugNAndP()+" atk "+r.debugNAndP()),L2SkillCfg.harm(t,r)}).to({x:t.Cell.x,y:t.Cell.y,scaleX:1,scaleY:1},250)}})},t.BuffCfg={0:new L2BuffCfg({duration:2,name:"测试BUFF",buffType:L2BuffType.Passive,triggerFunc:function(t){t.showBuffName(),t.target.hpChange(200)},funcTriggerType:L2TriggerTimeType.BeforeAction,funcTriggerDudgeFunc:function(t){return SceneManager.Ins.curScene.timeManager.curChar==t.target?!0:!1}})},t}();window.L2Config=n,__reflect(n.prototype,"L2Config",[])},function(t,e){var n=function(t){function e(e,n,r){var i=t.call(this)||this;return i.defaultColor=ColorDef.Tan,i.width=e,Util.drawSquar(i,e,i.defaultColor),i.touchEnabled=!0,i.rowX=n,i.colY=r,i.addEventListener(egret.TouchEvent.TOUCH_TAP,i.onTap,i),i}return __extends(e,t),e.prototype.changeColor=function(t){Util.drawSquar(this,this.width,t)},e.prototype.disTo=function(t){return Math.abs(t.colY-this.colY)+Math.abs(t.rowX-this.rowX)},e.prototype.rangeCells=function(t){return SceneManager.Ins.curScene.board.rangeCells(this,t)},e.prototype.getBetweenCells=function(){return SceneManager.Ins.curScene.board.getBetweenCells(this)},e.prototype.onTap=function(){MessageManager.Ins.sendMessage(MessageType.L2CELLTAP,this),MessageManager.Ins.sendMessage(MessageType.L2USEENERGY,this)},e.prototype.release=function(){this["char"]=null},e}(egret.Shape);window.L2Cell=n,__reflect(n.prototype,"L2Cell",[])},function(t,e){var n=function(){function t(){var e=10,n=12;this.maxRowX=e-1,this.maxColY=n-1;var r=[],i=GameRoot.StageWidth/e;this.cellWidth=i;var a=i-t.cellDis;this.realCellWidth=a;for(var o=0;e>o;o++){for(var s=this.getCellX(o),l=[],c=0;n>c;c++){var u=this.getCellY(c),h=new L2Cell(a,o,c);l.push(h),LayerManager.Ins.gameLayer.addChild(h),h.x=s,h.y=u}r.push(l)}this.cells=r}return t.prototype.getCellX=function(t){return t*this.cellWidth},t.prototype.getCellY=function(e){return t.colStartDis+e*this.cellWidth},t.prototype.getBetweenCells=function(t){var e=t.rowX,n=t.colY,r=[];return 0!=e&&r.push(this.cells[e-1][n]),e!=this.maxRowX&&r.push(this.cells[e+1][n]),0!=n&&r.push(this.cells[e][n-1]),n!=this.maxColY&&r.push(this.cells[e][n+1]),r},t.prototype.rangeCells=function(t,e){var n=new MySet,r=new MySet,i=new MySet;for(r.add(t),i.add(t);r.data.length>0;){var a=r.data.pop();if(a.disTo(t)<=e){n.add(a);for(var o=0,s=this.getBetweenCells(a);o<s.length;o++){var l=s[o];!Util.contains(i.data,l)&&l.disTo(t)<e&&(r.add(l),i.add(l))}}}return n.data},t.prototype.resetCellsColor=function(){for(var t=0,e=this.cells;t<e.length;t++)for(var n=e[t],r=0,i=n;r<i.length;r++){var a=i[r];a.changeColor(ColorDef.Tan)}},t.prototype.release=function(){for(var t=0,e=this.cells;t<e.length;t++)for(var n=e[t],r=0,i=n;r<i.length;r++){var a=i[r];a.release()}},t.cellDis=3,t.colStartDis=200,t}();window.L2CellBoard=n,__reflect(n.prototype,"L2CellBoard",[])},function(t,e){var n=function(t){function e(n,i,a){var o=t.call(this)||this;o.nowTime=0,o.timePrior=100,o.camp=a,o.bgWidth=n,o.width=n,o.height=n,o.alive=!0,o.rawAttr=new L2CharAttr,o.attr=new L2CharAttr,o.hp=0,o.imgName=i;var s=new egret.Shape,l=a==r.Player?ColorDef.LimeGreen:ColorDef.DarkRed;Util.drawSquar(s,n,l),o.addChild(s),o.hpMask=new egret.Shape,s.mask=o.hpMask,o.addChild(o.hpMask),o.drawHpCircle(1);var c=n-2*e.hpBoardWidth,u=new eui.Image(i);u.width=1.6*c,u.height=u.width;var h=(u.width-c)/2;return u.mask=new egret.Rectangle(h,h,c,c),o.addChild(u),u.x=-h+e.hpBoardWidth,u.y=u.x,o.timeBarPort=new L2TimeBarPort(i,o),o.buffs=new MySet,o.addEventListener(egret.TouchEvent.TOUCH_TAP,o.onTap,o),o}return __extends(e,t),Object.defineProperty(e.prototype,"HP",{get:function(){return this.hp},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"Cell",{get:function(){return this.cell},set:function(t){var e=null;null!=this.cell&&(e=this.cell),this.cell=t,null!=e&&(e["char"]=null),null!=t&&(t["char"]=this)},enumerable:!1,configurable:!0}),e.prototype.placeToCell=function(){null!=this.cell&&(this.x=this.cell.x,this.y=this.cell.y)},e.prototype.hpChange=function(t){t=Math.ceil(t);var e=t+this.hp;return this.hp=Util.clamp(e,0,this.attr.maxHp),this.drawHpCircle(this.hp/this.attr.maxHp),this.harmFloat(-t,!1),0!=this.hp&&0>t&&egret.Tween.get(this).to({rotation:-15},60).to({rotation:15},120).to({rotation:0},60),0==this.hp&&(console.log(this.debugNAndP()+" dead"),this.alive=!1,this.Cell=null,Util.safeRemoveFromParent(this.timeBarPort),Util.safeRemoveFromParent(this)),this.hp},e.prototype.hpChangeTo=function(t){var e=t-this.hp;this.hpChange(e)},Object.defineProperty(e.prototype,"NowTime",{get:function(){return this.nowTime},enumerable:!1,configurable:!0}),e.prototype.onTap=function(){MessageManager.Ins.sendMessage(MessageType.L2CHARTAP,this)},e.prototype.setTime=function(t){this.nowTime=t,this.timeBarPort.setTime(t)},e.prototype.highLight=function(){egret.Tween.get(this).to({alpha:.2},250).to({alpha:1},250)},e.prototype.drawCircle=function(t,e,n){var r=-90;e-=90,Util.drawAngleCircle(t,e,n,r)},e.prototype.drawHpCircle=function(t){this.hpMask.x=0,this.hpMask.y=0,this.drawCircle(this.hpMask,360*t,this.bgWidth),this.hpMask.x=this.bgWidth/2,this.hpMask.y=this.bgWidth/2},e.prototype.startAction=function(){var t=this;console.log(this.debugNAndP()+" action");var e=egret.Tween.get(this),n=this.findMinDisOppose(),r=SceneManager.Ins.curScene;if(r.skillManager.currentSkillTargets=[n],this.isInAtkRange(n))r.skillManager.pushSkill(L2Config.SkillCfg[0],this);else{var i=this.allMovableCells();i.sort(function(e,r){var i=e.disTo(n.cell)-r.disTo(n.cell);return 0==i&&(i=e.disTo(t.cell)-r.disTo(t.cell)),i});var a=i[0];r.isCharMoveEnd=!1,this.moveTo(a,e),e.call(function(){r.isCharMoveEnd=!0,t.isInAtkRange(n)&&r.skillManager.pushSkill(L2Config.SkillCfg[0],t)})}},e.prototype.moveTo=function(t,e){console.log(this.debugNAndP()+" move to "+t.rowX+", "+t.colY),this.Cell=t,e.to({x:t.x,y:t.y},800)},e.prototype.debugNAndP=function(){return this.name+" - "+this.cell.rowX+","+this.cell.colY},e.prototype.findMinDisOppose=function(){var t=this,e=SceneManager.Ins.curScene,n=this.camp==r.Player?e.enemies:e.players;return n=n.filter(function(t){return 1==t.alive}),n.sort(function(e,n){var r=t.disToChar(e)-t.disToChar(n);return 0!=r?r:e.hp-n.hp}),n[0]},e.prototype.isInAtkRange=function(t){return this.isCellInAtkRange(t.cell)},e.prototype.refreshBuffStatus=function(){},e.prototype.refreshBuffAttr=function(){},e.prototype.isCellInAtkRange=function(t){var e=t.disTo(this.cell);return e<=this.attr.atkRange?!0:!1},e.prototype.allMovableCells=function(){for(var t=this.cell.rangeCells(this.attr.moveRange),e=[],n=0,r=t;n<r.length;n++){var i=r[n];i!=this.cell&&null==i["char"]&&e.push(i)}return e},e.prototype.disToChar=function(t){return this.disToCell(t.cell)},e.prototype.disToCell=function(t){return null==this.cell||null==t?-1:this.cell.disTo(t)},e.prototype.harmFloat=function(t,e){if(this.alive){var n="",r="miss",i=25,a=0;if(t=Math.ceil(t),0!=t){i=e?30:25;var o=0>t;r=e?"暴击 ":"",a=o?ColorDef.LimeGreen:e?ColorDef.DarkRed:ColorDef.Red,n=""+(o?"+":"")+-t}ToastInfoManager.newToast(""+r+n,a,this.y+this.width/2,this.x-GameRoot.GameStage.stageWidth/2+this.width/2,-50,0,2e3,i,!1,egret.Ease.quadOut)}},e.prototype.release=function(){this.timeBarPort.release(),this.timeBarPort=null,this.hpMask=null,this.cell=null},e.hpBoardWidth=3,e}(eui.Group);window.L2Char=n,__reflect(n.prototype,"L2Char",[]);var r;!function(t){t[t.Enemy=1]="Enemy",t[t.Player=-1]="Player"}(r||(r={})),window.L2Camp=r},function(t,e){var n=function(){function t(){this.atk=100,this.def=20,this.maxHp=1e3,this.startTime=50,this.actionSpeed=0,this.moveRange=5,this.atkRange=2,this.harmIncrease=0,this.harmDecrease=0,this.injureIncrease=0,this.injureDecrease=0}return t}();window.L2CharAttr=n,__reflect(n.prototype,"L2CharAttr",[])},function(t,e){var n=function(){function t(){this.energyNum=0}return t.prototype.useEnergy=function(t){return this.energyNum<t?void console.error("使用的能量超过上限"):(this.energyNum-=t,void SceneManager.Ins.curScene.mainUI.removeFires(t))},t.prototype.addEnergy=function(e){this.energyNum+=e;var n=0;this.energyNum>10&&(n=this.energyNum-t.MaxEnergy,this.energyNum=10);var r=SceneManager.Ins.curScene;r.mainUI.addFires(e-n)},t.prototype.removeEnergy=function(t){this.energyNum-=t;var e=0;this.energyNum<0&&(e=this.energyNum,this.energyNum=10),SceneManager.Ins.curScene.mainUI.removeFires(t-e)},t.MaxEnergy=10,t}();window.L2EnergyManager=n,__reflect(n.prototype,"L2EnergyManager",[])},function(t,e){var n=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._resLoad=new ResAsyncLoader,e.energyNum=0,e.isPause=!1,e.isCharMoveEnd=!0,e}return __extends(e,t),e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this._resLoad.loadGroup("portrait",0,LayerManager.Ins.loadingUI)];case 1:return t.sent(),[2]}})})},e.prototype.initial=function(){this.board=new L2CellBoard,this.players=[],this.enemies=[];for(var t=1;6>t;t++){var e=new L2Char(this.board.realCellWidth,3*t+"_portrait_png",1-t%2*2);e.attr.startTime=20*t,e.attr.actionSpeed=5*t,e.attr.maxHp=1e3,e.hpChangeTo(e.attr.maxHp),e.attr.atk=100,e.attr.def=20,e.attr.moveRange=5,e.attr.atkRange=t%2+1,e.name=""+t,e.camp==L2Camp.Player?this.players.push(e):this.enemies.push(e)}for(var n=1,r=0,i=this.enemies.concat(this.players);r<i.length;r++){var a=i[r];LayerManager.Ins.gameLayer.addChild(a),a.Cell=this.board.cells[n][n],a.placeToCell(),n+=1}this.mainUI=new L2MainUI,LayerManager.Ins.uiLayer.addChild(this.mainUI),this.timeManager=new L2TimeManager,this.energyManager=new L2EnergyManager,this.status=new L2SceneStatusNormal,this.skillManager=new L2SkillManager,this.buffManager=new L2BuffManager,this.buffManager.initial();var o=this.buffManager.newBuff(L2Config.BuffCfg[0],null);this.buffManager.attachBuff2Char(o,this.enemies[0]),MessageManager.Ins.addEventListener(MessageType.L2CELLTAP,this.cellTap,this),MessageManager.Ins.addEventListener(MessageType.L2CHARTAP,this.charTap,this),MessageManager.Ins.addEventListener(MessageType.L2TIMEPORTTAP,this.timePortTap,this)},e.prototype.update=function(){if(!this.isPause&&this.isCharMoveEnd&&!this.skillManager.IsInSkillProcess){null!=this.timeManager.curChar&&this.timeManager.afterCharNormalAction();var t=this.timeManager.toNextChar();MessageManager.Ins.sendMessage(MessageType.L2BuffTriggerTime,L2TriggerTimeType.BeforeAction),t.startAction()}},e.prototype.charTap=function(t){var e=t.messageContent;this.status.charTap(e)},e.prototype.timePortTap=function(t){var e=t.messageContent;this.status.timePortTap(e)},e.prototype.cellTap=function(t){if(this.isCharMoveEnd&&!this.skillManager.IsInSkillProcess){var e=t.messageContent;this.status.cellTap(e)}},e.prototype.release=function(){for(var t=0,e=this.players.concat(this.enemies);t<e.length;t++){var n=e[t];n.release()}this.players=null,this.enemies=null,this.timeManager.release(),this.timeManager=null,this.mainUI.release(),this.mainUI=null,this.board.release(),this.board=null,this.skillManager.release(),this.skillManager=null,this.buffManager.release(),this.buffManager=null},e.prototype.releaseResource=function(){this._resLoad.releaseResource()},e.cellDis=2,e.colStartDis=200,e}(IScene);window.L2MainScene=n,__reflect(n.prototype,"L2MainScene",[])},function(t,e){var n=function(){function t(){this.globalTime=0,this.roundNum=1}return t.prototype.getAliveChars=function(){for(var t=SceneManager.Ins.curScene,e=[],n=0,r=t.enemies.concat(t.players);n<r.length;n++){var i=r[n];i.alive&&e.push(i)}return e},t.prototype.toNextChar=function(){for(var t=this.getAliveChars(),e=t.sort(function(t,e){return t.NowTime-e.NowTime}),n=e[0].NowTime,r=[],i=0,a=e;i<a.length;i++){var o=a[i];if(o.NowTime!=n)break;r.push(o)}var s=r.sort(function(t,e){return t.timePrior-e.timePrior}),l=s[0],c=l.NowTime;l.setTime(0);for(var u=0,h=e;u<h.length;u++){var o=h[u];o!=l&&o.setTime(o.NowTime-c)}this.globalTime+=c;var f=SceneManager.Ins.curScene;return f.mainUI.timePointLabel.text=""+this.globalTime,this.curChar=l,l},t.prototype.afterCharNormalAction=function(){var e=this.curChar;if(null==e)return void console.error("不应该出现这种情况");var n=e.attr.actionSpeed,r=t.SpeedM,i=t.defBackTime;e.setTime(Math.ceil(i*(.5+.5*n/(n+r))));for(var a=this.getAliveChars(),o=100,s=0,l=a;s<l.length;s++){var c=l[s];e.NowTime==c.NowTime&&c.timePrior>=o&&(o=e.timePrior+1)}e.timePrior=o,e.timeBarPort.moveToTop(),this.curChar=null,this.roundAdd()},t.prototype.charAddTime=function(t,e,n){void 0===n&&(n=-1)},t.prototype.roundAdd=function(){this.roundNum+=1,this.roundNum%3==0&&SceneManager.Ins.curScene.energyManager.addEnergy(1),SceneManager.Ins.curScene.mainUI.roundLabel.text=""+this.roundNum},t.prototype.release=function(){this.curChar=null},t.SpeedM=100,t.defBackTime=50,t}();window.L2TimeManager=n,__reflect(n.prototype,"L2TimeManager",[])},function(t,e){var n=function(){function t(){}return t.prototype.initial=function(t){void 0===t&&(t=null)},t.prototype.changeTo=function(t,e){void 0===e&&(e=null);var n=SceneManager.Ins.curScene;n.status=t,t.initial(e)},t.prototype.charTap=function(t){},t.prototype.timePortTap=function(t){var e=SceneManager.Ins.curScene;t["char"].highLight(),e.isPause=!0},t.prototype.cellTap=function(t){},t.prototype.toCommandMod=function(){var t=SceneManager.Ins.curScene;t.focusChar=t.players[0],t.isPause=!0,this.changeTo(new i)},t.prototype.back=function(){SceneManager.Ins.setScene(new MainScene)},t.prototype.moveButtonTap=function(){},t}();window.IL2MainSceneStatus=n,__reflect(n.prototype,"IL2MainSceneStatus",[]);var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initial=function(){var t=SceneManager.Ins.curScene,e=t.mainUI;e.selectBarGroup.visible=!1,e.skillGroup.visible=!1,e.commandButton.visible=!0,e.showInfoImage.visible=!1,t.isPause=!1,e.commandModeLabel.visible=!1,t.board.resetCellsColor()},e.prototype.charTap=function(t){var e=SceneManager.Ins.curScene;e.focusChar=t,this.changeTo(new i)},e.prototype.cellTap=function(t){},e}(n);window.L2SceneStatusNormal=r,__reflect(r.prototype,"L2SceneStatusNormal",[]);var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initial=function(){var t=SceneManager.Ins.curScene,e=t.mainUI,n=t.focusChar;t.board.resetCellsColor(),e.selectBarGroup.visible=!1,e.commandButton.visible=!1,e.showInfoImage.visible=!0,e.skillGroup.visible=n.camp==L2Camp.Player,e.skill1Button.visible=!0,e.skill2Button.visible=!0,e.commandModeLabel.visible=!0,t.isPause=!0,e.showInfoImage.source=""+n.imgName;var r=n.allMovableCells();this.moveableCells=r;for(var i=n.camp==L2Camp.Player?ColorDef.LimeGreen:ColorDef.Orange,a=0,o=r;a<o.length;a++){var s=o[a];s.changeColor(i)}},e.prototype.charTap=function(t){var e=SceneManager.Ins.curScene;e.focusChar=t,e.isPause=!0,this.initial()},e.prototype.cellTap=function(t){var e=SceneManager.Ins.curScene;if(Util.contains(this.moveableCells,t)||(ToastInfoManager.newToast("退出指令模式，战斗恢复"),this.back()),Util.contains(this.moveableCells,t)&&e.focusChar.camp==L2Camp.Player){if(e.energyManager.energyNum<1)return void ToastInfoManager.newToast("移动所需能量不足");this.changeTo(new a,[t,this.moveableCells]),this.moveableCells=null}},e.prototype.back=function(){this.changeTo(new r),SceneManager.Ins.curScene.isPause=!1},e}(n);window.L2SceneStatusShowInfo=i,__reflect(i.prototype,"L2SceneStatusShowInfo",[]);var a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initial=function(t){var e=SceneManager.Ins.curScene,n=e.mainUI,r=e.focusChar;this.tapCell=t[0],n.selectBarGroup.visible=!1,n.commandButton.visible=!1,n.showInfoImage.visible=!1,n.skillGroup.visible=!0,n.skill1Button.visible=!1,n.skill2Button.visible=!1,n.commandModeLabel.visible=!1,e.isPause=!0,this.moveableCells=t[1],r.x=t[0].x,r.y=t[0].y,r.highLight()},e.prototype.cellTap=function(t){Util.contains(this.moveableCells,t)?this.initial([t,this.moveableCells]):ToastInfoManager.newToast("超出移动范围")},e.prototype.back=function(){var t=SceneManager.Ins.curScene,e=t.focusChar;e.x=e.Cell.x,e.y=e.Cell.y,this.moveableCells=null,this.changeTo(new i)},e.prototype.moveButtonTap=function(){var t=SceneManager.Ins.curScene;t.energyManager.useEnergy(1),t.focusChar.Cell=this.tapCell,this.moveableCells=null,this.tapCell=null,this.changeTo(new i)},e}(n);window.L2SceneStatusMoveSelect=a,__reflect(a.prototype,"L2SceneStatusMoveSelect",[])},function(t,e){var n=function(){function t(){}return t.prototype.initial=function(t,e){this.config=t,this.caster=e,this.duration=t.duration,this.children=[]},t.prototype.attach2Char=function(t){this.target=t,this.config.buffType==L2BuffType.AttrChange&&t.refreshBuffAttr()},t.prototype.showBuffName=function(){if(""!=this.config.name){var t=ColorDef.White,e=30;ToastInfoManager.newToast(this.config.name,t,this.target.y-15,this.target.x-GameRoot.GameStage.stageWidth/2+this.target.width/2,-50,0,2e3,e,!0,egret.Ease.quadOut)}},t.prototype.removeFromTarget=function(){var t=this.target;t.buffs.remove(this);for(var e=0,n=this.children;e<n.length;e++){var r=n[e];r.removeFromTarget()}this.config.buffType==L2BuffType.Status&&t.refreshBuffStatus(),this.config.buffType==L2BuffType.AttrChange&&t.refreshBuffAttr()},t.prototype.release=function(){this.children=null,this.target=null,this.caster=null},t}();window.L2Buff=n,__reflect(n.prototype,"L2Buff",[])},function(t,e){var n=function(){function t(){}return t.prototype.initial=function(){this.buffPool=[],this.buffs=[],MessageManager.Ins.addEventListener(MessageType.L2BuffTriggerTime,this.buffTrigger,this)},t.prototype.newBuff=function(t,e){var n=this.buffPool.length>0?this.buffPool.pop():new L2Buff;return n.initial(t,e),this.buffs.push(n),n},t.prototype.attachBuff2Char=function(t,e){t.attach2Char(e),t.showBuffName()},t.prototype.changeBuffDuration=function(t,e){t.duration+=e,t.duration<=0&&(t.removeFromTarget(),t.release(),Util.removeObjFromArray(this.buffs,t),this.buffPool.push(t))},t.prototype.buffTrigger=function(t){for(var e=t.messageContent,n=0,r=this.buffs;n<r.length;n++){var i=r[n];i.config.buffType==L2BuffType.Passive&&(i.config.funcTriggerType==e&&i.config.funcTriggerDudgeFunc(i)&&i.config.triggerFunc(i),i.config.skillTriggerTime==e&&i.config.skillTriggerDudgeFunc(i)&&SceneManager.Ins.curScene.skillManager.pushSkill(i.config.triggerSkill,i.target))}},t.prototype.release=function(){this.buffPool=null;for(var t=0,e=this.buffs;t<e.length;t++){var n=e[t];n.release()}this.buffs=null},t}();window.L2BuffManager=n,__reflect(n.prototype,"L2BuffManager",[])},function(t,e){var n=function(){function t(){this.waitingSkillList=[],this.isInSkillProcess=!1}return Object.defineProperty(t.prototype,"IsInSkillProcess",{get:function(){return this.isInSkillProcess},enumerable:!1,configurable:!0}),t.prototype.pushSkill=function(t,e){if(this.waitingSkillList.push([t,e]),!this.isInSkillProcess){var n=this.waitingSkillList.shift();this.castSkill(n[0],n[1])}},t.prototype.castSkill=function(t,e){var n=this;this.isInSkillProcess=!0;var r=egret.Tween.get(e);t.castFunc(e,r),r.call(function(){if(0==n.waitingSkillList.length)n.isInSkillProcess=!1;else{var t=n.waitingSkillList.shift();n.castSkill(t[0],t[1])}})},t.prototype.release=function(){this.currentSkillTargets=null,this.waitingSkillList=null},t}();window.L2SkillManager=n,__reflect(n.prototype,"L2SkillManager",[])}]);