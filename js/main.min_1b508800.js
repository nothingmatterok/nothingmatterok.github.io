var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},__extends=function(t,e){function n(){this.constructor=t}extendStatics(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},__assign=Object.assign||function(t){for(var e,n=1,i=arguments.length;i>n;n++){e=arguments[n];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},__rest=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]]);return n},__decorate=function(t,e,n,i){var r,a=arguments.length,o=3>a?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,n,i);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(o=(3>a?r(o):a>3?r(e,n,o):r(e,n))||o);return a>3&&o&&Object.defineProperty(e,n,o),o},__param=function(t,e){return function(n,i){e(n,i,t)}},__metadata=function(t,e){return"object"==typeof Reflect&&"function"==typeof Reflect.metadata?Reflect.metadata(t,e):void 0},__awaiter=function(t,e,n,i){function r(t){return t instanceof n?t:new n(function(e){e(t)})}return new(n||(n=Promise))(function(n,a){function o(t){try{c(i.next(t))}catch(e){a(e)}}function s(t){try{c(i["throw"](t))}catch(e){a(e)}}function c(t){t.done?n(t.value):r(t.value).then(o,s)}c((i=i.apply(t,e||[])).next())})},__generator=function(t,e){function n(t){return function(e){return i([t,e])}}function i(n){if(r)throw new TypeError("Generator is already executing.");for(;c;)try{if(r=1,a&&(o=2&n[0]?a["return"]:n[0]?a["throw"]||((o=a["return"])&&o.call(a),0):a.next)&&!(o=o.call(a,n[1])).done)return o;switch(a=0,o&&(n=[2&n[0],o.value]),n[0]){case 0:case 1:o=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,a=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(o=c.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){c.label=n[1];break}if(6===n[0]&&c.label<o[1]){c.label=o[1],o=n;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(n);break}o[2]&&c.ops.pop(),c.trys.pop();continue}n=e.call(t,c)}catch(i){n=[6,i],a=0}finally{r=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,a,o,s,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},__exportStar=function(t,e){for(var n in t)"default"===n||e.hasOwnProperty(n)||__createBinding(e,t,n)},__createBinding=Object.create?function(t,e,n,i){void 0===i&&(i=n),Object.defineProperty(t,i,{enumerable:!0,get:function(){return e[n]}})}:function(t,e,n,i){void 0===i&&(i=n),t[i]=e[n]},__values=function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},__read=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var i,r,a=n.call(t),o=[];try{for(;(void 0===e||e-->0)&&!(i=a.next()).done;)o.push(i.value)}catch(s){r={error:s}}finally{try{i&&!i.done&&(n=a["return"])&&n.call(a)}finally{if(r)throw r.error}}return o},__spread=function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(__read(arguments[e]));return t},__spreadArrays=function(){for(var t=0,e=0,n=arguments.length;n>e;e++)t+=arguments[e].length;for(var i=Array(t),r=0,e=0;n>e;e++)for(var a=arguments[e],o=0,s=a.length;s>o;o++,r++)i[r]=a[o];return i},__await=function(t){return this instanceof __await?(this.v=t,this):new __await(t)},__asyncGenerator=function(t,e,n){function i(t){l[t]&&(u[t]=function(e){return new Promise(function(n,i){h.push([t,e,n,i])>1||r(t,e)})})}function r(t,e){try{a(l[t](e))}catch(n){c(h[0][3],n)}}function a(t){t.value instanceof __await?Promise.resolve(t.value.v).then(o,s):c(h[0][2],t)}function o(t){r("next",t)}function s(t){r("throw",t)}function c(t,e){t(e),h.shift(),h.length&&r(h[0][0],h[0][1])}if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var u,l=n.apply(t,e||[]),h=[];return u={},i("next"),i("throw"),i("return"),u[Symbol.asyncIterator]=function(){return this},u},__asyncDelegator=function(t){function e(e,r){n[e]=t[e]?function(n){return(i=!i)?{value:__await(t[e](n)),done:"return"===e}:r?r(n):n}:r}var n,i;return n={},e("next"),e("throw",function(t){throw t}),e("return"),n[Symbol.iterator]=function(){return this},n},__asyncValues=function(t){function e(e){i[e]=t[e]&&function(i){return new Promise(function(r,a){i=t[e](i),n(r,a,i.done,i.value)})}}function n(t,e,n,i){Promise.resolve(i).then(function(e){t({value:e,done:n})},e)}if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,r=t[Symbol.asyncIterator];return r?r.call(t):(t="function"==typeof __values?__values(t):t[Symbol.iterator](),i={},e("next"),e("throw"),e("return"),i[Symbol.asyncIterator]=function(){return this},i)},__makeTemplateObject=function(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t},__setModuleDefault=Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t["default"]=e},__importStar=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&__createBinding(e,t,n);return __setModuleDefault(e,t),e},__importDefault=function(t){return t&&t.__esModule?t:{"default":t}},__classPrivateFieldGet=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)},__classPrivateFieldSet=function(t,e,n){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,n),n},__reflect=function(t,e,n){t.__class__=e,n?n.push(e):n=[e],t.__types__=t.__types__?n.concat(t.__types__):n};!function(t){function e(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var n={};return e.m=t,e.c=n,e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:i})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(e.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var r in t)e.d(i,r,function(e){return t[e]}.bind(null,r));return i},e.n=function(t){var n=t&&t.__esModule?function(){return t["default"]}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(t,e,n){n(1),n(2),n(3),n(4),n(5),n(6),n(7),n(8),n(9),n(10),n(11),n(12),n(13),n(14),n(15),n(16),n(17),n(18),n(19),n(20),n(21),n(22),n(23),n(24),n(25),n(26),n(27),n(28),n(29),n(30),n(31),n(32),n(33),n(34),n(35),n(36),n(37),n(38),n(39),n(40),n(41),n(42),n(43),n(44),n(45),n(46),n(47),n(48),n(49),n(50),n(51),n(52);var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return t=Util.createColorBG(this.stage.stageWidth,this.stage.stageHeight),this.stage.addChild(t),[4,this.loadResource()];case 1:return e.sent(),GameRoot.Ins.init(this.stage),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,4,,5]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return n.sent(),[4,this.loadTheme()];case 2:return n.sent(),[4,RES.loadGroup("preload",0,t)];case 3:return n.sent(),this.stage.removeChild(t),[3,5];case 4:return e=n.sent(),console.error(e),[3,5];case 5:return[2]}})})},e.prototype.loadTheme=function(){var t=this;return new Promise(function(e,n){var i=new eui.Theme("resource/default.thm.json",t.stage);i.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})},e}(eui.UILayer);window.Main=i,__reflect(i.prototype,"Main",[])},function(t,e){var n=function(){function t(){}return t.prototype.getAsset=function(t,e,n){function i(i){e.call(n,i,t)}if(RES.hasRes(t)){var r=RES.getRes(t);r?i(r):RES.getResAsync(t,i,this)}else RES.getResByUrl(t,i,this,RES.ResourceItem.TYPE_IMAGE)},t}();window.AssetAdapter=n,__reflect(n.prototype,"AssetAdapter",["eui.IAssetAdapter"])},function(t,e){var n="https://1062258897406555.cn-shanghai.fc.aliyuncs.com/2016-08-15/proxy/python_serve/simple_verify/";window.VERIFYURL=n},function(t,e){var n=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();window.DebugPlatform=n,__reflect(n.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new n)},function(t,e){var n=function(){function t(){}return t.prototype.getTheme=function(t,e,n,i){function r(t){e.call(i,t)}function a(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),n.call(i))}var o=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){e.call(i,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(t,n){window.JSONParseClass.setData(t),egret.callLater(function(){e.call(i,generateEUI2)},o)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(t.indexOf(".exml")>-1){var s=t.split("/");s.pop();var c=s.join("/")+"_EUI.json";generateJSON.paths[t]?egret.callLater(function(){e.call(i,generateJSON.paths[t])},this):RES.getResByUrl(c,function(n){window.JSONParseClass.setData(n),egret.callLater(function(){e.call(i,generateJSON.paths[t])},o)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){e.call(i,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),RES.getResByUrl(t,r,this,RES.ResourceItem.TYPE_TEXT)},t}();window.ThemeAdapter=n,__reflect(n.prototype,"ThemeAdapter",["eui.IThemeAdapter"])},function(t,e){var n=function(t){function e(){var e=t.call(this)||this;return e._progressLabel=new eui.Label,e._progressLabel.horizontalCenter=0,e._progressLabel.verticalCenter=0,e._progressLabel.textColor=ColorDef.Coral,e.addChild(e._progressLabel),e}return __extends(e,t),e.prototype.initial=function(){var t=Util.createColorBG(GameRoot.GameStage.stageWidth,GameRoot.GameStage.stageHeight);this.addChildAt(t,0)},e.prototype.clear=function(){this._progressLabel.text="Loading..."},e.prototype.onProgress=function(t,e){this._progressLabel.text="Loading..."+t+"/"+e},e}(eui.UILayer);window.LoadingUI=n,__reflect(n.prototype,"LoadingUI",["RES.PromiseTaskReporter"])},function(t,e){var n=function(t){function e(){var e=t.call(this)||this;return e.width=GameRoot.StageWidth,e.height=GameRoot.StageHeight,e.addEventListener(eui.UIEvent.COMPLETE,e.mainUIEventInit,e),e}return __extends(e,t),e.prototype.mainUIEventInit=function(){this.l1StartButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.tol1,this),this.l2StartButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.tol2,this)},e.prototype.tol1=function(){SceneManager.Ins.setScene(new L1MainScene)},e.prototype.tol2=function(){SceneManager.Ins.setScene(new L2MainScene)},e}(eui.Component);window.MainUI=n,__reflect(n.prototype,"MainUI",[])},function(t,e){var n=function(t){function e(){var e=t.call(this)||this;return e.width=GameRoot.StageWidth,e.height=GameRoot.StageHeight,e.addEventListener(eui.UIEvent.COMPLETE,e.panelEventInit,e),e}return __extends(e,t),e.prototype.panelEventInit=function(){this.confirmButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.confirmPswd,this),this.clearLocalButton.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){UserData.clearLocalData()},this)},e.prototype.debugTap=function(){SceneManager.Ins.setScene(new L2MainScene)},e.prototype.confirmPswd=function(t){return 0==this.pswdTextInput.text.length?void alert("验证失败"):(this.confirmButton.enabled=!1,void Util.httpGet(VERIFYURL+this.pswdTextInput.text.substring(0,10),this.onGetComplete,this.onGetIOError,this.onGetProgress,this))},e.prototype.onGetComplete=function(t){var e=t.currentTarget,n=e.response.substring(0,1);return"y"!=n?(alert("验证失败"),void(this.confirmButton.enabled=!0)):(ToastInfoManager.newRedToast("验证成功"),void setTimeout(function(){SceneManager.Ins.setScene(new MainScene)},1e3))},e.prototype.onGetIOError=function(t){alert("网络错误"),this.confirmButton.enabled=!0},e.prototype.onGetProgress=function(t){},e}(eui.Component);window.StartPanel=n,__reflect(n.prototype,"StartPanel",[])},function(t,e){var n=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(eui.UIEvent.COMPLETE,e.UIEventInit,e),e}return __extends(e,t),e.prototype.UIEventInit=function(){var t=this;this.bgRect.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.visible=!1,t.curChar=null},this),MessageManager.Ins.addEventListener(MessageType.L1BATTLECHARTAP,this.charTap,this),MessageManager.Ins.addEventListener(MessageType.L1TOUCHLABELTAP,this.touchLabelTap,this)},e.prototype.charTap=function(t){var e=t.messageContent;this.curChar=e,this.visible=!0,this.charNameLabel.text=e.name,this.maxHpLabel.text=""+e.maxHp,this.hpRateRect.percentWidth=e.curHp/e.maxHp*100,this.atkNumLabel.text=""+e.atk,this.defNumLabel.text=""+e.def,this.dodgeLabel.text=""+e.dodgePoint,this.critPLabel.text=""+e.critPoint,this.critRLabel.text=""+e.critTime,this.rangeLabel.text=""+e.rawAttr.range,this._skillTouchLabel=[];for(var n in e.skills){var i=e.skills[n],r=new L1TouchLabel(i,e,null,0);r.x=120*parseInt(n)+5,this.skillScrollerGroup.addChild(r),this._skillTouchLabel.push(r)}for(var a={},o=0,s=e.buffs.data;o<s.length;o++){var c=s[o],u=c.config.id;u in a?a[u][1]+=1:""!=c.config.name&&(a[u]=[c.config,1])}var l=0;for(var u in a){var h=a[u],f=h[0],p=h[1],r=new L1TouchLabel(null,null,f,p);r.x=120*l+5,this.buffScrollerGroup.addChild(r),l+=1}this.descrGroup.visible=!1},e.prototype.touchLabelTap=function(t){var e=t.messageContent;this.descrGroup.visible=!0;var n=e.info[0],i=e.info[2],r="";n&&(r=n.config.descr),i&&(r=i.descr),this.descrLabel.text=r},e.prototype.update=function(){if(this.curChar){var t=this.curChar;this.maxHpLabel.text=""+t.maxHp,this.hpRateRect.percentWidth=t.curHp/t.maxHp*100,this.angerRateRect.percentWidth=t.curAnger/L1CharAttr.MAXANGER*100,this.atkNumLabel.text=""+t.atk,this.defNumLabel.text=""+t.def,this.dodgeLabel.text=""+t.dodgePoint,this.critPLabel.text=""+t.critPoint,this.critRLabel.text=""+t.critTime;for(var e=0,n=this._skillTouchLabel;e<n.length;e++){var i=n[e];i.updateSkillCd()}}},e}(eui.Component);window.L1BattleInfo=n,__reflect(n.prototype,"L1BattleInfo",[])},function(t,e){var n=function(t){function e(){var e=t.call(this)||this;return e.width=GameRoot.GameStage.stageWidth,e.height=GameRoot.GameStage.stageHeight,e.addEventListener(eui.UIEvent.COMPLETE,e.UIEventInit,e),e._selectIds=[],e}return __extends(e,t),e.prototype.update=function(){this.charBattleInfo.update()},e.prototype.battleEnd=function(t){t||(this.nextLevelButton.label="Retry"),this.nextLevelButton.visible=!0},e.prototype.UIEventInit=function(){this.backButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.backToL1MainScene,this),this.battleStartButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.battleStart,this),this.nextLevelButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.toNextLevel,this),MessageManager.Ins.addEventListener(MessageType.L1BATTLEUIPORTTAP,this.portTap,this);for(var t=0;t<UserData.l1Data.UserAllCharIds.length;t++){var e=UserData.l1Data.UserAllCharIds[t],n=new L1BattleUIPort(e);n.x=90*t,this.portImageGroup.addChild(n),UserData.l1Data.UserUseCharIds.indexOf(e)>=0&&(n.select(),this._selectIds.push(n.charId))}UserData.l1Data.levelType==L1LevelType.MainStory&&(this.mainStoryLevelName.visible=!0,this.mainStoryLevelName.text=UserData.l1Data.CurMainStoryId+1+"关")},e.prototype.toNextLevel=function(){SceneManager.Ins.setScene(new L1NormalBattleScene)},e.prototype.portTap=function(t){var e=t.messageContent,n=e.charId,i=SceneManager.Ins.curScene;return e.IsSelect?(e.selectCancle(),Util.removeObjFromArray(this._selectIds,e.charId),void i.removeChar(n)):4==this._selectIds.length?void ToastInfoManager.newRedToast("已满员"):(e.select(),this._selectIds.push(e.charId),void i.addChar(n))},e.prototype.backToL1MainScene=function(){SceneManager.Ins.setScene(new L1MainScene)},e.prototype.battleStart=function(){return 0==this._selectIds.length?void ToastInfoManager.newRedToast("无上场成员"):(UserData.l1Data.UserUseCharIds=this._selectIds,this.battleStartButton.visible=!1,SceneManager.Ins.curScene.battleStart(),void(this.portScroller.visible=!1))},e}(eui.Component);window.L1BattleSceneUI=n,__reflect(n.prototype,"L1BattleSceneUI",[])},function(t,e){var n=function(t){function e(e){var n=t.call(this)||this;n.charId=e;var i=L1CHARCFGS[e],r=i.portImageName,a=new eui.Image(r);a.width=120,a.height=120;var o=new eui.Rect(80,80);o.ellipseHeight=80,o.ellipseWidth=80,o.y=20,o.x=20,a.mask=o;var s=new eui.Rect(80,80);s.ellipseHeight=80,s.ellipseWidth=80,s.y=20,s.x=20,n._selectMask=s,s.fillColor=ColorDef.DimGray,s.alpha=.5;var c=new eui.Label;return c.text="上场",c.y=50,c.x=30,n._selectLable=c,n.addChild(a),n.addChild(o),n.addChild(s),n.addChild(c),n.selectCancle(),n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.touchTap,n),n}return __extends(e,t),Object.defineProperty(e.prototype,"IsSelect",{get:function(){return this._isSelect},enumerable:!1,configurable:!0}),e.prototype.touchTap=function(){MessageManager.Ins.sendMessage(MessageType.L1BATTLEUIPORTTAP,this)},e.prototype.select=function(){this._isSelect=!0,this._selectMask.visible=!0,this._selectLable.visible=!0},e.prototype.selectCancle=function(){this._isSelect=!1,this._selectMask.visible=!1,this._selectLable.visible=!1},e}(eui.Group);window.L1BattleUIPort=n,__reflect(n.prototype,"L1BattleUIPort",[])},function(t,e){var n=function(t){function e(){var e=t.call(this)||this;return e.width=GameRoot.GameStage.stageWidth,e.height=GameRoot.GameStage.stageHeight,e.addEventListener(eui.UIEvent.COMPLETE,e.UIEventInit,e),e}return __extends(e,t),e.prototype.UIEventInit=function(){this.backButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.backToMainScene,this),this.mainStoryButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.toL1BattleScene,this),this.roughlikeButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.toL1RoughlikeScene,this)},e.prototype.backToMainScene=function(){SceneManager.Ins.setScene(new MainScene)},e.prototype.toL1BattleScene=function(){UserData.l1Data.levelType=L1LevelType.MainStory,SceneManager.Ins.setScene(new L1NormalBattleScene)},e.prototype.toL1RoughlikeScene=function(){ToastInfoManager.newRedToast("敬请期待")},e}(eui.Component);window.L1MainUI=n,__reflect(n.prototype,"L1MainUI",[])},function(t,e){var n=function(t){function e(e,n,i,r){var a=t.call(this)||this;return a.info=[e,n,i,r],a.addEventListener(eui.UIEvent.COMPLETE,a.UIEventInit,a),a}return __extends(e,t),e.prototype.isCurSkill=function(){var t=this.info[1],e=this.info[0];return t.skills[t.curSkillIndex]==e},e.prototype.UIEventInit=function(){var t=this,e=this.info,n=e[0],i=(e[1],e[2]),r=e[3];if(n){this.nameLabel.text=n.config.name,this.skillCDLabel.visible=!0;var a=(n.config.cdMs/1e3).toFixed(2);this.skillCDLabel.text=a+"s"}i&&(this.nameLabel.text=i.name,this.buffTierLabel.visible=!0,this.buffTierLabel.text="x"+r),this.width=100,this.height=100,this.y=10,this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){MessageManager.Ins.sendMessage(MessageType.L1TOUCHLABELTAP,t)},this)},e.prototype.updateSkillCd=function(){var t=this.info[0];if(t){var e=t.CDRUN/GameRoot.GameStage.frameRate;if(0==e)this.skillCDLabel.visible=!1;else{this.skillCDLabel.visible=!0;var n=e.toFixed(2);this.skillCDLabel.text=n+"s"}this.cdRect.percentWidth=1e5*e/t.config.cdMs,this.isCurSkill()?this.skillPreStateLabel.visible=!0:this.skillPreStateLabel.visible=!1}},e}(eui.Component);window.L1TouchLabel=n,__reflect(n.prototype,"L1TouchLabel",[])},function(t,e){var n=function(t){function e(){var e=t.call(this)||this;return e.width=GameRoot.StageWidth,e.height=GameRoot.StageHeight,e.addEventListener(eui.UIEvent.COMPLETE,e.UIEventInit,e),e}return __extends(e,t),e.prototype.UIEventInit=function(){this.backButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.backToMainScene,this)},e.prototype.backToMainScene=function(){SceneManager.Ins.setScene(new MainScene)},e}(eui.Component);window.L2MainUI=n,__reflect(n.prototype,"L2MainUI",[])},function(t,e){var n=function(){function t(){}return t.addOutGlowFilter=function(e){t.addFilter(e,t._outerGlowFilter)},t.removeOutGlowFilter=function(e){t.removeFilter(e,t._outerGlowFilter)},t.addGreyFilter=function(e){t.addFilter(e,t._greyColorFlilter)},t.removeGreyFilter=function(e){t.removeFilter(e,t._greyColorFlilter)},t.addYellowGlow=function(e){t.addFilter(e,t._outerGlowYellowFilter)},t.removeYellowGlow=function(e){t.removeFilter(e,t._outerGlowYellowFilter)},t.removeFilter=function(t,e){return t.filters?(Util.removeObjFromArray(t.filters,e)||console.log("object have no such filter"),void(0==t.filters.length&&(t.filters=null))):void console.log("没有发现滤镜，不应该有这个情况噢")},t.addFilter=function(t,e){t.filters?t.filters.push(e):t.filters=[e]},t._outerGlowFilter=new egret.GlowFilter(3394815,1,40,40,2,3,!1,!1),t._outerGlowYellowFilter=new egret.GlowFilter(15658496,1,40,40,2,3,!1,!1),t._greyColorFlilter=new egret.ColorMatrixFilter([.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0]),t}();window.L2Filters=n,__reflect(n.prototype,"L2Filters",[])},function(t,e){var n=function(){function t(){this.data=[]}return t.prototype.add=function(t){var e=this.data;return e.indexOf(t)>=0?!1:(e.push(t),!0)},t.prototype.remove=function(t){return Util.removeObjFromArray(this.data,t)},t.prototype.removeAll=function(){this.data=[]},t.prototype.addList=function(t){for(var e=0,n=t;e<n.length;e++){var i=n[e];this.add(i)}},t}();window.MySet=n,__reflect(n.prototype,"MySet",[])},function(t,e){var n=function(){function t(){this._loadResouceLs=new MySet}return t.prototype.getResAsync=function(t,e,n){return this._loadResouceLs.add(t),null==e?RES.getResAsync(t):RES.getResAsync(t,e,n)},t.prototype.loadGroup=function(t,e,n){return this._loadResouceLs.add(t),RES.loadGroup(t,e,n)},t.prototype.getResAsyncAndSetValue=function(t,e,n){this.getResAsync(t,function(){n[e]=RES.getRes(t)},n)},t.prototype.releaseResource=function(){for(var t=0,e=this._loadResouceLs.data;t<e.length;t++){var n=e[t];RES.destroyRes(n)||console.warn("RES `"+n+"` destroy failed.")}},t}();window.ResAsyncLoader=n,__reflect(n.prototype,"ResAsyncLoader",[])},function(t,e){var n=function(){function t(){}return t.newToast=function(t,e,n,i,r,a,o,s,c,u){var l=this;void 0===e&&(e=ColorDef.DodgerBlue),void 0===n&&(n=60),void 0===i&&(i=0),void 0===r&&(r=-100),void 0===a&&(a=0),void 0===o&&(o=6e3),void 0===s&&(s=30),void 0===c&&(c=!0),void 0===u&&(u=egret.Ease.circOut);var h;h=this._labelPools.length>0?this._labelPools.pop():new eui.Label,h.textColor=e,h.horizontalCenter=i,h.y=n,h.alpha=1,h.size=s,h.text=t,h.bold=c,LayerManager.Ins.uiLayer.addChild(h),egret.Tween.get(h).to({y:h.y+r,horizontalCenter:h.horizontalCenter+a,alpha:0},o,u).call(function(){LayerManager.Ins.uiLayer.removeChild(h),l._labelPools.push(h)})},t.newRedToast=function(e){t.newToast(e,ColorDef.Coral)},t._labelPools=[],t}();window.ToastInfoManager=n,__reflect(n.prototype,"ToastInfoManager",[])},function(t,e){var n=function(){function t(){}return t.removeObjFromArray=function(t,e){var n=t.indexOf(e);return n>=0?(t.splice(n,1),!0):!1},t.createColorBG=function(t,e,n,i){void 0===n&&(n=ColorDef.DimGray),void 0===i&&(i=1);var r=new egret.Shape;return r.width=t,r.height=e,r.graphics.beginFill(n,i),r.graphics.drawRect(0,0,t,e),r.graphics.endFill(),r},t.safeRemoveFromParent=function(t){if(t){var e=t.parent;e&&e.removeChild(t)}},t.getRandomArray=function(t){for(var e=[],n=t.length;n>0;){var i=Math.floor(Math.random()*n);i==n&&(i-=1),e.push(t.splice(i,1)[0]),n-=1}return e},t.largeSmallTweenAnim=function(t,e,n,i){var r=t.x,a=t.y,o=t.width,s=t.height,c=o*e,u=s*n,l=r-(c-o)/2,h=a-(u-s)/2;egret.Tween.get(t,{loop:!0}).to({width:c,height:u,x:l,y:h},i).to({width:o,height:s,x:r,y:a},i)},t.httpGet=function(t,e,n,i,r){var a=new egret.HttpRequest;a.responseType=egret.HttpResponseType.TEXT,a.open(t,egret.HttpMethod.GET),a.send(),a.addEventListener(egret.Event.COMPLETE,e,r),a.addEventListener(egret.IOErrorEvent.IO_ERROR,n,r),a.addEventListener(egret.ProgressEvent.PROGRESS,i,r)},t.createBitmapByName=function(t){var e=new egret.Bitmap,n=RES.getRes(t);return e.texture=n,e},t.drawAngleCircle=function(t,e,n,r,a,o){void 0===r&&(r=0),void 0===a&&(a=ColorDef.DarkRed),void 0===o&&(o=1),t.graphics.clear(),t.graphics.beginFill(a,o),t.graphics.moveTo(0,0);var s=r*i,c=Math.cos(s)*n,u=Math.sin(s)*n;t.graphics.lineTo(c,u),t.graphics.drawArc(0,0,n,s,e*Math.PI/180),t.graphics.lineTo(0,0),t.graphics.endFill()},t.pointDistance=function(t,e){var n=t[0]-e[0],i=t[1]-e[1];return Math.sqrt(n*n+i*i)},t.getRad=function(e,n){var i=t.pointDistance(e,n),r=n[1]-e[1],a=n[0]-e[0],o=a/i,s=Math.acos(r/i);return o>0?s:-s},t.isNumEqual=function(t,e,n){return void 0===n&&(n=3),Math.abs(t-e)<n},t.degNormalize=function(t){return t%=360,t>180?t-360:-180>t?t+360:t},t}();window.Util=n,__reflect(n.prototype,"Util",[]);var i=Math.PI/180;window.angle2RadParam=i},function(t,e){},function(t,e){var n=function(){function t(){this._initialed=!1}return Object.defineProperty(t,"GameStage",{get:function(){return t.Ins._gameStage},enumerable:!1,configurable:!0}),Object.defineProperty(t,"StageWidth",{get:function(){return t.Ins._gameStage.stageWidth},enumerable:!1,configurable:!0}),Object.defineProperty(t,"StageHeight",{get:function(){return t.Ins._gameStage.stageHeight},enumerable:!1,configurable:!0}),Object.defineProperty(t,"Ins",{get:function(){return t._instance?t._instance:(t._instance=new t,t._instance)},enumerable:!1,configurable:!0}),t.prototype.init=function(t){UserData.initialData(),this._gameStage=t,MessageManager.Ins.initial(t),LayerManager.Ins.initial(),SceneManager.Ins.initial(),this._initialed=!0,this._gameStage.addEventListener(egret.Event.ENTER_FRAME,this.update,this)},t.prototype.update=function(){this._initialed&&SceneManager.Ins.update()},t}();window.GameRoot=n,__reflect(n.prototype,"GameRoot",[])},function(t,e){var n=function(){function t(){}return Object.defineProperty(t,"Ins",{get:function(){return null==this._instance&&(this._instance=new t),this._instance},enumerable:!1,configurable:!0}),t.prototype.initial=function(){this.loadingUI=new LoadingUI,this.loadingUI.initial(),this.uiLayer=new eui.UILayer,this.gameLayer=new egret.DisplayObjectContainer,GameRoot.GameStage.addChild(this.gameLayer),GameRoot.GameStage.addChild(this.uiLayer),GameRoot.GameStage.addChild(this.loadingUI)},t.prototype.showLoadingUILayer=function(){this.loadingUI.clear(),this.loadingUI.visible=!0,this.loadingUI.touchEnabled=!0},t.prototype.hideLoadingUILayer=function(){this.loadingUI.visible=!1,this.loadingUI.touchEnabled=!1},t.prototype.clear=function(){this.gameLayer.removeChildren(),this.uiLayer.removeChildren()},t}();window.LayerManager=n,__reflect(n.prototype,"LayerManager",[])},function(t,e){var n=function(t){function e(){var e=t.call(this)||this;return e._listenerList=[],e}return __extends(e,t),Object.defineProperty(e,"Ins",{get:function(){return null==this.instance&&(this.instance=new e),this.instance},enumerable:!1,configurable:!0}),e.prototype.initial=function(t){t.addChild(this)},e.prototype.sendMessage=function(t,e){void 0===e&&(e=null),this.dispatchEvent(new i(e,t))},e.prototype.addEventListener=function(e,n,i){t.prototype.addEventListener.call(this,e,n,i),this._listenerList.push([e,n,i])},e.prototype.clearListener=function(){for(var t=0,e=this._listenerList;t<e.length;t++){var n=e[t],i=n[0],r=n[1],a=n[2];this.removeEventListener(i,r,a)}this._listenerList=[]},e}(egret.DisplayObject);window.MessageManager=n,__reflect(n.prototype,"MessageManager",[]);var i=function(t){function e(e,n,i,r){void 0===i&&(i=!1),void 0===r&&(r=!1);var a=t.call(this,n,i,r)||this;return a.messageContent=e,a}return __extends(e,t),e}(egret.Event);window.Message=i,__reflect(i.prototype,"Message",[])},function(t,e){var n=function(){function t(){this._timeScale=1,this._frameCount=0,this._isFrame30Play=[];for(var t=0;30>t;t++)this._isFrame30Play[t]=!0}return Object.defineProperty(t.prototype,"TimeScale",{set:function(t){if(this._frameCount=0,t>1)return void(this._timeScale=1);this._timeScale=t;var e=Math.ceil(30-30*this._timeScale);this.set30PlayArray(e),console.log(this._isFrame30Play)},enumerable:!1,configurable:!0}),Object.defineProperty(t,"Ins",{get:function(){return t._instance?t._instance:(t._instance=new t,t._instance)},enumerable:!1,configurable:!0}),t.prototype.initial=function(){},t.prototype.set30PlayArray=function(t){var e=30-t,n=!1;t>e&&(n=!0,e=t,t=30-e);for(var i=e/t,r=i,a=0,o=0;30>o;o++)e>0?r>a?(this._isFrame30Play[o]=!0,a+=1,e-=1):(this._isFrame30Play[o]=!1,r+=i):this._isFrame30Play[o]=!1;n&&this.playBoolReverse()},t.prototype.playBoolReverse=function(){for(var t=0;30>t;t++)this._isFrame30Play[t]=!this._isFrame30Play[t]},t.prototype.update=function(){return this._timeScale<.034?!1:this._timeScale>.966?!0:(this._frameCount=this._frameCount+1,this._frameCount>=30&&(this._frameCount=0),this._isFrame30Play[this._frameCount])},t}();window.TimeScaleManager=n,__reflect(n.prototype,"TimeScaleManager",[])},function(t,e){var n;!function(t){t[t.DodgerBlue=2003199]="DodgerBlue",t[t.GhostWhite=16316671]="GhostWhite",t[t.Coral=16744272]="Coral",t[t.Tan=13808780]="Tan",t[t.AntiqueWhite=16444375]="AntiqueWhite",t[t.DarkOrange=16747520]="DarkOrange",t[t.LimeGreen=3329330]="LimeGreen",t[t.DarkRed=9109504]="DarkRed",t[t.White=16777215]="White",t[t.DarkGray=11119017]="DarkGray",t[t.DimGray=6908265]="DimGray"}(n||(n={})),window.ColorDef=n},function(t,e){var n;!function(t){t.L1CRTNDESTROYED="L1CRTNDESTROYED",t.L1BATTLEUIPORTTAP="L1BATTLEUIPORTTAP",t.L1BATTLECHARTAP="L1BATTLECHARTAP",t.L1BATTLECHARPORTTAP="L1BATTLECHARPORTTAP",t.L1TOUCHLABELTAP="L1TOUCHLABELTAP"}(n||(n={})),window.MessageType=n},function(t,e){var n=function(){function t(){this.isInitialed=!1}return t.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t.prototype.initial=function(){},t.prototype.releaseResource=function(){},t.prototype.defaultRelease=function(){egret.Tween.removeAllTweens(),LayerManager.Ins.clear(),MessageManager.Ins.clearListener()},t.prototype.release=function(){},t.prototype.update=function(){},t}();window.IScene=n,__reflect(n.prototype,"IScene",[])},function(t,e){var n=function(){function t(){}return Object.defineProperty(t,"Ins",{get:function(){return t._instance?t._instance:(t._instance=new t,t._instance)
},enumerable:!1,configurable:!0}),t.prototype.initial=function(){this.setScene(new StartScene)},t.prototype.setScene=function(t){LayerManager.Ins.showLoadingUILayer();var e=this.curScene;this.curScene=t,null!=e&&(e.defaultRelease(),e.release(),e.releaseResource(),e=null),this.loadScene(t)},t.prototype.loadScene=function(t){var e=this;t.loadResource().then(function(){t.initial(),t.isInitialed=!0,e.onSceneLoadingCompelete()})},t.prototype.onSceneLoadingCompelete=function(){LayerManager.Ins.hideLoadingUILayer()},t.prototype.update=function(){null!=this.curScene&&this.curScene.isInitialed&&this.curScene.update()},t}();window.SceneManager=n,__reflect(n.prototype,"SceneManager",[])},function(t,e){var n=function(){function t(){}return t.initialData=function(){var e=t.getObject("L1Data");this.l1Data=new L1Data,e&&this.l1Data.initialByData(e)},t.setObject=function(t,e){egret.localStorage.setItem(t,JSON.stringify(e))},t.getObject=function(t){return JSON.parse(egret.localStorage.getItem(t))},t.removeKey=function(t){egret.localStorage.removeItem(t)},t.clearLocalData=function(){egret.localStorage.clear(),this.initialData()},t}();window.UserData=n,__reflect(n.prototype,"UserData",[])},function(t,e){var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initial=function(){LayerManager.Ins.uiLayer.addChild(new MainUI)},e}(IScene);window.MainScene=n,__reflect(n.prototype,"MainScene",[])},function(t,e){var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initial=function(){var t=new StartPanel;LayerManager.Ins.uiLayer.addChild(t)},e}(IScene);window.StartScene=n,__reflect(n.prototype,"StartScene",[])},function(t,e){var n=function(){function t(t,e){var n=this;this.curAnger=0,this._angerAddFrame=0,this.inSkillCasting=!1,this._destPos=[0,0],this.curSkillIndex=0,this.alive=!0,this.camp=t,this.skillManager=SceneManager.Ins.curScene.skillManager,this.charId=e;var i=L1CHARCFGS[e];this._charPort=new L1CharPortr(t,i.portImageName,e),this.name=i.name,this.rawAttr=i.attr,this.skills=i.skills.map(function(t){return L1SkillManager.Ins.newSkill(t,n)}),this.maxHp=this.rawAttr.maxHp,this.curHp=this.maxHp,this.curAnger=0,this.def=this.rawAttr.def,this.atk=this.rawAttr.atk,this.dodgePoint=this.rawAttr.dodgePoint,this.critPoint=this.rawAttr.critPoint,this.critTime=this.rawAttr.critTime,this._angerAddFrame=this.rawAttr.angerAdds/60,this.normalAttackSkill=this.skillManager.newSkill(i.normalSkill,this),this.buffStatus=new MySet,this.buffs=new MySet,MessageManager.Ins.addEventListener(MessageType.L1BATTLECHARPORTTAP,this.portTap,this)}return t.prototype.addAngerNumber=function(t){var e=this.curAnger+t;e>L1CharAttr.MAXANGER&&(e=L1CharAttr.MAXANGER),this.curAnger=e,this._charPort.initialed&&this._charPort.drawAngerCircle(e/L1CharAttr.MAXANGER)},Object.defineProperty(t.prototype,"x",{get:function(){return this._charPort.x},set:function(t){this._charPort.x=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._charPort.y},set:function(t){this._charPort.y=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pos",{get:function(){return[this.x,this.y]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rotation",{get:function(){return this._charPort.rotationCircle.rotation},set:function(t){this._charPort.rotationCircle.rotation=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"moveSpeed",{get:function(){return this.rawAttr.moveSpeed},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rotationSpeed",{get:function(){return this.rawAttr.rotationSpeed},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"curHp",{get:function(){return this._curHp},set:function(t){this.alive&&(t>this.maxHp&&(t=this.maxHp),0>=t?(this._curHp=0,this.alive=!1,this._charPort.drawHpCircle(0),this.removeFromScene()):(this._curHp=t,this._charPort.initialed&&this._charPort.drawHpCircle(t/this.maxHp)))},enumerable:!1,configurable:!0}),t.prototype.portTap=function(t){t.messageContent==this._charPort&&MessageManager.Ins.sendMessage(MessageType.L1BATTLECHARTAP,this)},t.prototype.initial=function(t,e){this.oppos=t,this.coops=e;var n=e.indexOf(this),i=this.camp==L1Camp.Player?-1:1;this.x=(130*Math.floor(n/2)+130)*i+GameRoot.GameStage.stageWidth/2,this.y=(n%2*2-1)*(70+100*Math.floor(n/2))+500,this.camp==L1Camp.Enemy&&(this.rotation=180)},t.prototype.update=function(){if(this.alive&&(this.addAngerNumber(this._angerAddFrame),!this.isDizz()&&!this.inSkillCasting&&(null!=this.normalAttakTarget&&this.normalAttakTarget.alive||(this.normalAttakTarget=this.findNormalATKTarget(this.oppos)),null!=this.normalAttakTarget))){var t=this.findATKLocation();if(this._destPos=[Math.ceil(t[0]),Math.ceil(t[1])],!this.isSamePos([this.x,this.y],this._destPos)){this.movingTo(this._destPos);var e=this.getRotationToPos(this._destPos);return e=this.getPropDestRotation(e),void this.rotTo(e)}var n=this.getRotationToPos([this.normalAttakTarget.x,this.normalAttakTarget.y]);if(n=this.getPropDestRotation(n),this.rotTo(n),Util.isNumEqual(this.rotation,n)){if(this.curAnger==L1CharAttr.MAXANGER&&!this.isSlient()){var i=this.curSkillIndex,r=this.skills[i];if(r.isCoolDown())return this.skillManager.castSkill(r),this.addAngerNumber(-L1CharAttr.MAXANGER),this.curSkillIndex=i+1,void(this.curSkillIndex==this.skills.length&&(this.curSkillIndex=0))}this.targetInRange()&&this.normalAttackSkill.isCoolDown()&&this.skillManager.castSkill(this.normalAttackSkill)}}},t.prototype.getRotationToPos=function(t){var e=Util.getRad([this.x,this.y],t);return Math.ceil(Util.degNormalize(90-e/angle2RadParam))},t.prototype.getPropDestRotation=function(t){var e=Math.abs(t-this.rotation),n=Math.abs(t+360-this.rotation),i=Math.abs(t-360-this.rotation);return e>n?t+360:e>i?t-360:t},t.prototype.isSamePos=function(t,e,n){return void 0===n&&(n=6),Math.abs(t[0]-e[0])+Math.abs(t[1]-e[1])<=n},t.prototype.movingTo=function(t){var e=Util.getRad([this.x,this.y],t),n=1/GameRoot.GameStage.frameRate,i=n*this.moveSpeed;this.x=Math.ceil(this.x+i*Math.sin(e)),this.y=Math.ceil(this.y+i*Math.cos(e))},t.prototype.startAnim=function(t,e){this._charPort.startAnim(t,e)},t.prototype.rotTo=function(t){if(!Util.isNumEqual(t,this.rotation)){var e=1/GameRoot.GameStage.frameRate,n=e*this.rotationSpeed;return Math.abs(this.rotation-t)<n?void(this.rotation=t):this.rotation>t?void(this.rotation-=n):this.rotation<t?void(this.rotation+=n):void 0}},t.prototype.findNormalATKTarget=function(t){for(var e=Number.MAX_VALUE,n=null,i=0,r=t;i<r.length;i++){var a=r[i];if(a.alive){var o=this.disFrom(a);e>o&&(n=a,e=o)}}return n},t.prototype.disFrom=function(t){return Util.pointDistance([t.x,t.y],[this.x,this.y])},t.prototype.targetInRange=function(){return this.rawAttr.range-this.disFrom(this.normalAttakTarget)>-10},t.prototype.findATKLocation=function(){var t,e,n,i;if((null==this.normalAttakTarget||this.targetInRange())&&this.isPosLegal(this.x,this.y))return[this.x,this.y];var r=this.normalAttakTarget.x,a=this.normalAttakTarget.y,o=0,s=0,c=Util.getRad([r,a],[this.x,this.y]),u=30*angle2RadParam;if(t=this.getLinePosByRad([r,a],c,this.rawAttr.range),o=t[0],s=t[1],this.isPosLegal(o,s))return[o,s];for(var l=c,h=1;12>h;h++)if(l+=u,e=this.getLinePosByRad([r,a],l,this.rawAttr.range),o=e[0],s=e[1],this.isPosLegal(o,s))return[o,s];for(var f=this.rawAttr.range-L1CharAttr.CHARMINDIS/4;f>L1CharAttr.CHARMINDIS;){if(n=this.getLinePosByRad([r,a],c,f),o=n[0],s=n[1],this.isPosLegal(o,s))return[o,s];f-=L1CharAttr.CHARMINDIS/4}f=this.rawAttr.range+L1CharAttr.CHARMINDIS/4;for(var p=this.disFrom(this.normalAttakTarget);p>f;){if(i=this.getLinePosByRad([r,a],c,f),o=i[0],s=i[1],this.isPosLegal(o,s))return[o,s];f+=L1CharAttr.CHARMINDIS/4}return[this.x,this.y]},t.prototype.getLinePosByRad=function(t,e,n){var i=t[0]+n*Math.sin(e),r=t[1]+n*Math.cos(e);return[i,r]},t.prototype.isPosLegal=function(t,e){var n=L1CharAttr.CHARMINDIS/2,i=L1CharAttr.CHARMINDIS/2,r=GameRoot.GameStage.stageWidth-L1CharAttr.CHARMINDIS/2,a=GameRoot.GameStage.stageHeight-L1CharAttr.CHARMINDIS/2;if(n>t||i>e||t>r||e>a)return!1;for(var o=0,s=[this.oppos,this.coops];o<s.length;o++)for(var c=s[o],u=0,l=c;u<l.length;u++){var h=l[u];if(h.alive&&h!=this&&Util.pointDistance([t,e],[h.x,h.y])<L1CharAttr.CHARMINDIS&&Util.pointDistance([t,e],h._destPos)<L1CharAttr.CHARMINDIS)return!1}return!0},t.prototype.addToScene=function(){LayerManager.Ins.gameLayer.addChild(this._charPort)},t.prototype.removeFromScene=function(){LayerManager.Ins.gameLayer.removeChild(this._charPort)},t.prototype.endSkillCast=function(){egret.Tween.removeTweens(this._charPort.contentGroup)},Object.defineProperty(t.prototype,"DODGE",{get:function(){return Math.min(L1CharAttr.MAXDODGEP,this.dodgePoint)},enumerable:!1,configurable:!0}),t.prototype.isDizz=function(){return L1BuffStatus.DIZZ in this.buffStatus},t.prototype.isSlient=function(){return L1BuffStatus.SLIENT in this.buffStatus},t.prototype.refreshBuffAttr=function(){for(var t=[],e=0,n=this.buffs.data;e<n.length;e++){var i=n[e],r=i.config.isAffectDudge(this,i.caster);i.config.buffType==L1BuffType.ATTRCHANGE&&r&&t.push(i)}for(var a={},o={},s=0,c=L1CharAttr.ATTRNAMES;s<c.length;s++){var u=c[s];a[u]=0,o[u]=0}for(var l=0,h=t;l<h.length;l++)for(var i=h[l],f=0,p=L1CharAttr.ATTRNAMES;f<p.length;f++){var u=p[f];u in i.config.attrAddAbs&&(a[u]+=i.config.attrAddAbs[u]),u in i.config.attrAddRatio&&(o[u]+=i.config.attrAddRatio[u])}this.atk=this.rawAttr.atk*(1+o[L1ATTRNAME.ATK])+a[L1ATTRNAME.ATK],this.def=this.rawAttr.def*(1+o[L1ATTRNAME.DEF])+a[L1ATTRNAME.DEF],this.critPoint=this.rawAttr.critPoint*(1+o[L1ATTRNAME.CRITP])+a[L1ATTRNAME.CRITP],this.dodgePoint=this.rawAttr.dodgePoint*(1+o[L1ATTRNAME.DODGEP])+a[L1ATTRNAME.DODGEP];var d=this.rawAttr.maxHp*(1+o[L1ATTRNAME.MAXHP])+a[L1ATTRNAME.MAXHP];if(d>this.maxHp){var g=d-this.maxHp;this.curHp+=g,this.maxHp=d}this.critTime=this.rawAttr.critTime*(1+o[L1ATTRNAME.CRITT])+a[L1ATTRNAME.CRITT]},t.prototype.refreshBuffStatus=function(){this.buffStatus.removeAll();for(var t=[],e=0,n=this.buffs.data;e<n.length;e++){var i=n[e],r=i.config.isAffectDudge(this,i.caster);i.config.buffType==L1BuffType.STATUS&&r&&t.push(i.config.status)}for(var a=0,o=t;a<o.length;a++){var s=o[a];this.buffStatus.add(s)}this.isDizz()?this._charPort.toDizz():this._charPort.outDizz(),this.isSlient()?this._charPort.toSlient():this._charPort.outSlient()},t}();window.L1Char=n,__reflect(n.prototype,"L1Char",[])},function(t,e){var n;!function(t){t.MAXHP="MAXHP",t.ATK="ATK",t.DEF="DEF",t.CRITP="CRITP",t.DODGEP="DODGEP",t.CRITT="CRITT"}(n||(n={})),window.L1ATTRNAME=n},function(t,e){var n=function(){function t(t,e,n,i,r,a,o,s){this.maxHp=t,this.atk=e,this.def=n,this.range=i,this.critPoint=r,this.dodgePoint=a,this.critTime=o,this.posNum=s,this.moveSpeed=160,this.rotationSpeed=180,this.angerAdds=20}return t.ATTRNAMES=[L1ATTRNAME.MAXHP,L1ATTRNAME.ATK,L1ATTRNAME.DEF,L1ATTRNAME.CRITP,L1ATTRNAME.DODGEP,L1ATTRNAME.CRITT],t.MAXANGER=100,t.CHARMINDIS=60,t.MAXDODGEP=80,t}();window.L1CharAttr=n,__reflect(n.prototype,"L1CharAttr",[])},function(t,e){var n=function(){function t(t,e,n,i,r,a){this.attr=t,this.skills=e,this.normalSkill=n,this.passiveSkills=i,this.name=r,this.portImageName=a}return t}();window.L1CharConfig=n,__reflect(n.prototype,"L1CharConfig",[])},function(t,e){var n=function(t){function e(e,n,i){void 0===i&&(i=0);var r=t.call(this)||this;return r._portImage=n,r._charId=i,r._camp=e,r.initialed=!1,r.addEventListener(eui.UIEvent.COMPLETE,r.UIEventEndInit,r),r.addEventListener(egret.TouchEvent.TOUCH_TAP,r.tapEvent,r),r}return __extends(e,t),e.prototype.tapEvent=function(){MessageManager.Ins.sendMessage(MessageType.L1BATTLECHARPORTTAP,this)},e.prototype.UIEventEndInit=function(){this.portImage.source=this._portImage,this.portImage.mask=this.portMask,this._camp==i.Player?this.hpNumCircle.fillColor=ColorDef.LimeGreen:this.hpNumCircle.fillColor=ColorDef.DarkRed,this.angerNumMask=new egret.Shape,this.contentGroup.addChild(this.angerNumMask),this.angerNumCircle.mask=this.angerNumMask,this.drawAngerCircle(0),this.hpNumMask=new egret.Shape,this.contentGroup.addChild(this.hpNumMask),this.hpNumCircle.mask=this.hpNumMask,this.drawHpCircle(1),this.rotationPoint.fillColor=this._camp==i.Player?ColorDef.LimeGreen:ColorDef.DarkRed;this.initialed=!0},e.prototype.drawHpCircle=function(t){this.hpNumMask.x=0,this.hpNumMask.y=0,this.drawCircle(this.hpNumMask,360*t,this.hpNumCircle.width/2),this.hpNumMask.x=this.contentGroup.width/2,this.hpNumMask.y=this.contentGroup.width/2},e.prototype.drawAngerCircle=function(t){this.angerNumMask.x=0,this.angerNumMask.y=0,this.drawCircle(this.angerNumMask,360*t,this.angerNumCircle.width/2),this.angerNumMask.x=this.contentGroup.width/2,this.angerNumMask.y=this.contentGroup.width/2},e.prototype.drawCircle=function(t,e,n){var i=-90;e-=90,Util.drawAngleCircle(t,e,n,i)},e.prototype.startAnim=function(t,e){egret.Tween.removeTweens(this.contentGroup);var n=this.rotationCircle.rotation*angle2RadParam,i=t[0],r=this.getAngleCoorSysPos(i,n),a=r[0],o=r[1];this.contentGroup.x=a,this.contentGroup.y=o;for(var s=egret.Tween.get(this.contentGroup),c=0;c<e.length;c++){var u=this.getAngleCoorSysPos(t[c+1],n),l=u[0],h=u[1],f=e[c];s.to({x:l,y:h},f)}},e.prototype.getAngleCoorSysPos=function(t,e){var n=t[0],i=t[1],r=Math.cos(-e),a=Math.sin(-e),o=n*r+i*a,s=i*r-n*a;return[o,s]},e.prototype.toDizz=function(){this.dizzLabel.visible=!0},e.prototype.outDizz=function(){this.dizzLabel.visible=!1},e.prototype.toSlient=function(){this.slientLabel.visible=!0},e.prototype.outSlient=function(){this.slientLabel.visible=!1},e}(eui.Component);window.L1CharPortr=n,__reflect(n.prototype,"L1CharPortr",[]);var i;!function(t){t[t.Enemy=1]="Enemy",t[t.Player=-1]="Player"}(i||(i={})),window.L1Camp=i},function(t,e){var n=function(){function t(){this.currentMainStoryId=0,this.userUseCharIds=[1,2,3,4],this.userAllCharIds=[1,2,3,4,5,6,7,8]}return Object.defineProperty(t.prototype,"CurMainStoryId",{get:function(){return this.currentMainStoryId},set:function(t){this.currentMainStoryId=t,this.writeData()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"UserUseCharIds",{get:function(){return this.userUseCharIds},set:function(t){this.userUseCharIds=t,this.writeData()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"UserAllCharIds",{get:function(){return this.userAllCharIds},enumerable:!1,configurable:!0}),t.prototype.initialByData=function(t){for(var e in t)this[e]=t[e]},t.prototype.writeData=function(){UserData.setObject("L1Data",this)},t}();window.L1Data=n,__reflect(n.prototype,"L1Data",[]);var i;!function(t){t[t.MainStory=0]="MainStory"}(i||(i={})),window.L1LevelType=i},function(t,e){var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initial=function(){LayerManager.Ins.uiLayer.addChild(new L1MainUI)},e}(IScene);window.L1MainScene=n,__reflect(n.prototype,"L1MainScene",[])},function(t,e){var n=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._resLoad=new ResAsyncLoader,e._players=[],e._enemies=[],e._battleEnd=!1,e._battleStart=!1,e}return __extends(e,t),Object.defineProperty(e.prototype,"BattleEnd",{get:function(){return this._battleEnd},set:function(t){if(this._battleEnd=t,1==t&&this._victoryCamp==L1Camp.Player){if(UserData.l1Data.levelType==L1LevelType.MainStory){var e=Object.keys(L1LevelCFGS).length-1,n=UserData.l1Data.CurMainStoryId+1;e>=n&&(UserData.l1Data.CurMainStoryId=n)}this._battleSceneUI.battleEnd(!0)}1==t&&this._victoryCamp==L1Camp.Enemy&&this._battleSceneUI.battleEnd(!1)},enumerable:!1,configurable:!0}),e.prototype.initial=function(){this.skillManager=new L1SkillManager,this.creationManager=new L1CreationManager,this.buffManager=new L1BuffManager,this._battleSceneUI=new L1BattleSceneUI,LayerManager.Ins.uiLayer.addChild(this._battleSceneUI),this.initialGameLayer()},e.prototype.initialGameLayer=function(){for(var t=this,e=this.readEnemiesIds(),n=0,i=e;n<i.length;n++){var r=i[n],a=new L1Char(L1Camp.Enemy,r);a.addToScene(),this._enemies.push(a)}for(var o=UserData.l1Data.UserUseCharIds,s=0,c=o;s<c.length;s++){var r=c[s],a=new L1Char(L1Camp.Player,r);a.addToScene(),this._players.push(a)}this._enemies.sort(function(t,e){return t.rawAttr.posNum-e.rawAttr.posNum}),this._players.sort(function(t,e){return t.rawAttr.posNum-e.rawAttr.posNum}),this._enemies.forEach(function(e){e.initial(t._players,t._enemies)}),this._players.forEach(function(e){e.initial(t._enemies,t._players)})},e.prototype.readEnemiesIds=function(){return UserData.l1Data.levelType==L1LevelType.MainStory?L1LevelCFGS[UserData.l1Data.CurMainStoryId]:void 0},e.prototype.battleStart=function(){this._battleStart=!0},e.prototype.removeChar=function(t){for(var e=-1,n=0;n<this._players.length;n++)if(this._players[n].charId==t){e=n;break}if(-1==e)return void console.warn("哪里不对劲");var i=this._players[e];i.removeFromScene(),this._players.splice(e,1),this.endReplace()},e.prototype.addChar=function(t){var e=new L1Char(L1Camp.Player,t);e.addToScene(),this._players.push(e),this.endReplace()},e.prototype.endReplace=function(){var t=this;this._players.sort(function(t,e){return t.rawAttr.posNum-e.rawAttr.posNum}),this._players.forEach(function(e){e.initial(t._enemies,t._players)})},e.prototype.update=function(){if(this._battleStart&&!this.BattleEnd){var t=0,e=0;if([this._enemies,this._players].forEach(function(n){n.forEach(function(n){n.alive&&(n.camp==L1Camp.Enemy&&e++,n.camp==L1Camp.Player&&t++)})}),0==t)return this._victoryCamp=L1Camp.Enemy,this.BattleEnd=!0,void ToastInfoManager.newRedToast("战斗失败");if(0==e)return this._victoryCamp=L1Camp.Player,this.BattleEnd=!0,void ToastInfoManager.newRedToast("战斗胜利");this.skillManager.update(),this.creationManager.update(),this.buffManager.update(),this._battleSceneUI.update(),[this._enemies,this._players].forEach(function(t){t.forEach(function(t){t.update()})})}},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this._resLoad.loadGroup("portrait",0,LayerManager.Ins.loadingUI)];case 1:return t.sent(),[2]}})})},e.prototype.releaseResource=function(){this._resLoad.releaseResource()},e}(IScene);window.L1NormalBattleScene=n,__reflect(n.prototype,"L1NormalBattleScene",[])},function(t,e){var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initial=function(){LayerManager.Ins.uiLayer.addChild(new L1MainUI)},e}(IScene);window.L1RoughlikeScene=n,__reflect(n.prototype,"L1RoughlikeScene",[])},function(t,e){function n(){var t={TEMPLATE:new L1HarmConfig(function(t,e){return[!0,0]}),HEAL01:new L1HarmConfig(function(t,e){var n=L1Harm.isRandTrue(t.critPoint),i=.2*t.maxHp;return n&&(i*=t.critTime),[n,-i]})},e={TEMPLATE:new L1BuffConfig("TEMPLATE","模版",1e3,1e3,L1BuffType.ATTRCHANGE,L1BuffStatus.NORMAL,"",{},{},function(t,e){},function(t,e){return!0}),BUFF01:new L1BuffConfig("BUFF01","攻击+10",3e3,1e3,L1BuffType.ATTRCHANGE,L1BuffStatus.NORMAL,"攻击 +10",{ATK:10}),BUFF02:new L1BuffConfig("BUFF02","每1s对自身造成10点伤害，持续10s",1e4,1e3,L1BuffType.AFFECTPERIOD,L1BuffStatus.NORMAL,"持续掉血",null,null,function(t,n){L1Harm.harm(n,[t],new L1HarmConfig(function(){return[!1,10]})),L1BuffManager.Ins.newBuff(e.BUFF01,t,n)})},n={TEMPLATE:new L1CreationConfig(100,L1CrtnFlyType.FIX,L1CrTnAffectContType.ONECE,L1CrTnAffectTargetSetType.PRESET,L1CrtnAffectTargetCamp.OTHER,400,1e3,200,function(t,e){},.9,ColorDef.DarkOrange),NORMBULLET01:new L1CreationConfig(5,L1CrtnFlyType.CHAR,L1CrTnAffectContType.ONECE,L1CrTnAffectTargetSetType.PRESET,L1CrtnAffectTargetCamp.OTHER,800,1,10,function(t,e){L1Harm.harm(e,t)},1,ColorDef.DarkOrange)},i={TEMPLATE:new L1SkillConfig("",1e3,{0:function(){}},function(t){return null},"模版"),NROMATK:new L1SkillConfig("",1e3,{0:function(t){t.caster.startAnim([[0,0],[10,0],[-5,0],[0,0]],[75,100,50]),t.caster.addAngerNumber(15)},75:function(t){L1Harm.harm(t.caster,t.targets)},225:function(){}},function(t){return[t.caster.normalAttakTarget]},"普通攻击"),NORMRANGATK:new L1SkillConfig("",1e3,{0:function(t){t.caster.startAnim([[0,0],[10,0],[-5,0],[0,0]],[75,100,50]),t.caster.addAngerNumber(15),t.newCreation(n.NORMBULLET01,t.caster,t.targets[0],t.caster.pos,t.targets[0].pos),t.newBuff(e.BUFF01,t.caster,t.caster)},225:function(){}},function(t){return[t.caster.normalAttakTarget]},"远程普通攻击"),HEALSKILL:new L1SkillConfig("风灵颂",1e4,{0:function(t){t.caster.startAnim([[0,0],[0,10],[0,-10],[0,0]],[75,150,75])},150:function(n){L1Harm.harm(n.caster,n.targets,t.HEAL01),n.newBuff(e.BUFF01,n.caster,n.caster)}},function(t){return[t.caster]},"这是一个治疗技能，回复自身最大血量的20%，但在随后的10s内每s失去10血量"),TEST01:new L1SkillConfig("测试大招",4e4,{0:function(t){t.caster.startAnim([[0,0],[0,20],[0,-20],[0,0],[-20,0],[20,0],[0,0]],[75,150,75,75,150,75])},150:function(e){L1Harm.harm(e.caster,e.targets,t.HEAL01)},600:function(t){t.caster.startAnim([[0,0],[0,20],[0,0]],[2e3,2e3])},5e3:function(t){}},function(t){return[t.caster]},"这是一个特别沙雕的技能，首先让角色进入癫痫，然后给自己治疗20%血量，之后像喝醉了一样，进入5s的贤者时间"),TEST02:new L1SkillConfig("测试小技能",2e4,{0:function(t){t.caster.startAnim([[0,0],[0,10],[0,-10],[0,0]],[75,150,75])},150:function(t){}},function(t){return[t.caster]},"这是一个无法描述的技能，因为他没有任何效果，只会让你的英雄傻站着不动")};return{1:new L1CharConfig(new L1CharAttr(1e3,200,200,400,10,10,1.2,100),[i.HEALSKILL,i.TEST01,i.TEST02],i.NORMRANGATK,[],"测试角色1","1_portrait_png"),2:new L1CharConfig(new L1CharAttr(1e3,200,200,120,10,10,1.2,0),[i.HEALSKILL,i.TEST01,i.TEST02],i.NROMATK,[],"测试角色2","2_portrait_png"),3:new L1CharConfig(new L1CharAttr(1e3,200,200,400,10,10,1.2,200),[i.HEALSKILL,i.TEST01,i.TEST02],i.NORMRANGATK,[],"测试角色3","3_portrait_png"),4:new L1CharConfig(new L1CharAttr(1e3,200,200,400,10,10,1.2,200),[i.HEALSKILL,i.TEST01,i.TEST02],i.NORMRANGATK,[],"测试角色4","4_portrait_png"),5:new L1CharConfig(new L1CharAttr(1e3,200,200,400,10,10,1.2,200),[i.HEALSKILL,i.TEST01,i.TEST02],i.NORMRANGATK,[],"测试角色5","5_portrait_png"),6:new L1CharConfig(new L1CharAttr(1e3,200,200,400,10,10,1.2,200),[i.HEALSKILL,i.TEST01,i.TEST02],i.NORMRANGATK,[],"测试角色6","6_portrait_png"),7:new L1CharConfig(new L1CharAttr(1e3,200,200,400,10,10,1.2,200),[i.HEALSKILL,i.TEST01,i.TEST02],i.NORMRANGATK,[],"测试角色7","7_portrait_png"),8:new L1CharConfig(new L1CharAttr(1e3,200,200,400,10,10,1.2,200),[i.HEALSKILL,i.TEST01,i.TEST02],i.NORMRANGATK,[],"测试角色8","8_portrait_png")}}function i(){return{0:[1,1],1:[1,1,1],2:[1,1,2,2]}}window.GetCHARCFGS=n,window.GetL1LevelCFGS=i;var r=n();window.L1CHARCFGS=r;var a=i();window.L1LevelCFGS=a},function(t,e){var n=function(){function t(){this._castframeCount=0,this._creationManager=SceneManager.Ins.curScene.creationManager,this._buffManager=SceneManager.Ins.curScene.buffManager}return t.prototype.initial=function(t,e){this.caster=t,this.config=e;var n=GameRoot.GameStage.frameRate/1e3;this._frameCD=Math.ceil(this.config.cdMs*n);var i=this.config.timeLine,r={};for(var a in i)r[Math.ceil(parseInt(a)*n)]=i[a];this._endFrame=0;for(var a in r){var o=parseInt(a);o>this._endFrame&&(this._endFrame=o)}this._endFrame+=1,this.timeLine=r,this._runCd=0},t.prototype.release=function(){},Object.defineProperty(t.prototype,"CDRUN",{get:function(){return this._runCd},set:function(t){0>=t&&(t=0),this._runCd=t},enumerable:!1,configurable:!0}),t.prototype.isCoolDown=function(){return 0==this.CDRUN},t.prototype.findTarget=function(){this.targets=this.config.skillTargetFind(this)},t.prototype.castPrepare=function(){this._castframeCount=0,this.CDRUN=this._frameCD,this.showSkillName(),this.caster.inSkillCasting=!0},t.prototype.showSkillName=function(){if(""!=this.config.name){var t=ColorDef.DodgerBlue,e=40;ToastInfoManager.newToast(this.config.name,t,this.caster.y-60,this.caster.x-GameRoot.GameStage.stageWidth/2,-50,0,2500,e,!0,egret.Ease.quadOut)}},t.prototype.isCD=function(){return 0==this.CDRUN},t.prototype.isEnd=function(){return this._castframeCount>this._endFrame},t.prototype.castingUpdate=function(){this._castframeCount in this.timeLine&&this.timeLine[this._castframeCount](this),this._castframeCount+=1},t.prototype.endCast=function(){this.caster.inSkillCasting=!1,this.caster.endSkillCast()},t.prototype.newCreation=function(t,e,n,i,r,a){void 0===n&&(n=null),void 0===r&&(r=null),void 0===a&&(a=null),this._creationManager.newCreation(t,e,n,i,r,a)},t.prototype.newBuff=function(t,e,n){this._buffManager.newBuff(t,e,n)},t}();window.L1Skill=n,__reflect(n.prototype,"L1Skill",[])},function(t,e){var n=function(){function t(t,e,n,i,r){this.name=t,this.cdMs=e,this.timeLine=n,this.skillTargetFind=i,this.descr=r}return t}();window.L1SkillConfig=n,__reflect(n.prototype,"L1SkillConfig",[])},function(t,e){var n=function(){function t(){this._skillCastingList=new MySet,this._allSkillList=new MySet}return Object.defineProperty(t,"Ins",{get:function(){return SceneManager.Ins.curScene.skillManager},enumerable:!1,configurable:!0}),t.prototype.update=function(){for(var t=[],e=0,n=this._skillCastingList.data;e<n.length;e++){var i=n[e];i.castingUpdate(),i.isEnd()&&(i.endCast(),t.push(i))}for(var r=0,a=t;r<a.length;r++){var i=a[r];this._skillCastingList.remove(i)}for(var o=0,s=this._allSkillList.data;o<s.length;o++){var i=s[o];i.CDRUN=i.CDRUN-1}},t.prototype.castSkill=function(t){t.castPrepare(),t.findTarget(),this._skillCastingList.add(t)},t.prototype.castSkillBreak=function(t){t.endCast(),this._skillCastingList.remove(t)},t.prototype.newSkill=function(t,e){var n=new L1Skill;return n.initial(e,t),this._allSkillList.add(n),n},t}();window.L1SkillManager=n,__reflect(n.prototype,"L1SkillManager",[])},function(t,e){var n=function(){function t(){this._activateFrame=0}return t.prototype.initial=function(t,e,n){this.config=t;var i=GameRoot.GameStage.frameRate/1e3;this._periodFrame=Math.ceil(this.config.period*i),this._durationFrame=Math.ceil(this.config.duration*i),this._condPeriodFrame=Math.ceil(this.config.condCd*i),this._preCondAffectFrame=-this._condPeriodFrame,this.addToTarget(e),this._activateFrame=0,this.caster=n},t.prototype.addToTarget=function(t){this._target=t,t.buffs.add(this),this.config.buffType==L1BuffType.STATUS&&t.refreshBuffStatus(),this.config.buffType==L1BuffType.ATTRCHANGE&&t.refreshBuffAttr(),this.showBuffName()},t.prototype.showBuffName=function(){if(""!=this.config.name){var t=ColorDef.GhostWhite,e=25;ToastInfoManager.newToast(this.config.name,t,this._target.y-60,this._target.x-GameRoot.GameStage.stageWidth/2,-50,0,2500,e,!1,egret.Ease.quadOut)}},t.prototype.removeFromTarget=function(){var t=this._target;t.buffs.remove(this),this.config.buffType==L1BuffType.STATUS&&t.refreshBuffStatus(),this.config.buffType==L1BuffType.ATTRCHANGE&&t.refreshBuffAttr()},t.prototype.update=function(){this.config.buffType==L1BuffType.AFFECTPERIOD&&this._activateFrame%this._periodFrame==0&&this.config.isAffectDudge(this._target,this.caster)&&this.config.isAffectDudge(this._target,this.caster),this.config.buffType==L1BuffType.AFFECTCOND&&this._activateFrame-this._preCondAffectFrame>=this._condPeriodFrame&&this.config.isAffectDudge(this._target,this.caster)&&(this.config.isAffectDudge(this._target,this.caster),this._preCondAffectFrame=this._activateFrame),this._activateFrame+=1},t.prototype.isLifeEnd=function(){return 0==this._durationFrame?!1:this._activateFrame>this._durationFrame},t}();window.L1Buff=n,__reflect(n.prototype,"L1Buff",[])},function(t,e){var n=function(){function t(t,e,n,a,o,s,c,u,l,h,f,p,d,g){void 0===e&&(e="测试效果描述"),void 0===n&&(n=1e3),void 0===a&&(a=500),void 0===o&&(o=i.ATTRCHANGE),void 0===s&&(s=r.NORMAL),void 0===c&&(c=""),void 0===u&&(u={}),void 0===l&&(l={}),void 0===h&&(h=function(){}),void 0===f&&(f=function(){return!0}),void 0===p&&(p=!0),void 0===d&&(d=!0),void 0===g&&(g=1e3),this.id=t,this.descr=e,this.duration=n,this.period=a,this.buffType=o,this.status=s,this.name=c,this.attrAddAbs=u,this.attrAddRatio=l,this.affectFunc=h,this.isAffectDudge=f,this.canBeClear=p,this.isGood=d,this.condCd=g}return t}();window.L1BuffConfig=n,__reflect(n.prototype,"L1BuffConfig",[]);var i;!function(t){t[t.AFFECTPERIOD=0]="AFFECTPERIOD",t[t.AFFECTCOND=1]="AFFECTCOND",t[t.ATTRCHANGE=2]="ATTRCHANGE",t[t.STATUS=3]="STATUS"}(i||(i={})),window.L1BuffType=i;var r;!function(t){t[t.NORMAL=0]="NORMAL",t[t.DIZZ=1]="DIZZ",t[t.SLIENT=2]="SLIENT",t[t.L3=3]="L3",t[t.L4=4]="L4"}(r||(r={})),window.L1BuffStatus=r},function(t,e){var n=function(){function t(){this._deadBuffs=[],this._activateBuffs=new MySet}return Object.defineProperty(t,"Ins",{get:function(){return SceneManager.Ins.curScene.buffManager},enumerable:!1,configurable:!0}),t.prototype.update=function(){for(var t=[],e=0,n=this._activateBuffs.data;e<n.length;e++){var i=n[e];i.update(),i.isLifeEnd()&&(t.push(i),i.removeFromTarget())}for(var r=0,a=t;r<a.length;r++){var i=a[r];this._activateBuffs.remove(i),this._deadBuffs.push(i)}},t.prototype.newBuff=function(t,e,n){var i=null;i=0==this._deadBuffs.length?new L1Buff:this._deadBuffs.pop(),this._activateBuffs.add(i),i.initial(t,e,n)},t.prototype.removeBuff=function(t){t.removeFromTarget(),this._deadBuffs.push(t),this._activateBuffs.remove(t)},t}();window.L1BuffManager=n,__reflect(n.prototype,"L1BuffManager",[])},function(t,e){var n=function(){function t(){this._isFly=!0,this._isAffected=!1,this._toDestFrame=Number.MAX_VALUE,this._contentGroup=new eui.Group,this._circleShape=new egret.Shape,this._contentGroup.addChild(this._circleShape)}return Object.defineProperty(t.prototype,"x",{get:function(){return this._contentGroup.x},set:function(t){this._contentGroup.x=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._contentGroup.y},set:function(t){this._contentGroup.y=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pos",{get:function(){return[this.x,this.y]},set:function(t){this.x=t[0],this.y=t[1]},enumerable:!1,configurable:!0}),t.prototype.initial=function(t,e,n,i,r,a){void 0===n&&(n=null),void 0===r&&(r=null),void 0===a&&(a=null),LayerManager.Ins.gameLayer.addChild(this._contentGroup),this._caster=e,this._config=t,this._targetChar=n,this._posDest=r,this._directRad=a;var o=GameRoot.GameStage.frameRate/1e3;this._lifeDurationFrame=Math.ceil(this._config.lifeTime*o),this._affectPeriodFrame=Math.ceil(this._config.affectPeriod*o),this._flySpeedFrame=this._config.flySpeed*o,this._activateFrame=0,this._toDestFrame=Number.MAX_VALUE,Util.drawAngleCircle(this._circleShape,360,this._config.radius,0,this._config.color,this._config.alpha),this._circleShape.x=this._circleShape.y=0,this.x=i[0],this.y=i[1],this._isFly=!0,this._isAffected=!1,this._config.flyType==L1CrtnFlyType.FIX&&(this._isFly=!1)},t.prototype.update=function(){this._isFly&&(this._config.flyType==L1CrtnFlyType.CHAR&&this.flyTo(this._targetChar.pos),this._config.flyType==L1CrtnFlyType.POSITION&&this.flyTo(this._posDest),this._config.flyType==L1CrtnFlyType.DIRECT&&this.flyToRad(this._directRad));var t=!1;if(this._config.affectContType==L1CrTnAffectContType.CONTINUE&&this._activateFrame%this._affectPeriodFrame==0&&(t=!0),this._config.affectContType==L1CrTnAffectContType.ONECE&&(this._isFly||0!=this._isAffected||(t=!0)),t){var e=this.findAffectTarget();this._config.affectFunc(e,this._caster),this._isAffected=!0}this._activateFrame+=1},t.prototype.findAffectTarget=function(){var t=[];if(this._config.affectTargetSetType==L1CrTnAffectTargetSetType.PRESET)t.push(this._targetChar);else if(this._config.affectTargetSetType==L1CrTnAffectTargetSetType.RANGE){var e=this._caster.oppos;this._config.affectTargetCamp==L1CrtnAffectTargetCamp.SELF&&(e=this._caster.coops);for(var n=0,i=e;n<i.length;n++){var r=i[n];Util.pointDistance(r.pos,this.pos)<this._config.radius&&t.push(r)}}return t},t.prototype.flyTo=function(t){if(this.closeTo(this.pos,t))return this.pos=t,this._isFly=!1,void(this._toDestFrame=this._activateFrame);var e=Util.getRad(this.pos,t);this.flyToRad(e)},t.prototype.closeTo=function(t,e){return Util.pointDistance(t,e)<this._flySpeedFrame+20},t.prototype.flyToRad=function(t){this.x=Math.ceil(this.x+this._flySpeedFrame*Math.sin(t)),this.y=Math.ceil(this.y+this._flySpeedFrame*Math.cos(t))
},t.prototype.lifeEnd=function(){LayerManager.Ins.gameLayer.removeChild(this._contentGroup),this._config=null},t.prototype.isLifeEnd=function(){var t=this._toDestFrame;return(this._config.flyType==L1CrtnFlyType.FIX||this._config.flyType==L1CrtnFlyType.DIRECT)&&(t=0),this._activateFrame>this._lifeDurationFrame+t+1},t}();window.L1Creation=n,__reflect(n.prototype,"L1Creation",[])},function(t,e){var n=function(){function t(t,e,n,s,c,u,l,h,f,p,d){void 0===t&&(t=10),void 0===e&&(e=i.FIX),void 0===n&&(n=r.ONECE),void 0===s&&(s=a.RANGE),void 0===c&&(c=o.OTHER),void 0===u&&(u=1e3),void 0===l&&(l=1e3),void 0===h&&(h=1e3),void 0===f&&(f=function(t,e){L1Harm.harm(e,t)}),void 0===p&&(p=.4),void 0===d&&(d=ColorDef.White),this.radius=10,this.flyType=i.FIX,this.affectContType=r.ONECE,this.affectTargetSetType=a.RANGE,this.affectTargetCamp=o.OTHER,this.flySpeed=1e3,this.lifeTime=1e3,this.affectPeriod=1e3,this.alpha=.4,this.radius=t,this.flySpeed=u,this.flyType=e,this.affectContType=n,this.affectTargetSetType=s,this.affectTargetCamp=c,this.lifeTime=l,this.affectPeriod=h,this.affectFunc=f,this.alpha=p,this.color=d}return t}();window.L1CreationConfig=n,__reflect(n.prototype,"L1CreationConfig",[]);var i;!function(t){t[t.FIX=0]="FIX",t[t.POSITION=1]="POSITION",t[t.DIRECT=2]="DIRECT",t[t.CHAR=3]="CHAR"}(i||(i={})),window.L1CrtnFlyType=i;var r;!function(t){t[t.CONTINUE=0]="CONTINUE",t[t.ONECE=1]="ONECE"}(r||(r={})),window.L1CrTnAffectContType=r;var a;!function(t){t[t.PRESET=0]="PRESET",t[t.RANGE=1]="RANGE"}(a||(a={})),window.L1CrTnAffectTargetSetType=a;var o;!function(t){t[t.SELF=0]="SELF",t[t.OTHER=1]="OTHER"}(o||(o={})),window.L1CrtnAffectTargetCamp=o},function(t,e){var n=function(){function t(){this._deadCreations=[],this._activateCreations=new MySet}return Object.defineProperty(t,"Ins",{get:function(){return SceneManager.Ins.curScene.creationManager},enumerable:!1,configurable:!0}),t.prototype.update=function(){for(var t=[],e=0,n=this._activateCreations.data;e<n.length;e++){var i=n[e];i.update(),i.isLifeEnd()&&(i.lifeEnd(),t.push(i))}for(var r=0,a=t;r<a.length;r++){var i=a[r];this._activateCreations.remove(i),this._deadCreations.push(i)}},t.prototype.newCreation=function(t,e,n,i,r,a){void 0===n&&(n=null),void 0===r&&(r=null),void 0===a&&(a=null);var o=null;o=this._deadCreations.length>0?this._deadCreations.pop():new L1Creation,o.initial(t,e,n,i,r,a),this._activateCreations.add(o)},t}();window.L1CreationManager=n,__reflect(n.prototype,"L1CreationManager",[])},function(t,e){var n=function(){function t(){}return t.harm=function(t,e,n){var i=new L1HarmConfig;n||(n=i);for(var r=0,a=e;r<a.length;r++){var o=a[r],s=n.harmFunc(t,o),c=s[0],u=s[1];o.curHp-=u,u>=0&&o.addAngerNumber(10),this.harmFloat(o,u,c)}},t.harmFloat=function(t,e,n){if(t.alive){var i="",r="miss",a=25,o=ColorDef.GhostWhite;if(e=Math.ceil(e),0!=e){a=n?30:25;var s=0>e;r=n?"暴击 ":s?"治疗 ":"",o=s?ColorDef.LimeGreen:n?ColorDef.DarkRed:ColorDef.GhostWhite,i=""+(s?"+":"")+-e}ToastInfoManager.newToast(""+r+i,o,t.y-40,t.x-GameRoot.GameStage.stageWidth/2,-50,0,2500,a,!1,egret.Ease.quadOut)}},t.isRandTrue=function(t){return 100*Math.random()<t},t}();window.L1Harm=n,__reflect(n.prototype,"L1Harm",[])},function(t,e){var n=function(){function t(t){t?this.harmFunc=t:this.harmFunc=function(t,e){var n=L1Harm.isRandTrue(t.critPoint),i=L1Harm.isRandTrue(e.DODGE),r=0;if(!i){var a=n?t.critTime:1;r=t.atk*t.atk/(e.def+t.atk)*a}return[n,r]}}return t}();window.L1HarmConfig=n,__reflect(n.prototype,"L1HarmConfig",[])},function(t,e){var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initial=function(){LayerManager.Ins.uiLayer.addChild(new L2MainUI)},e}(IScene);window.L2MainScene=n,__reflect(n.prototype,"L2MainScene",[])}]);