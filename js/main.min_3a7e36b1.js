var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},__extends=function(e,t){function n(){this.constructor=e}extendStatics(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},__assign=Object.assign||function(e){for(var t,n=1,r=arguments.length;r>n;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},__rest=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n},__decorate=function(e,t,n,r){var i,a=arguments.length,o=3>a?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(3>a?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},__param=function(e,t){return function(n,r){t(n,r,e)}},__metadata=function(e,t){return"object"==typeof Reflect&&"function"==typeof Reflect.metadata?Reflect.metadata(e,t):void 0},__awaiter=function(e,t,n,r){function i(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||(n=Promise))(function(n,a){function o(e){try{l(r.next(e))}catch(t){a(t)}}function s(e){try{l(r["throw"](e))}catch(t){a(t)}}function l(e){e.done?n(e.value):i(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())})},__generator=function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(i)throw new TypeError("Generator is already executing.");for(;l;)try{if(i=1,a&&(o=2&n[0]?a["return"]:n[0]?a["throw"]||((o=a["return"])&&o.call(a),0):a.next)&&!(o=o.call(a,n[1])).done)return o;switch(a=0,o&&(n=[2&n[0],o.value]),n[0]){case 0:case 1:o=n;break;case 4:return l.label++,{value:n[1],done:!1};case 5:l.label++,a=n[1],n=[0];continue;case 7:n=l.ops.pop(),l.trys.pop();continue;default:if(o=l.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){l=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){l.label=n[1];break}if(6===n[0]&&l.label<o[1]){l.label=o[1],o=n;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(n);break}o[2]&&l.ops.pop(),l.trys.pop();continue}n=t.call(e,l)}catch(r){n=[6,r],a=0}finally{i=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var i,a,o,s,l={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},__exportStar=function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||__createBinding(t,e,n)},__createBinding=Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]},__values=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},__read=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,a=n.call(e),o=[];try{for(;(void 0===t||t-->0)&&!(r=a.next()).done;)o.push(r.value)}catch(s){i={error:s}}finally{try{r&&!r.done&&(n=a["return"])&&n.call(a)}finally{if(i)throw i.error}}return o},__spread=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(__read(arguments[t]));return e},__spreadArrays=function(){for(var e=0,t=0,n=arguments.length;n>t;t++)e+=arguments[t].length;for(var r=Array(e),i=0,t=0;n>t;t++)for(var a=arguments[t],o=0,s=a.length;s>o;o++,i++)r[i]=a[o];return r},__await=function(e){return this instanceof __await?(this.v=e,this):new __await(e)},__asyncGenerator=function(e,t,n){function r(e){u[e]&&(c[e]=function(t){return new Promise(function(n,r){f.push([e,t,n,r])>1||i(e,t)})})}function i(e,t){try{a(u[e](t))}catch(n){l(f[0][3],n)}}function a(e){e.value instanceof __await?Promise.resolve(e.value.v).then(o,s):l(f[0][2],e)}function o(e){i("next",e)}function s(e){i("throw",e)}function l(e,t){e(t),f.shift(),f.length&&i(f[0][0],f[0][1])}if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var c,u=n.apply(e,t||[]),f=[];return c={},r("next"),r("throw"),r("return"),c[Symbol.asyncIterator]=function(){return this},c},__asyncDelegator=function(e){function t(t,i){n[t]=e[t]?function(n){return(r=!r)?{value:__await(e[t](n)),done:"return"===t}:i?i(n):n}:i}var n,r;return n={},t("next"),t("throw",function(e){throw e}),t("return"),n[Symbol.iterator]=function(){return this},n},__asyncValues=function(e){function t(t){r[t]=e[t]&&function(r){return new Promise(function(i,a){r=e[t](r),n(i,a,r.done,r.value)})}}function n(e,t,n,r){Promise.resolve(r).then(function(t){e({value:t,done:n})},t)}if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=e[Symbol.asyncIterator];return i?i.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),r={},t("next"),t("throw"),t("return"),r[Symbol.asyncIterator]=function(){return this},r)},__makeTemplateObject=function(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e},__setModuleDefault=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e["default"]=t},__importStar=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&__createBinding(t,e,n);return __setModuleDefault(t,e),t},__importDefault=function(e){return e&&e.__esModule?e:{"default":e}},__classPrivateFieldGet=function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)},__classPrivateFieldSet=function(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,n),n},__reflect=function(e,t,n){e.__class__=t,n?n.push(t):n=[t],e.__types__=e.__types__?n.concat(e.__types__):n};!function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:r})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(t.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var i in e)t.d(r,i,function(t){return e[t]}.bind(null,i));return r},t.n=function(e){var n=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,n){n(1),n(2),n(3),n(4),n(5),n(6),n(7),n(8),n(9),n(10),n(11),n(12),n(13),n(14),n(15),n(16),n(17),n(18),n(19),n(20),n(21),n(22),n(23),n(24),n(25),n(26),n(27),n(28),n(29),n(30),n(31),n(32),n(33),n(34),n(35),n(36),n(37),n(38),n(39),n(40),n(41),n(42),n(43),n(44),n(45),n(46),n(47),n(48),n(49),n(50),n(51),n(52),n(53),n(54),n(55),n(56),n(57),n(58),n(59),n(60),n(61),n(62),n(63),n(64),n(65),n(66),n(67),n(68),n(69),n(70),n(71),n(72),n(73),n(74),n(75);var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.createChildren=function(){e.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(e){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var t=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",t),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(e){console.log(e)})},t.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return e=Util.createColorBG(this.stage.stageWidth,this.stage.stageHeight),this.stage.addChild(e),[4,this.loadResource()];case 1:return t.sent(),GameRoot.Ins.init(this.stage),[2]}})})},t.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,4,,5]),e=new LoadingUI,this.stage.addChild(e),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return n.sent(),[4,this.loadTheme()];case 2:return n.sent(),[4,RES.loadGroup("preload",0,e)];case 3:return n.sent(),this.stage.removeChild(e),[3,5];case 4:return t=n.sent(),console.error(t),[3,5];case 5:return[2]}})})},t.prototype.loadTheme=function(){var e=this;return new Promise(function(t,n){var r=new eui.Theme("resource/default.thm.json",e.stage);r.addEventListener(eui.UIEvent.COMPLETE,function(){t()},e)})},t}(eui.UILayer);window.Main=r,__reflect(r.prototype,"Main",[])},function(e,t){var n=function(){function e(){}return e.prototype.getAsset=function(e,t,n){function r(r){t.call(n,r,e)}if(RES.hasRes(e)){var i=RES.getRes(e);i?r(i):RES.getResAsync(e,r,this)}else RES.getResByUrl(e,r,this,RES.ResourceItem.TYPE_IMAGE)},e}();window.AssetAdapter=n,__reflect(n.prototype,"AssetAdapter",["eui.IAssetAdapter"])},function(e,t){var n="https://1062258897406555.cn-shanghai.fc.aliyuncs.com/2016-08-15/proxy/python_serve/simple_verify/";window.VERIFYURL=n},function(e,t){var n=function(){function e(){}return e.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,{nickName:"username"}]})})},e.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e}();window.DebugPlatform=n,__reflect(n.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new n)},function(e,t){var n=function(){function e(){}return e.prototype.getTheme=function(e,t,n,r){function i(e){t.call(r,e)}function a(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),n.call(r))}var o=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){t.call(r,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(e,n){window.JSONParseClass.setData(e),egret.callLater(function(){t.call(r,generateEUI2)},o)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(e.indexOf(".exml")>-1){var s=e.split("/");s.pop();var l=s.join("/")+"_EUI.json";generateJSON.paths[e]?egret.callLater(function(){t.call(r,generateJSON.paths[e])},this):RES.getResByUrl(l,function(n){window.JSONParseClass.setData(n),egret.callLater(function(){t.call(r,generateJSON.paths[e])},o)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){t.call(r,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),RES.getResByUrl(e,i,this,RES.ResourceItem.TYPE_TEXT)},e}();window.ThemeAdapter=n,__reflect(n.prototype,"ThemeAdapter",["eui.IThemeAdapter"])},function(e,t){var n=function(e){function t(){var t=e.call(this)||this;return t._progressLabel=new eui.Label,t._progressLabel.horizontalCenter=0,t._progressLabel.verticalCenter=0,t._progressLabel.textColor=ColorDef.Coral,t.addChild(t._progressLabel),t}return __extends(t,e),t.prototype.initial=function(){var e=Util.createColorBG(GameRoot.GameStage.stageWidth,GameRoot.GameStage.stageHeight);this.addChildAt(e,0)},t.prototype.clear=function(){this._progressLabel.text="Loading..."},t.prototype.onProgress=function(e,t){this._progressLabel.text="Loading..."+e+"/"+t},t}(eui.UILayer);window.LoadingUI=n,__reflect(n.prototype,"LoadingUI",["RES.PromiseTaskReporter"])},function(e,t){var n=function(e){function t(){var t=e.call(this)||this;return t.width=GameRoot.StageWidth,t.height=GameRoot.StageHeight,t.addEventListener(eui.UIEvent.COMPLETE,t.mainUIEventInit,t),t}return __extends(t,e),t.prototype.mainUIEventInit=function(){this.l1StartButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.tol1,this),this.l2StartButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.tol2,this)},t.prototype.tol1=function(){SceneManager.Ins.setScene(new L1MainScene)},t.prototype.tol2=function(){SceneManager.Ins.setScene(new L2MainScene)},t}(eui.Component);window.MainUI=n,__reflect(n.prototype,"MainUI",[])},function(e,t){var n=function(e){function t(){var t=e.call(this)||this;return t.width=GameRoot.StageWidth,t.height=GameRoot.StageHeight,t.addEventListener(eui.UIEvent.COMPLETE,t.panelEventInit,t),t}return __extends(t,e),t.prototype.panelEventInit=function(){this.confirmButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.confirmPswd,this),this.clearLocalButton.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){UserData.clearLocalData()},this)},t.prototype.debugTap=function(){SceneManager.Ins.setScene(new L2MainScene)},t.prototype.confirmPswd=function(e){return 0==this.pswdTextInput.text.length?void alert("验证失败"):(this.confirmButton.enabled=!1,void Util.httpGet(VERIFYURL+this.pswdTextInput.text.substring(0,10),this.onGetComplete,this.onGetIOError,this.onGetProgress,this))},t.prototype.onGetComplete=function(e){var t=e.currentTarget,n=t.response.substring(0,1);return"y"!=n?(alert("验证失败"),void(this.confirmButton.enabled=!0)):(ToastInfoManager.newRedToast("验证成功"),void setTimeout(function(){SceneManager.Ins.setScene(new MainScene)},1e3))},t.prototype.onGetIOError=function(e){alert("网络错误"),this.confirmButton.enabled=!0},t.prototype.onGetProgress=function(e){},t}(eui.Component);window.StartPanel=n,__reflect(n.prototype,"StartPanel",[])},function(e,t){var n=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(eui.UIEvent.COMPLETE,t.UIEventInit,t),t}return __extends(t,e),t.prototype.UIEventInit=function(){var e=this;this.bgRect.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.visible=!1,e.curChar=null},this),MessageManager.Ins.addEventListener(MessageType.L1BATTLECHARTAP,this.charTap,this),MessageManager.Ins.addEventListener(MessageType.L1TOUCHLABELTAP,this.touchLabelTap,this)},t.prototype.charTap=function(e){var t=e.messageContent;this.curChar=t,this.visible=!0,this.charNameLabel.text=t.name,this.maxHpLabel.text=""+t.maxHp,this.hpRateRect.percentWidth=t.curHp/t.maxHp*100,this.atkNumLabel.text=""+t.atk,this.defNumLabel.text=""+t.def,this.dodgeLabel.text=""+t.dodgePoint,this.critPLabel.text=""+t.critPoint,this.critRLabel.text=""+t.critTime,this.rangeLabel.text=""+t.rawAttr.range,this._skillTouchLabel=[];for(var n in t.skills){var r=t.skills[n],i=new L1TouchLabel(r,t,null,0);i.x=120*parseInt(n)+5,this.skillScrollerGroup.addChild(i),this._skillTouchLabel.push(i)}for(var a={},o=0,s=t.buffs.data;o<s.length;o++){var l=s[o],c=l.config.id;c in a?a[c][1]+=1:""!=l.config.name&&(a[c]=[l.config,1])}var u=0;for(var c in a){var f=a[c],h=f[0],p=f[1],i=new L1TouchLabel(null,null,h,p);i.x=120*u+5,this.buffScrollerGroup.addChild(i),u+=1}this.descrGroup.visible=!1},t.prototype.touchLabelTap=function(e){var t=e.messageContent;this.descrGroup.visible=!0;var n=t.info[0],r=t.info[2],i="";n&&(i=n.config.descr),r&&(i=r.descr),this.descrLabel.text=i},t.prototype.update=function(){if(this.curChar){var e=this.curChar;this.maxHpLabel.text=""+e.maxHp,this.hpRateRect.percentWidth=e.curHp/e.maxHp*100,this.angerRateRect.percentWidth=e.curAnger/L1CharAttr.MAXANGER*100,this.atkNumLabel.text=""+e.atk,this.defNumLabel.text=""+e.def,this.dodgeLabel.text=""+e.dodgePoint,this.critPLabel.text=""+e.critPoint,this.critRLabel.text=""+e.critTime;for(var t=0,n=this._skillTouchLabel;t<n.length;t++){var r=n[t];r.updateSkillCd()}}},t}(eui.Component);window.L1BattleInfo=n,__reflect(n.prototype,"L1BattleInfo",[])},function(e,t){var n=function(e){function t(){var t=e.call(this)||this;return t.width=GameRoot.GameStage.stageWidth,t.height=GameRoot.GameStage.stageHeight,t.addEventListener(eui.UIEvent.COMPLETE,t.UIEventInit,t),t._selectIds=[],t}return __extends(t,e),t.prototype.update=function(){this.charBattleInfo.update()},t.prototype.battleEnd=function(e){e||(this.nextLevelButton.label="Retry"),this.nextLevelButton.visible=!0},t.prototype.UIEventInit=function(){this.backButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.backToL1MainScene,this),this.battleStartButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.battleStart,this),this.nextLevelButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.toNextLevel,this),MessageManager.Ins.addEventListener(MessageType.L1BATTLEUIPORTTAP,this.portTap,this);for(var e=0;e<UserData.l1Data.UserAllCharIds.length;e++){var t=UserData.l1Data.UserAllCharIds[e],n=new L1BattleUIPort(t);n.x=90*e,this.portImageGroup.addChild(n),UserData.l1Data.UserUseCharIds.indexOf(t)>=0&&(n.select(),this._selectIds.push(n.charId))}UserData.l1Data.levelType==L1LevelType.MainStory&&(this.mainStoryLevelName.visible=!0,this.mainStoryLevelName.text=UserData.l1Data.CurMainStoryId+1+"关")},t.prototype.toNextLevel=function(){SceneManager.Ins.setScene(new L1NormalBattleScene)},t.prototype.portTap=function(e){var t=e.messageContent,n=t.charId,r=SceneManager.Ins.curScene;return t.IsSelect?(t.selectCancle(),Util.removeObjFromArray(this._selectIds,t.charId),void r.removeChar(n)):4==this._selectIds.length?void ToastInfoManager.newRedToast("已满员"):(t.select(),this._selectIds.push(t.charId),void r.addChar(n))},t.prototype.backToL1MainScene=function(){SceneManager.Ins.setScene(new L1MainScene)},t.prototype.battleStart=function(){return 0==this._selectIds.length?void ToastInfoManager.newRedToast("无上场成员"):(UserData.l1Data.UserUseCharIds=this._selectIds,this.battleStartButton.visible=!1,SceneManager.Ins.curScene.battleStart(),void(this.portScroller.visible=!1))},t}(eui.Component);window.L1BattleSceneUI=n,__reflect(n.prototype,"L1BattleSceneUI",[])},function(e,t){var n=function(e){function t(t){var n=e.call(this)||this;n.charId=t;var r=L1Config.Ins.L1CHARCFGS[t],i=r.portImageName,a=new eui.Image(i);a.width=120,a.height=120;var o=new eui.Rect(80,80);o.ellipseHeight=80,o.ellipseWidth=80,o.y=20,o.x=20,a.mask=o;var s=new eui.Rect(80,80);s.ellipseHeight=80,s.ellipseWidth=80,s.y=20,s.x=20,n._selectMask=s,s.fillColor=ColorDef.DimGray,s.alpha=.5;var l=new eui.Label;return l.text="上场",l.y=50,l.x=30,n._selectLable=l,n.addChild(a),n.addChild(o),n.addChild(s),n.addChild(l),n.selectCancle(),n.addEventListener(egret.TouchEvent.TOUCH_TAP,n.touchTap,n),n}return __extends(t,e),Object.defineProperty(t.prototype,"IsSelect",{get:function(){return this._isSelect},enumerable:!1,configurable:!0}),t.prototype.touchTap=function(){MessageManager.Ins.sendMessage(MessageType.L1BATTLEUIPORTTAP,this)},t.prototype.select=function(){this._isSelect=!0,this._selectMask.visible=!0,this._selectLable.visible=!0},t.prototype.selectCancle=function(){this._isSelect=!1,this._selectMask.visible=!1,this._selectLable.visible=!1},t}(eui.Group);window.L1BattleUIPort=n,__reflect(n.prototype,"L1BattleUIPort",[])},function(e,t){var n=function(e){function t(){var t=e.call(this)||this;return t.width=GameRoot.GameStage.stageWidth,t.height=GameRoot.GameStage.stageHeight,t.addEventListener(eui.UIEvent.COMPLETE,t.UIEventInit,t),t}return __extends(t,e),t.prototype.UIEventInit=function(){this.backButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.backToMainScene,this),this.mainStoryButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.toL1BattleScene,this),this.roughlikeButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.toL1RoughlikeScene,this)},t.prototype.backToMainScene=function(){SceneManager.Ins.setScene(new MainScene)},t.prototype.toL1BattleScene=function(){UserData.l1Data.levelType=L1LevelType.MainStory,SceneManager.Ins.setScene(new L1NormalBattleScene)},t.prototype.toL1RoughlikeScene=function(){ToastInfoManager.newRedToast("敬请期待")},t}(eui.Component);window.L1MainUI=n,__reflect(n.prototype,"L1MainUI",[])},function(e,t){var n=function(e){function t(t,n,r,i){var a=e.call(this)||this;return a.info=[t,n,r,i],a.addEventListener(eui.UIEvent.COMPLETE,a.UIEventInit,a),a}return __extends(t,e),t.prototype.isCurSkill=function(){var e=this.info[1],t=this.info[0];return e.skills[e.curSkillIndex]==t},t.prototype.UIEventInit=function(){var e=this,t=this.info,n=t[0],r=(t[1],t[2]),i=t[3];if(n){this.nameLabel.text=n.config.name,this.skillCDLabel.visible=!0;var a=(n.config.cdMs/1e3).toFixed(2);this.skillCDLabel.text=a+"s"}r&&(this.nameLabel.text=r.name,this.buffTierLabel.visible=!0,this.buffTierLabel.text="x"+i),this.width=100,this.height=100,this.y=10,this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){MessageManager.Ins.sendMessage(MessageType.L1TOUCHLABELTAP,e)},this)},t.prototype.updateSkillCd=function(){var e=this.info[0];if(e){var t=e.CDRUN/GameRoot.GameStage.frameRate;if(0==t)this.skillCDLabel.visible=!1;else{this.skillCDLabel.visible=!0;var n=t.toFixed(2);this.skillCDLabel.text=n+"s"}this.cdRect.percentWidth=1e5*t/e.config.cdMs,this.isCurSkill()?this.skillPreStateLabel.visible=!0:this.skillPreStateLabel.visible=!1}},t}(eui.Component);window.L1TouchLabel=n,__reflect(n.prototype,"L1TouchLabel",[])},function(e,t){var n=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(eui.UIEvent.COMPLETE,t.UIEventInit,t),t}return __extends(t,e),t.prototype.UIEventInit=function(){var e=this;this.bgRect.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.visible=!1},this)},t.prototype.initial=function(){var e=SceneManager.Ins.curScene,t=e.FocusChar;this.visible=!0,this.charNameLabel.text=t.config.name,this.maxHpLabel.text=""+t.attr.maxHp,this.hpRateRect.percentWidth=t.HP/t.attr.maxHp*100,this.hpRateRect.fillColor=t.camp==L2Camp.Player?ColorDef.LimeGreen:ColorDef.Red,this.atkNumLabel.text=""+t.attr.atk,this.defNumLabel.text=""+t.attr.def,this.actionSpeedLabel.text=""+t.attr.actionSpeed,this.moveRangeLabel.text=""+t.attr.moveRange,this.atkRangeLabel.text=""+t.attr.atkRange;var n=new(Array.bind.apply(Array,__spreadArrays([void 0,t.config.normalAtkSkillId],t.config.skillIds)));for(var r in n){var i=L2Config.SkillCfg[n[r]],a=new L2BattleSkillInfoButton(""+i.name,i.description);this.skillScrollerGroup.addChild(a),a.x=10+120*parseInt(r),a.y=10}for(var r in t.buffs.data){var o=t.buffs.data[r],i=o.config,a=new L2BattleSkillInfoButton(i.name+"\n\n剩余回合: "+o.duration,i.description);this.buffScrollerGroup.addChild(a),a.x=10+120*parseInt(r),a.y=10}this.descrGroup.visible=!1},t}(eui.Component);window.L2BattleInfo=n,__reflect(n.prototype,"L2BattleInfo",[])},function(e,t){var n=function(e){function t(t,n){var r=e.call(this)||this;return r.description=n,r.width=100,r.height=100,r.label=t,r.addEventListener(eui.UIEvent.COMPLETE,r.UIEventInit,r),r.addEventListener(egret.TouchEvent.TOUCH_TAP,r.onTap,r),r}return __extends(t,e),t.prototype.UIEventInit=function(){this.labelDisplay.size=16},t.prototype.onTap=function(){var e=SceneManager.Ins.curScene,t=e.mainUI.battleInfo;t.descrLabel.text=this.description,t.descrGroup.visible=!0},t}(eui.Button);window.L2BattleSkillInfoButton=n,__reflect(n.prototype,"L2BattleSkillInfoButton",[])},function(e,t){var n=function(e){function t(){var t=e.call(this)||this;return t.fires=[],t.width=GameRoot.StageWidth,t.height=GameRoot.StageHeight,t.battleInfo=new L2BattleInfo,t.addChild(t.battleInfo),t.battleInfo.width=GameRoot.StageWidth,t.battleInfo.height=GameRoot.StageHeight,t.battleInfo.visible=!1,t.addEventListener(eui.UIEvent.COMPLETE,t.UIEventInit,t),t}return __extends(t,e),t.prototype.UIEventInit=function(){this.backButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.backToMainScene,this),this.timePointLabel.text="0",this.timePointLabel.textColor=ColorDef.DarkOrange,this.roundLabel.text="1",this.roundLabel.textColor=ColorDef.DarkOrange,this.commandModeLabel.visible=!1;for(var e=SceneManager.Ins.curScene,t=e.enemies.concat(e.players),n=0,r=t;n<r.length;n++){var i=r[n];this.timeBarGroup.addChild(i.timeBarPort),i.setTime(i.attr.startTime)}this.showInfoImage.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showInfo,this),this.commandButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.commandButtonTap,this),this.moveButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.moveButtonTap,this),this.confirmButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.confirmButtonTap,this),this.skill1Button.addEventListener(egret.TouchEvent.TOUCH_TAP,this.skill1ButtonTap,this),this.skill2Button.addEventListener(egret.TouchEvent.TOUCH_TAP,this.skill2ButtonTap,this),this.disConfirmButton.addEventListener(egret.TouchEvent.TOUCH_TAP,this.disConfirmButtonTap,this)},t.prototype.showInfo=function(){this.battleInfo.initial()},t.prototype.commandButtonTap=function(){SceneManager.Ins.curScene.status.commandButtonTap()},t.prototype.moveButtonTap=function(){SceneManager.Ins.curScene.status.moveButtonTap()},t.prototype.confirmButtonTap=function(){SceneManager.Ins.curScene.status.confirmButtonTap()},t.prototype.skill1ButtonTap=function(){SceneManager.Ins.curScene.status.skill1ButtonTap()},t.prototype.skill2ButtonTap=function(){SceneManager.Ins.curScene.status.skill2ButtonTap()},t.prototype.disConfirmButtonTap=function(){SceneManager.Ins.curScene.status.disConfirmButtonTap()},t.prototype.removeFires=function(e){for(var t=0;e>t;t++)if(this.fires.length>0){var n=this.fires.pop();this.energyBarGroup.removeChild(n)}},t.prototype.addFires=function(e){for(var n=0;e>n;n++){var r=new egret.Shape;Util.drawCircle(r,9,ColorDef.DarkOrange),this.fires.push(r),this.energyBarGroup.addChild(r),r.x=t.fireDis*(this.fires.length-1)}},t.prototype.backToMainScene=function(){SceneManager.Ins.curScene.status.back()},t.prototype.release=function(){},t.fireDis=30,t}(eui.Component);window.L2MainUI=n,__reflect(n.prototype,"L2MainUI",[])},function(e,t){var n=function(e){function t(n){var r=e.call(this)||this;r["char"]=n,r.width=t.barPortWidth,r.height=r.width;var i=t.barPortWidth,a=new eui.Image(n.config.imgName);a.width=1.6*i,a.height=a.width;var o=(a.width-i)/2;return a.mask=new egret.Rectangle(o,o,i,i),r.addChild(a),a.x=-o,a.y=-o,r.charTimeLabel=new eui.Label,r.charTimeLabel.textColor=ColorDef.DarkRed,r.charTimeLabel.background=!0,r.charTimeLabel.backgroundColor=ColorDef.AntiqueWhite,r.charTimeLabel.textColor=n.camp==L2Camp.Player?ColorDef.LimeGreen:ColorDef.DarkRed,r.charTimeLabel.size=t.charTimeLabelSize,r.charTimeLabel.text="0",r.addChild(r.charTimeLabel),r.addEventListener(egret.TouchEvent.TOUCH_TAP,r.onTap,r),r}return __extends(t,e),t.prototype.onTap=function(){this.moveToTop(),MessageManager.Ins.sendMessage(MessageType.L2TIMEPORTTAP,this)},t.prototype.moveToTop=function(){this.parent.addChild(this)},t.prototype.setTime=function(e){var n=GameRoot.StageWidth-t.barWidthOffset;this.x=n*e/100,this.charTimeLabel.text=""+e},t.prototype.release=function(){this["char"]=null},t.charTimeLabelSize=18,t.barPortWidth=40,t.barWidthOffset=80,t}(eui.Group);window.L2TimeBarPort=n,__reflect(n.prototype,"L2TimeBarPort",[])},function(e,t){var n=function(){function e(){}return e.addOutGlowFilter=function(t){e.addFilter(t,e._outerGlowFilter)},e.removeOutGlowFilter=function(t){e.removeFilter(t,e._outerGlowFilter)},e.addGreyFilter=function(t){e.addFilter(t,e._greyColorFlilter)},e.removeGreyFilter=function(t){e.removeFilter(t,e._greyColorFlilter)},e.addYellowGlow=function(t){e.addFilter(t,e._outerGlowYellowFilter)},e.removeYellowGlow=function(t){e.removeFilter(t,e._outerGlowYellowFilter)},e.removeFilter=function(e,t){return e.filters?(Util.removeObjFromArray(e.filters,t)||console.log("object have no such filter"),void(0==e.filters.length&&(e.filters=null))):void console.log("没有发现滤镜，不应该有这个情况噢")},e.addFilter=function(e,t){e.filters?e.filters.push(t):e.filters=[t]},e._outerGlowFilter=new egret.GlowFilter(3394815,1,40,40,2,3,!1,!1),e._outerGlowYellowFilter=new egret.GlowFilter(15658496,1,40,40,2,3,!1,!1),e._greyColorFlilter=new egret.ColorMatrixFilter([.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0]),e}();window.L2Filters=n,__reflect(n.prototype,"L2Filters",[])},function(e,t){var n=function(){function e(){}return e.prototype.addFirst=function(e){},e.prototype.addLast=function(e){},e.prototype.remove=function(e){},e.prototype.popFirst=function(){return null},e.prototype.popLast=function(){return null},e.prototype.isContain=function(e){return!1},e.prototype.clear=function(){},e}();window.MyLinkedList=n,__reflect(n.prototype,"MyLinkedList",[]);var r=function(){function e(){}return e}();window.LinkedNode=r,__reflect(r.prototype,"LinkedNode",[])},function(e,t){var n=function(){function e(){this.data=[]}return e.prototype.add=function(e){var t=this.data;return t.indexOf(e)>=0?!1:(t.push(e),!0)},e.prototype.remove=function(e){return Util.removeObjFromArray(this.data,e)},e.prototype.removeAll=function(){this.data=[]},e.prototype.addList=function(e){for(var t=0,n=e;t<n.length;t++){var r=n[t];this.add(r)}},e.prototype.has=function(e){return this.data.indexOf(e)>=0},e}();window.MySet=n,__reflect(n.prototype,"MySet",[])},function(e,t){var n=function(){function e(){this._loadResouceLs=new MySet}return e.prototype.getResAsync=function(e,t,n){return this._loadResouceLs.add(e),null==t?RES.getResAsync(e):RES.getResAsync(e,t,n)},e.prototype.loadGroup=function(e,t,n){return this._loadResouceLs.add(e),RES.loadGroup(e,t,n)},e.prototype.getResAsyncAndSetValue=function(e,t,n){this.getResAsync(e,function(){n[t]=RES.getRes(e)},n)},e.prototype.releaseResource=function(){for(var e=0,t=this._loadResouceLs.data;e<t.length;e++){var n=t[e];RES.destroyRes(n)||console.warn("RES `"+n+"` destroy failed.")}},e}();window.ResAsyncLoader=n,__reflect(n.prototype,"ResAsyncLoader",[])},function(e,t){var n=function(){function e(){}return e.newToast=function(e,t,n,r,i,a,o,s,l,c,u){var f=this;void 0===t&&(t=ColorDef.DodgerBlue),void 0===n&&(n=60),void 0===r&&(r=0),void 0===i&&(i=-100),void 0===a&&(a=0),void 0===o&&(o=6e3),void 0===s&&(s=30),void 0===l&&(l=!0),void 0===c&&(c=egret.Ease.circOut),void 0===u&&(u=0);var h;h=this._labelPools.length>0?this._labelPools.pop():new eui.Label,h.textColor=t,h.horizontalCenter=r,h.y=n,h.alpha=1,h.size=s,h.text=e,h.bold=l,LayerManager.Ins.uiLayer.addChild(h),egret.Tween.get(h).to({},u).to({y:h.y+i,horizontalCenter:h.horizontalCenter+a,alpha:0},o,c).call(function(){LayerManager.Ins.uiLayer.removeChild(h),f._labelPools.push(h)})},e.newRedToast=function(t){e.newToast(t,ColorDef.Coral)},e._labelPools=[],e}();window.ToastInfoManager=n,__reflect(n.prototype,"ToastInfoManager",[])},function(e,t){var n=function(){function e(){}return e.removeObjFromArray=function(e,t){var n=e.indexOf(t);return n>=0?(e.splice(n,1),!0):!1},e.contains=function(e,t){return e.indexOf(t)>=0},e.createColorBG=function(e,t,n,r){void 0===n&&(n=ColorDef.DimGray),void 0===r&&(r=1);var i=new egret.Shape;return i.width=e,i.height=t,i.graphics.beginFill(n,r),i.graphics.drawRect(0,0,e,t),i.graphics.endFill(),i},e.safeRemoveFromParent=function(e){if(e){var t=e.parent;t&&t.removeChild(e)}},e.getRandomArray=function(e){for(var t=[],n=e.length;n>0;){var r=Math.floor(Math.random()*n);r==n&&(r-=1),t.push(e.splice(r,1)[0]),n-=1}return t},e.largeSmallTweenAnim=function(e,t,n,r){var i=e.x,a=e.y,o=e.width,s=e.height,l=o*t,c=s*n,u=i-(l-o)/2,f=a-(c-s)/2;egret.Tween.get(e,{loop:!0}).to({width:l,height:c,x:u,y:f},r).to({width:o,height:s,x:i,y:a},r)},e.httpGet=function(e,t,n,r,i){var a=new egret.HttpRequest;a.responseType=egret.HttpResponseType.TEXT,a.open(e,egret.HttpMethod.GET),a.send(),a.addEventListener(egret.Event.COMPLETE,t,i),a.addEventListener(egret.IOErrorEvent.IO_ERROR,n,i),a.addEventListener(egret.ProgressEvent.PROGRESS,r,i)},e.createBitmapByName=function(e){var t=new egret.Bitmap,n=RES.getRes(e);return t.texture=n,t},e.drawAngleCircle=function(e,t,n,i,a,o){void 0===i&&(i=0),void 0===a&&(a=ColorDef.DarkRed),void 0===o&&(o=1),e.graphics.clear(),e.graphics.beginFill(a,o),e.graphics.moveTo(0,0);
var s=i*r,l=Math.cos(s)*n,c=Math.sin(s)*n;e.graphics.lineTo(l,c),e.graphics.drawArc(0,0,n,s,t*Math.PI/180),e.graphics.lineTo(0,0),e.graphics.endFill()},e.drawCircle=function(e,t,n,r,i,a){void 0===n&&(n=ColorDef.Tan),void 0===r&&(r=0),void 0===i&&(i=0),void 0===a&&(a=1),e.graphics.clear(),e.graphics.beginFill(n,a),e.graphics.drawCircle(r,i,t),e.graphics.endFill()},e.drawSquar=function(e,t,n,r){void 0===n&&(n=ColorDef.Tan),void 0===r&&(r=1),this.drawRect(e,t,t,n,r)},e.drawRect=function(e,t,n,r,i){void 0===r&&(r=ColorDef.Tan),void 0===i&&(i=1),e.graphics.clear(),e.graphics.beginFill(r,i),e.graphics.drawRect(0,0,t,n),e.graphics.endFill()},e.pointDistance=function(e,t){var n=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(n*n+r*r)},e.getRad=function(t,n){var r=e.pointDistance(t,n),i=n[1]-t[1],a=n[0]-t[0],o=a/r,s=Math.acos(i/r);return o>0?s:-s},e.isNumEqual=function(e,t,n){return void 0===n&&(n=3),Math.abs(e-t)<n},e.degNormalize=function(e){return e%=360,e>180?e-360:-180>e?e+360:e},e.clamp=function(e,t,n){return t>e?t:e>n?n:e},e}();window.Util=n,__reflect(n.prototype,"Util",[]);var r=Math.PI/180;window.angle2RadParam=r},function(e,t){var n=function(){function e(){this._initialed=!1}return Object.defineProperty(e,"GameStage",{get:function(){return e.Ins._gameStage},enumerable:!1,configurable:!0}),Object.defineProperty(e,"StageWidth",{get:function(){return e.Ins._gameStage.stageWidth},enumerable:!1,configurable:!0}),Object.defineProperty(e,"StageHeight",{get:function(){return e.Ins._gameStage.stageHeight},enumerable:!1,configurable:!0}),Object.defineProperty(e,"Ins",{get:function(){return e._instance?e._instance:(e._instance=new e,e._instance)},enumerable:!1,configurable:!0}),e.prototype.init=function(e){UserData.initialData(),this._gameStage=e,MessageManager.Ins.initial(e),LayerManager.Ins.initial(),SceneManager.Ins.initial(),this._initialed=!0,this._gameStage.addEventListener(egret.Event.ENTER_FRAME,this.update,this)},e.prototype.update=function(){this._initialed&&SceneManager.Ins.update()},e}();window.GameRoot=n,__reflect(n.prototype,"GameRoot",[])},function(e,t){var n=function(){function e(){}return Object.defineProperty(e,"Ins",{get:function(){return null==this._instance&&(this._instance=new e),this._instance},enumerable:!1,configurable:!0}),e.prototype.initial=function(){this.loadingUI=new LoadingUI,this.loadingUI.initial(),this.uiLayer=new eui.UILayer,this.gameLayer=new egret.DisplayObjectContainer,GameRoot.GameStage.addChild(this.gameLayer),GameRoot.GameStage.addChild(this.uiLayer),this.uiLayer.touchThrough=!0,GameRoot.GameStage.addChild(this.loadingUI)},e.prototype.showLoadingUILayer=function(){this.loadingUI.clear(),this.loadingUI.visible=!0,this.loadingUI.touchEnabled=!0},e.prototype.hideLoadingUILayer=function(){this.loadingUI.visible=!1,this.loadingUI.touchEnabled=!1},e.prototype.clear=function(){this.gameLayer.removeChildren(),this.uiLayer.removeChildren()},e}();window.LayerManager=n,__reflect(n.prototype,"LayerManager",[])},function(e,t){var n=function(e){function t(){var t=e.call(this)||this;return t._listenerList=[],t}return __extends(t,e),Object.defineProperty(t,"Ins",{get:function(){return null==this.instance&&(this.instance=new t),this.instance},enumerable:!1,configurable:!0}),t.prototype.initial=function(e){e.addChild(this)},t.prototype.sendMessage=function(e,t){void 0===t&&(t=null),this.dispatchEvent(new r(t,e))},t.prototype.addEventListener=function(t,n,r){e.prototype.addEventListener.call(this,t,n,r),this._listenerList.push([t,n,r])},t.prototype.clearListener=function(){for(var e=0,t=this._listenerList;e<t.length;e++){var n=t[e],r=n[0],i=n[1],a=n[2];this.removeEventListener(r,i,a)}this._listenerList=[]},t}(egret.DisplayObject);window.MessageManager=n,__reflect(n.prototype,"MessageManager",[]);var r=function(e){function t(t,n,r,i){void 0===r&&(r=!1),void 0===i&&(i=!1);var a=e.call(this,n,r,i)||this;return a.messageContent=t,a}return __extends(t,e),t}(egret.Event);window.Message=r,__reflect(r.prototype,"Message",[])},function(e,t){var n=function(){function e(){this._timeScale=1,this._frameCount=0,this._isFrame30Play=[];for(var e=0;30>e;e++)this._isFrame30Play[e]=!0}return Object.defineProperty(e.prototype,"TimeScale",{set:function(e){if(this._frameCount=0,e>1)return void(this._timeScale=1);this._timeScale=e;var t=Math.ceil(30-30*this._timeScale);this.set30PlayArray(t),console.log(this._isFrame30Play)},enumerable:!1,configurable:!0}),Object.defineProperty(e,"Ins",{get:function(){return e._instance?e._instance:(e._instance=new e,e._instance)},enumerable:!1,configurable:!0}),e.prototype.initial=function(){},e.prototype.set30PlayArray=function(e){var t=30-e,n=!1;e>t&&(n=!0,t=e,e=30-t);for(var r=t/e,i=r,a=0,o=0;30>o;o++)t>0?i>a?(this._isFrame30Play[o]=!0,a+=1,t-=1):(this._isFrame30Play[o]=!1,i+=r):this._isFrame30Play[o]=!1;n&&this.playBoolReverse()},e.prototype.playBoolReverse=function(){for(var e=0;30>e;e++)this._isFrame30Play[e]=!this._isFrame30Play[e]},e.prototype.update=function(){return this._timeScale<.034?!1:this._timeScale>.966?!0:(this._frameCount=this._frameCount+1,this._frameCount>=30&&(this._frameCount=0),this._isFrame30Play[this._frameCount])},e}();window.TimeScaleManager=n,__reflect(n.prototype,"TimeScaleManager",[])},function(e,t){var n;!function(e){e[e.DodgerBlue=2003199]="DodgerBlue",e[e.GhostWhite=16316671]="GhostWhite",e[e.Coral=16744272]="Coral",e[e.Tan=13808780]="Tan",e[e.AntiqueWhite=16444375]="AntiqueWhite",e[e.DarkOrange=16747520]="DarkOrange",e[e.LimeGreen=3329330]="LimeGreen",e[e.DarkRed=9109504]="DarkRed",e[e.White=16777215]="White",e[e.DarkGray=11119017]="DarkGray",e[e.DimGray=6908265]="DimGray",e[e.Black=0]="Black",e[e.Chocolate=13789470]="Chocolate",e[e.Orange=16753920]="Orange",e[e.Gold=16766720]="Gold",e[e.Yellow=16776960]="Yellow",e[e.GreenYellow=11403055]="GreenYellow",e[e.DarkViolet=9699539]="DarkViolet",e[e.Red=16711680]="Red"}(n||(n={})),window.ColorDef=n},function(e,t){var n;!function(e){e.L1CRTNDESTROYED="L1CRTNDESTROYED",e.L1BATTLEUIPORTTAP="L1BATTLEUIPORTTAP",e.L1BATTLECHARTAP="L1BATTLECHARTAP",e.L1BATTLECHARPORTTAP="L1BATTLECHARPORTTAP",e.L1TOUCHLABELTAP="L1TOUCHLABELTAP",e.L2CELLTAP="L2CELLTAP",e.L2CHARTAP="L2CHARTAP",e.L2TIMEPORTTAP="L2TIMEPORTTAP",e.L2USEENERGY="L2USEFIRE",e.L2ADDENERGY="L2ADDFIRE",e.L2BuffTriggerTime="L2BuffTriggerTime"}(n||(n={})),window.MessageType=n},function(e,t){var n=function(){function e(){this.isInitialed=!1}return e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e.prototype.initial=function(){},e.prototype.releaseResource=function(){},e.prototype.defaultRelease=function(){egret.Tween.removeAllTweens(),LayerManager.Ins.clear(),MessageManager.Ins.clearListener()},e.prototype.release=function(){},e.prototype.update=function(){},e}();window.IScene=n,__reflect(n.prototype,"IScene",[])},function(e,t){var n=function(){function e(){}return Object.defineProperty(e,"Ins",{get:function(){return e._instance?e._instance:(e._instance=new e,e._instance)},enumerable:!1,configurable:!0}),e.prototype.initial=function(){this.setScene(new StartScene)},e.prototype.setScene=function(e){LayerManager.Ins.showLoadingUILayer();var t=this.curScene;this.curScene=e,null!=t&&(t.defaultRelease(),t.release(),t.releaseResource(),t=null),this.loadScene(e)},e.prototype.loadScene=function(e){var t=this;e.loadResource().then(function(){e.initial(),e.isInitialed=!0,t.onSceneLoadingCompelete()})},e.prototype.onSceneLoadingCompelete=function(){LayerManager.Ins.hideLoadingUILayer()},e.prototype.update=function(){null!=this.curScene&&this.curScene.isInitialed&&this.curScene.update()},e}();window.SceneManager=n,__reflect(n.prototype,"SceneManager",[])},function(e,t){var n=function(){function e(){}return e.initialData=function(){var t=e.getObject("L1Data");this.l1Data=new L1Data,t&&this.l1Data.initialByData(t)},e.setObject=function(e,t){egret.localStorage.setItem(e,JSON.stringify(t))},e.getObject=function(e){return JSON.parse(egret.localStorage.getItem(e))},e.removeKey=function(e){egret.localStorage.removeItem(e)},e.clearLocalData=function(){egret.localStorage.clear(),this.initialData()},e}();window.UserData=n,__reflect(n.prototype,"UserData",[])},function(e,t){var n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.initial=function(){LayerManager.Ins.uiLayer.addChild(new MainUI)},t}(IScene);window.MainScene=n,__reflect(n.prototype,"MainScene",[])},function(e,t){var n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.initial=function(){var e=new StartPanel;LayerManager.Ins.uiLayer.addChild(e)},t}(IScene);window.StartScene=n,__reflect(n.prototype,"StartScene",[])},function(e,t){var n=function(){function e(e,t){var n=this;this.curAnger=0,this._angerAddFrame=0,this.inSkillCasting=!1,this._destPos=[0,0],this.curSkillIndex=0,this.alive=!0,this.camp=e,this.skillManager=SceneManager.Ins.curScene.skillManager,this.charId=t;var r=L1Config.Ins.L1CHARCFGS[t];this._charPort=new L1CharPortr(e,r.portImageName,t),this.name=r.name,this.rawAttr=r.attr,this.skills=r.skills.map(function(e){return L1SkillManager.Ins.newSkill(e,n)}),this.maxHp=this.rawAttr.maxHp,this.curHp=this.maxHp,this.curAnger=0,this.def=this.rawAttr.def,this.atk=this.rawAttr.atk,this.dodgePoint=this.rawAttr.dodgePoint,this.critPoint=this.rawAttr.critPoint,this.critTime=this.rawAttr.critTime,this._angerAddFrame=this.rawAttr.angerAdds/60,this.normalAttackSkill=this.skillManager.newSkill(r.normalSkill,this),this.buffStatus=new MySet,this.buffs=new MySet,MessageManager.Ins.addEventListener(MessageType.L1BATTLECHARPORTTAP,this.portTap,this)}return e.prototype.addAngerNumber=function(e){var t=this.curAnger+e;t>L1CharAttr.MAXANGER&&(t=L1CharAttr.MAXANGER),this.curAnger=t,this._charPort.initialed&&this._charPort.drawAngerCircle(t/L1CharAttr.MAXANGER)},Object.defineProperty(e.prototype,"x",{get:function(){return this._charPort.x},set:function(e){this._charPort.x=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._charPort.y},set:function(e){this._charPort.y=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pos",{get:function(){return[this.x,this.y]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rotation",{get:function(){return this._charPort.rotationCircle.rotation},set:function(e){this._charPort.rotationCircle.rotation=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"moveSpeed",{get:function(){return this.rawAttr.moveSpeed},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rotationSpeed",{get:function(){return this.rawAttr.rotationSpeed},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"curHp",{get:function(){return this._curHp},set:function(e){this.alive&&(e>this.maxHp&&(e=this.maxHp),0>=e?(this._curHp=0,this.alive=!1,this._charPort.drawHpCircle(0),this.removeFromScene()):(this._curHp=e,this._charPort.initialed&&this._charPort.drawHpCircle(e/this.maxHp)))},enumerable:!1,configurable:!0}),e.prototype.portTap=function(e){e.messageContent==this._charPort&&MessageManager.Ins.sendMessage(MessageType.L1BATTLECHARTAP,this)},e.prototype.initial=function(e,t){this.oppos=e,this.coops=t;var n=t.indexOf(this),r=this.camp==L1Camp.Player?-1:1;this.x=(130*Math.floor(n/2)+130)*r+GameRoot.GameStage.stageWidth/2,this.y=(n%2*2-1)*(70+100*Math.floor(n/2))+500,this.camp==L1Camp.Enemy&&(this.rotation=180)},e.prototype.update=function(){if(this.alive&&(this.addAngerNumber(this._angerAddFrame),!this.isDizz()&&!this.inSkillCasting&&(null!=this.normalAttakTarget&&this.normalAttakTarget.alive||(this.normalAttakTarget=this.findNormalATKTarget(this.oppos)),null!=this.normalAttakTarget))){var e=this.findATKLocation();if(this._destPos=[Math.ceil(e[0]),Math.ceil(e[1])],!this.isSamePos([this.x,this.y],this._destPos)){this.movingTo(this._destPos);var t=this.getRotationToPos(this._destPos);return t=this.getPropDestRotation(t),void this.rotTo(t)}var n=this.getRotationToPos([this.normalAttakTarget.x,this.normalAttakTarget.y]);if(n=this.getPropDestRotation(n),this.rotTo(n),Util.isNumEqual(this.rotation,n)){if(this.curAnger==L1CharAttr.MAXANGER&&!this.isSlient()){var r=this.curSkillIndex,i=this.skills[r];if(i.isCoolDown())return this.skillManager.castSkill(i),this.addAngerNumber(-L1CharAttr.MAXANGER),this.curSkillIndex=r+1,void(this.curSkillIndex==this.skills.length&&(this.curSkillIndex=0))}this.targetInRange()&&this.normalAttackSkill.isCoolDown()&&this.skillManager.castSkill(this.normalAttackSkill)}}},e.prototype.getRotationToPos=function(e){var t=Util.getRad([this.x,this.y],e);return Math.ceil(Util.degNormalize(90-t/angle2RadParam))},e.prototype.getPropDestRotation=function(e){var t=Math.abs(e-this.rotation),n=Math.abs(e+360-this.rotation),r=Math.abs(e-360-this.rotation);return t>n?e+360:t>r?e-360:e},e.prototype.isSamePos=function(e,t,n){return void 0===n&&(n=6),Math.abs(e[0]-t[0])+Math.abs(e[1]-t[1])<=n},e.prototype.movingTo=function(e){var t=Util.getRad([this.x,this.y],e),n=1/GameRoot.GameStage.frameRate,r=n*this.moveSpeed;this.x=Math.ceil(this.x+r*Math.sin(t)),this.y=Math.ceil(this.y+r*Math.cos(t))},e.prototype.startAnim=function(e,t){this._charPort.startAnim(e,t)},e.prototype.rotTo=function(e){if(!Util.isNumEqual(e,this.rotation)){var t=1/GameRoot.GameStage.frameRate,n=t*this.rotationSpeed;return Math.abs(this.rotation-e)<n?void(this.rotation=e):this.rotation>e?void(this.rotation-=n):this.rotation<e?void(this.rotation+=n):void 0}},e.prototype.findNormalATKTarget=function(e){for(var t=Number.MAX_VALUE,n=null,r=0,i=e;r<i.length;r++){var a=i[r];if(a.alive){var o=this.disFrom(a);t>o&&(n=a,t=o)}}return n},e.prototype.disFrom=function(e){return Util.pointDistance([e.x,e.y],[this.x,this.y])},e.prototype.targetInRange=function(){return this.rawAttr.range-this.disFrom(this.normalAttakTarget)>-10},e.prototype.findATKLocation=function(){var e,t,n,r;if((null==this.normalAttakTarget||this.targetInRange())&&this.isPosLegal(this.x,this.y))return[this.x,this.y];var i=this.normalAttakTarget.x,a=this.normalAttakTarget.y,o=0,s=0,l=Util.getRad([i,a],[this.x,this.y]),c=30*angle2RadParam;if(e=this.getLinePosByRad([i,a],l,this.rawAttr.range),o=e[0],s=e[1],this.isPosLegal(o,s))return[o,s];for(var u=l,f=1;12>f;f++)if(u+=c,t=this.getLinePosByRad([i,a],u,this.rawAttr.range),o=t[0],s=t[1],this.isPosLegal(o,s))return[o,s];for(var h=this.rawAttr.range-L1CharAttr.CHARMINDIS/4;h>L1CharAttr.CHARMINDIS;){if(n=this.getLinePosByRad([i,a],l,h),o=n[0],s=n[1],this.isPosLegal(o,s))return[o,s];h-=L1CharAttr.CHARMINDIS/4}h=this.rawAttr.range+L1CharAttr.CHARMINDIS/4;for(var p=this.disFrom(this.normalAttakTarget);p>h;){if(r=this.getLinePosByRad([i,a],l,h),o=r[0],s=r[1],this.isPosLegal(o,s))return[o,s];h+=L1CharAttr.CHARMINDIS/4}return[this.x,this.y]},e.prototype.getLinePosByRad=function(e,t,n){var r=e[0]+n*Math.sin(t),i=e[1]+n*Math.cos(t);return[r,i]},e.prototype.isPosLegal=function(e,t){var n=L1CharAttr.CHARMINDIS/2,r=L1CharAttr.CHARMINDIS/2,i=GameRoot.GameStage.stageWidth-L1CharAttr.CHARMINDIS/2,a=GameRoot.GameStage.stageHeight-L1CharAttr.CHARMINDIS/2;if(n>e||r>t||e>i||t>a)return!1;for(var o=0,s=[this.oppos,this.coops];o<s.length;o++)for(var l=s[o],c=0,u=l;c<u.length;c++){var f=u[c];if(f.alive&&f!=this&&Util.pointDistance([e,t],[f.x,f.y])<L1CharAttr.CHARMINDIS&&Util.pointDistance([e,t],f._destPos)<L1CharAttr.CHARMINDIS)return!1}return!0},e.prototype.addToScene=function(){LayerManager.Ins.gameLayer.addChild(this._charPort)},e.prototype.removeFromScene=function(){LayerManager.Ins.gameLayer.removeChild(this._charPort)},e.prototype.endSkillCast=function(){egret.Tween.removeTweens(this._charPort.contentGroup)},Object.defineProperty(e.prototype,"DODGE",{get:function(){return Math.min(L1CharAttr.MAXDODGEP,this.dodgePoint)},enumerable:!1,configurable:!0}),e.prototype.isDizz=function(){return L1BuffStatus.DIZZ in this.buffStatus},e.prototype.isSlient=function(){return L1BuffStatus.SLIENT in this.buffStatus},e.prototype.refreshBuffAttr=function(){for(var e=[],t=0,n=this.buffs.data;t<n.length;t++){var r=n[t],i=r.config.isAffectDudge(this,r.caster);r.config.buffType==L1BuffType.ATTRCHANGE&&i&&e.push(r)}for(var a={},o={},s=0,l=L1CharAttr.ATTRNAMES;s<l.length;s++){var c=l[s];a[c]=0,o[c]=0}for(var u=0,f=e;u<f.length;u++)for(var r=f[u],h=0,p=L1CharAttr.ATTRNAMES;h<p.length;h++){var c=p[h];c in r.config.attrAddAbs&&(a[c]+=r.config.attrAddAbs[c]),c in r.config.attrAddRatio&&(o[c]+=r.config.attrAddRatio[c])}this.atk=this.rawAttr.atk*(1+o[L1ATTRNAME.ATK])+a[L1ATTRNAME.ATK],this.def=this.rawAttr.def*(1+o[L1ATTRNAME.DEF])+a[L1ATTRNAME.DEF],this.critPoint=this.rawAttr.critPoint*(1+o[L1ATTRNAME.CRITP])+a[L1ATTRNAME.CRITP],this.dodgePoint=this.rawAttr.dodgePoint*(1+o[L1ATTRNAME.DODGEP])+a[L1ATTRNAME.DODGEP];var g=this.rawAttr.maxHp*(1+o[L1ATTRNAME.MAXHP])+a[L1ATTRNAME.MAXHP];if(g>this.maxHp){var d=g-this.maxHp;this.curHp+=d,this.maxHp=g}this.critTime=this.rawAttr.critTime*(1+o[L1ATTRNAME.CRITT])+a[L1ATTRNAME.CRITT]},e.prototype.refreshBuffStatus=function(){this.buffStatus.removeAll();for(var e=[],t=0,n=this.buffs.data;t<n.length;t++){var r=n[t],i=r.config.isAffectDudge(this,r.caster);r.config.buffType==L1BuffType.STATUS&&i&&e.push(r.config.status)}for(var a=0,o=e;a<o.length;a++){var s=o[a];this.buffStatus.add(s)}this.isDizz()?this._charPort.toDizz():this._charPort.outDizz(),this.isSlient()?this._charPort.toSlient():this._charPort.outSlient()},e}();window.L1Char=n,__reflect(n.prototype,"L1Char",[])},function(e,t){var n;!function(e){e.MAXHP="MAXHP",e.ATK="ATK",e.DEF="DEF",e.CRITP="CRITP",e.DODGEP="DODGEP",e.CRITT="CRITT"}(n||(n={})),window.L1ATTRNAME=n},function(e,t){var n=function(){function e(e,t,n,r,i,a,o,s){this.maxHp=e,this.atk=t,this.def=n,this.range=r,this.critPoint=i,this.dodgePoint=a,this.critTime=o,this.posNum=s,this.moveSpeed=160,this.rotationSpeed=180,this.angerAdds=20}return e.ATTRNAMES=[L1ATTRNAME.MAXHP,L1ATTRNAME.ATK,L1ATTRNAME.DEF,L1ATTRNAME.CRITP,L1ATTRNAME.DODGEP,L1ATTRNAME.CRITT],e.MAXANGER=100,e.CHARMINDIS=60,e.MAXDODGEP=80,e}();window.L1CharAttr=n,__reflect(n.prototype,"L1CharAttr",[])},function(e,t){var n=function(){function e(e,t,n,r,i,a){this.attr=e,this.skills=t,this.normalSkill=n,this.passiveSkills=r,this.name=i,this.portImageName=a}return e}();window.L1CharConfig=n,__reflect(n.prototype,"L1CharConfig",[])},function(e,t){var n=function(e){function t(t,n,r){void 0===r&&(r=0);var i=e.call(this)||this;return i._portImage=n,i._charId=r,i._camp=t,i.initialed=!1,i.addEventListener(eui.UIEvent.COMPLETE,i.UIEventEndInit,i),i.addEventListener(egret.TouchEvent.TOUCH_TAP,i.tapEvent,i),i}return __extends(t,e),t.prototype.tapEvent=function(){MessageManager.Ins.sendMessage(MessageType.L1BATTLECHARPORTTAP,this)},t.prototype.UIEventEndInit=function(){this.portImage.source=this._portImage,this.portImage.mask=this.portMask,this._camp==r.Player?this.hpNumCircle.fillColor=ColorDef.LimeGreen:this.hpNumCircle.fillColor=ColorDef.DarkRed,this.angerNumMask=new egret.Shape,this.contentGroup.addChild(this.angerNumMask),this.angerNumCircle.mask=this.angerNumMask,this.drawAngerCircle(0),this.hpNumMask=new egret.Shape,this.contentGroup.addChild(this.hpNumMask),this.hpNumCircle.mask=this.hpNumMask,this.drawHpCircle(1),this.rotationPoint.fillColor=this._camp==r.Player?ColorDef.LimeGreen:ColorDef.DarkRed;this.initialed=!0},t.prototype.drawHpCircle=function(e){this.hpNumMask.x=0,this.hpNumMask.y=0,this.drawCircle(this.hpNumMask,360*e,this.hpNumCircle.width/2),this.hpNumMask.x=this.contentGroup.width/2,this.hpNumMask.y=this.contentGroup.width/2},t.prototype.drawAngerCircle=function(e){this.angerNumMask.x=0,this.angerNumMask.y=0,this.drawCircle(this.angerNumMask,360*e,this.angerNumCircle.width/2),this.angerNumMask.x=this.contentGroup.width/2,this.angerNumMask.y=this.contentGroup.width/2},t.prototype.drawCircle=function(e,t,n){var r=-90;t-=90,Util.drawAngleCircle(e,t,n,r)},t.prototype.startAnim=function(e,t){egret.Tween.removeTweens(this.contentGroup);var n=this.rotationCircle.rotation*angle2RadParam,r=e[0],i=this.getAngleCoorSysPos(r,n),a=i[0],o=i[1];this.contentGroup.x=a,this.contentGroup.y=o;for(var s=egret.Tween.get(this.contentGroup),l=0;l<t.length;l++){var c=this.getAngleCoorSysPos(e[l+1],n),u=c[0],f=c[1],h=t[l];s.to({x:u,y:f},h)}},t.prototype.getAngleCoorSysPos=function(e,t){var n=e[0],r=e[1],i=Math.cos(-t),a=Math.sin(-t),o=n*i+r*a,s=r*i-n*a;return[o,s]},t.prototype.toDizz=function(){this.dizzLabel.visible=!0},t.prototype.outDizz=function(){this.dizzLabel.visible=!1},t.prototype.toSlient=function(){this.slientLabel.visible=!0},t.prototype.outSlient=function(){this.slientLabel.visible=!1},t}(eui.Component);window.L1CharPortr=n,__reflect(n.prototype,"L1CharPortr",[]);var r;!function(e){e[e.Enemy=1]="Enemy",e[e.Player=-1]="Player"}(r||(r={})),window.L1Camp=r},function(e,t){var n=function(){function e(){this.currentMainStoryId=0,this.userUseCharIds=[1,2,3,4],this.userAllCharIds=[1,2,3,4,5,6,7,8]}return Object.defineProperty(e.prototype,"CurMainStoryId",{get:function(){return this.currentMainStoryId},set:function(e){this.currentMainStoryId=e,this.writeData()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"UserUseCharIds",{get:function(){return this.userUseCharIds},set:function(e){this.userUseCharIds=e,this.writeData()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"UserAllCharIds",{get:function(){return this.userAllCharIds},enumerable:!1,configurable:!0}),e.prototype.initialByData=function(e){for(var t in e)this[t]=e[t]},e.prototype.writeData=function(){UserData.setObject("L1Data",this)},e}();window.L1Data=n,__reflect(n.prototype,"L1Data",[]);var r;!function(e){e[e.MainStory=0]="MainStory"}(r||(r={})),window.L1LevelType=r},function(e,t){var n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.initial=function(){LayerManager.Ins.uiLayer.addChild(new L1MainUI)},t}(IScene);window.L1MainScene=n,__reflect(n.prototype,"L1MainScene",[])},function(e,t){var n=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._resLoad=new ResAsyncLoader,t._players=[],t._enemies=[],t._battleEnd=!1,t._battleStart=!1,t}return __extends(t,e),Object.defineProperty(t.prototype,"BattleEnd",{get:function(){return this._battleEnd},set:function(e){if(this._battleEnd=e,1==e&&this._victoryCamp==L1Camp.Player){if(UserData.l1Data.levelType==L1LevelType.MainStory){var t=Object.keys(L1Config.Ins.L1LevelCFGS).length-1,n=UserData.l1Data.CurMainStoryId+1;t>=n&&(UserData.l1Data.CurMainStoryId=n)}this._battleSceneUI.battleEnd(!0)}1==e&&this._victoryCamp==L1Camp.Enemy&&this._battleSceneUI.battleEnd(!1)},enumerable:!1,configurable:!0}),t.prototype.initial=function(){this.skillManager=new L1SkillManager,this.creationManager=new L1CreationManager,this.buffManager=new L1BuffManager,this._battleSceneUI=new L1BattleSceneUI,LayerManager.Ins.uiLayer.addChild(this._battleSceneUI),this.initialGameLayer()},t.prototype.initialGameLayer=function(){for(var e=this,t=this.readEnemiesIds(),n=0,r=t;n<r.length;n++){var i=r[n],a=new L1Char(L1Camp.Enemy,i);a.addToScene(),this._enemies.push(a)}for(var o=UserData.l1Data.UserUseCharIds,s=0,l=o;s<l.length;s++){var i=l[s],a=new L1Char(L1Camp.Player,i);a.addToScene(),this._players.push(a)}this._enemies.sort(function(e,t){return e.rawAttr.posNum-t.rawAttr.posNum}),this._players.sort(function(e,t){return e.rawAttr.posNum-t.rawAttr.posNum}),this._enemies.forEach(function(t){t.initial(e._players,e._enemies)}),this._players.forEach(function(t){t.initial(e._enemies,e._players)})},t.prototype.readEnemiesIds=function(){return UserData.l1Data.levelType==L1LevelType.MainStory?L1Config.Ins.L1LevelCFGS[UserData.l1Data.CurMainStoryId]:void 0},t.prototype.battleStart=function(){this._battleStart=!0},t.prototype.removeChar=function(e){for(var t=-1,n=0;n<this._players.length;n++)if(this._players[n].charId==e){t=n;break}if(-1==t)return void console.warn("哪里不对劲");var r=this._players[t];r.removeFromScene(),this._players.splice(t,1),this.endReplace()},t.prototype.addChar=function(e){var t=new L1Char(L1Camp.Player,e);t.addToScene(),this._players.push(t),this.endReplace()},t.prototype.endReplace=function(){var e=this;this._players.sort(function(e,t){return e.rawAttr.posNum-t.rawAttr.posNum}),this._players.forEach(function(t){t.initial(e._enemies,e._players)})},t.prototype.update=function(){if(this._battleStart&&!this.BattleEnd){var e=0,t=0;if([this._enemies,this._players].forEach(function(n){n.forEach(function(n){n.alive&&(n.camp==L1Camp.Enemy&&t++,n.camp==L1Camp.Player&&e++)})}),0==e)return this._victoryCamp=L1Camp.Enemy,this.BattleEnd=!0,void ToastInfoManager.newRedToast("战斗失败");if(0==t)return this._victoryCamp=L1Camp.Player,this.BattleEnd=!0,void ToastInfoManager.newRedToast("战斗胜利");this.skillManager.update(),this.creationManager.update(),this.buffManager.update(),this._battleSceneUI.update(),[this._enemies,this._players].forEach(function(e){e.forEach(function(e){e.update()})})}},t.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this._resLoad.loadGroup("portrait",0,LayerManager.Ins.loadingUI)];case 1:return e.sent(),[2]}})})},t.prototype.releaseResource=function(){this._resLoad.releaseResource()},t}(IScene);window.L1NormalBattleScene=n,__reflect(n.prototype,"L1NormalBattleScene",[])},function(e,t){var n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.initial=function(){LayerManager.Ins.uiLayer.addChild(new L1MainUI)},t}(IScene);window.L1RoughlikeScene=n,__reflect(n.prototype,"L1RoughlikeScene",[])},function(e,t){var n=function(){function e(){this.L1CHARCFGS=this.GetCHARCFGS(),this.L1LevelCFGS=this.GetL1LevelCFGS()}return Object.defineProperty(e,"Ins",{get:function(){return this._instance?this._instance:(this._instance=new e,this._instance)},enumerable:!1,configurable:!0}),e.prototype.GetCHARCFGS=function(){var e={TEMPLATE:new L1HarmConfig(function(e,t){return[!0,0]}),HEAL01:new L1HarmConfig(function(e,t){var n=L1Harm.isRandTrue(e.critPoint),r=.2*e.maxHp;return n&&(r*=e.critTime),[n,-r]})},t={TEMPLATE:new L1BuffConfig("TEMPLATE","模版",1e3,1e3,L1BuffType.ATTRCHANGE,L1BuffStatus.NORMAL,"",{},{},function(e,t){},function(e,t){return!0}),BUFF01:new L1BuffConfig("BUFF01","攻击+10",3e3,1e3,L1BuffType.ATTRCHANGE,L1BuffStatus.NORMAL,"攻击 +10",{ATK:10}),BUFF02:new L1BuffConfig("BUFF02","每1s对自身造成10点伤害，持续10s",1e4,1e3,L1BuffType.AFFECTPERIOD,L1BuffStatus.NORMAL,"持续掉血",null,null,function(e,n){L1Harm.harm(n,[e],new L1HarmConfig(function(){return[!1,10]})),L1BuffManager.Ins.newBuff(t.BUFF01,e,n)})},n={TEMPLATE:new L1CreationConfig(100,L1CrtnFlyType.FIX,L1CrTnAffectContType.ONECE,L1CrTnAffectTargetSetType.PRESET,L1CrtnAffectTargetCamp.OTHER,400,1e3,200,function(e,t){},.9,ColorDef.DarkOrange),NORMBULLET01:new L1CreationConfig(5,L1CrtnFlyType.CHAR,L1CrTnAffectContType.ONECE,L1CrTnAffectTargetSetType.PRESET,L1CrtnAffectTargetCamp.OTHER,800,1,10,function(e,t){L1Harm.harm(t,e)},1,ColorDef.DarkOrange)},r={TEMPLATE:new L1SkillConfig("",1e3,{0:function(){}},function(e){return null},"模版"),NROMATK:new L1SkillConfig("",1e3,{0:function(e){e.caster.startAnim([[0,0],[10,0],[-5,0],[0,0]],[75,100,50]),e.caster.addAngerNumber(15)},75:function(e){L1Harm.harm(e.caster,e.targets)},225:function(){}},function(e){return[e.caster.normalAttakTarget]},"普通攻击"),NORMRANGATK:new L1SkillConfig("",1e3,{0:function(e){e.caster.startAnim([[0,0],[10,0],[-5,0],[0,0]],[75,100,50]),e.caster.addAngerNumber(15),e.newCreation(n.NORMBULLET01,e.caster,e.targets[0],e.caster.pos,e.targets[0].pos),e.newBuff(t.BUFF01,e.caster,e.caster)},225:function(){}},function(e){return[e.caster.normalAttakTarget]},"远程普通攻击"),HEALSKILL:new L1SkillConfig("风灵颂",1e4,{0:function(e){e.caster.startAnim([[0,0],[0,10],[0,-10],[0,0]],[75,150,75])},150:function(n){L1Harm.harm(n.caster,n.targets,e.HEAL01),n.newBuff(t.BUFF01,n.caster,n.caster)}},function(e){return[e.caster]},"这是一个治疗技能，回复自身最大血量的20%，但在随后的10s内每s失去10血量"),TEST01:new L1SkillConfig("测试大招",4e4,{0:function(e){e.caster.startAnim([[0,0],[0,20],[0,-20],[0,0],[-20,0],[20,0],[0,0]],[75,150,75,75,150,75])},150:function(t){L1Harm.harm(t.caster,t.targets,e.HEAL01)},600:function(e){e.caster.startAnim([[0,0],[0,20],[0,0]],[2e3,2e3])},5e3:function(e){}},function(e){return[e.caster]},"这是一个特别沙雕的技能，首先让角色进入癫痫，然后给自己治疗20%血量，之后像喝醉了一样，进入5s的贤者时间"),TEST02:new L1SkillConfig("测试小技能",2e4,{0:function(e){e.caster.startAnim([[0,0],[0,10],[0,-10],[0,0]],[75,150,75])},150:function(e){}},function(e){return[e.caster]},"这是一个无法描述的技能，因为他没有任何效果，只会让你的英雄傻站着不动")};return{1:new L1CharConfig(new L1CharAttr(1e3,200,200,400,10,10,1.2,100),[r.HEALSKILL,r.TEST01,r.TEST02],r.NORMRANGATK,[],"测试角色1","1_portrait_png"),2:new L1CharConfig(new L1CharAttr(1e3,200,200,120,10,10,1.2,0),[r.HEALSKILL,r.TEST01,r.TEST02],r.NROMATK,[],"测试角色2","2_portrait_png"),3:new L1CharConfig(new L1CharAttr(1e3,200,200,400,10,10,1.2,200),[r.HEALSKILL,r.TEST01,r.TEST02],r.NORMRANGATK,[],"测试角色3","3_portrait_png"),4:new L1CharConfig(new L1CharAttr(1e3,200,200,400,10,10,1.2,200),[r.HEALSKILL,r.TEST01,r.TEST02],r.NORMRANGATK,[],"测试角色4","4_portrait_png"),5:new L1CharConfig(new L1CharAttr(1e3,200,200,400,10,10,1.2,200),[r.HEALSKILL,r.TEST01,r.TEST02],r.NORMRANGATK,[],"测试角色5","5_portrait_png"),6:new L1CharConfig(new L1CharAttr(1e3,200,200,400,10,10,1.2,200),[r.HEALSKILL,r.TEST01,r.TEST02],r.NORMRANGATK,[],"测试角色6","6_portrait_png"),7:new L1CharConfig(new L1CharAttr(1e3,200,200,400,10,10,1.2,200),[r.HEALSKILL,r.TEST01,r.TEST02],r.NORMRANGATK,[],"测试角色7","7_portrait_png"),8:new L1CharConfig(new L1CharAttr(1e3,200,200,400,10,10,1.2,200),[r.HEALSKILL,r.TEST01,r.TEST02],r.NORMRANGATK,[],"测试角色8","8_portrait_png")}},e.prototype.GetL1LevelCFGS=function(){return{0:[1,1],1:[1,1,1],2:[1,1,2,2]}},e}();window.L1Config=n,__reflect(n.prototype,"L1Config",[])},function(e,t){var n=function(){function e(){this._castframeCount=0,this._creationManager=SceneManager.Ins.curScene.creationManager,this._buffManager=SceneManager.Ins.curScene.buffManager}return e.prototype.initial=function(e,t){this.caster=e,this.config=t;var n=GameRoot.GameStage.frameRate/1e3;this._frameCD=Math.ceil(this.config.cdMs*n);var r=this.config.timeLine,i={};for(var a in r)i[Math.ceil(parseInt(a)*n)]=r[a];this._endFrame=0;for(var a in i){var o=parseInt(a);o>this._endFrame&&(this._endFrame=o)}this._endFrame+=1,this.timeLine=i,this._runCd=0},e.prototype.release=function(){},Object.defineProperty(e.prototype,"CDRUN",{get:function(){return this._runCd},set:function(e){0>=e&&(e=0),this._runCd=e},enumerable:!1,configurable:!0}),e.prototype.isCoolDown=function(){return 0==this.CDRUN},e.prototype.findTarget=function(){this.targets=this.config.skillTargetFind(this)},e.prototype.castPrepare=function(){this._castframeCount=0,this.CDRUN=this._frameCD,this.showSkillName(),this.caster.inSkillCasting=!0},e.prototype.showSkillName=function(){if(""!=this.config.name){var e=ColorDef.DodgerBlue,t=40;ToastInfoManager.newToast(this.config.name,e,this.caster.y-60,this.caster.x-GameRoot.GameStage.stageWidth/2,-50,0,2500,t,!0,egret.Ease.quadOut)}},e.prototype.isCD=function(){return 0==this.CDRUN},e.prototype.isEnd=function(){return this._castframeCount>this._endFrame},e.prototype.castingUpdate=function(){this._castframeCount in this.timeLine&&this.timeLine[this._castframeCount](this),this._castframeCount+=1},e.prototype.endCast=function(){this.caster.inSkillCasting=!1,this.caster.endSkillCast()},e.prototype.newCreation=function(e,t,n,r,i,a){void 0===n&&(n=null),void 0===i&&(i=null),void 0===a&&(a=null),this._creationManager.newCreation(e,t,n,r,i,a)},e.prototype.newBuff=function(e,t,n){this._buffManager.newBuff(e,t,n)},e}();window.L1Skill=n,__reflect(n.prototype,"L1Skill",[])},function(e,t){var n=function(){function e(e,t,n,r,i){this.name=e,this.cdMs=t,this.timeLine=n,this.skillTargetFind=r,this.descr=i}return e}();window.L1SkillConfig=n,__reflect(n.prototype,"L1SkillConfig",[])
},function(e,t){var n=function(){function e(){this._skillCastingList=new MySet,this._allSkillList=new MySet}return Object.defineProperty(e,"Ins",{get:function(){return SceneManager.Ins.curScene.skillManager},enumerable:!1,configurable:!0}),e.prototype.update=function(){for(var e=[],t=0,n=this._skillCastingList.data;t<n.length;t++){var r=n[t];r.castingUpdate(),r.isEnd()&&(r.endCast(),e.push(r))}for(var i=0,a=e;i<a.length;i++){var r=a[i];this._skillCastingList.remove(r)}for(var o=0,s=this._allSkillList.data;o<s.length;o++){var r=s[o];r.CDRUN=r.CDRUN-1}},e.prototype.castSkill=function(e){e.castPrepare(),e.findTarget(),this._skillCastingList.add(e)},e.prototype.castSkillBreak=function(e){e.endCast(),this._skillCastingList.remove(e)},e.prototype.newSkill=function(e,t){var n=new L1Skill;return n.initial(t,e),this._allSkillList.add(n),n},e}();window.L1SkillManager=n,__reflect(n.prototype,"L1SkillManager",[])},function(e,t){var n=function(){function e(){this._activateFrame=0}return e.prototype.initial=function(e,t,n){this.config=e;var r=GameRoot.GameStage.frameRate/1e3;this._periodFrame=Math.ceil(this.config.period*r),this._durationFrame=Math.ceil(this.config.duration*r),this._condPeriodFrame=Math.ceil(this.config.condCd*r),this._preCondAffectFrame=-this._condPeriodFrame,this.addToTarget(t),this._activateFrame=0,this.caster=n},e.prototype.addToTarget=function(e){this._target=e,e.buffs.add(this),this.config.buffType==L1BuffType.STATUS&&e.refreshBuffStatus(),this.config.buffType==L1BuffType.ATTRCHANGE&&e.refreshBuffAttr(),this.showBuffName()},e.prototype.showBuffName=function(){if(""!=this.config.name){var e=ColorDef.GhostWhite,t=25;ToastInfoManager.newToast(this.config.name,e,this._target.y-60,this._target.x-GameRoot.GameStage.stageWidth/2,-50,0,2500,t,!1,egret.Ease.quadOut)}},e.prototype.removeFromTarget=function(){var e=this._target;e.buffs.remove(this),this.config.buffType==L1BuffType.STATUS&&e.refreshBuffStatus(),this.config.buffType==L1BuffType.ATTRCHANGE&&e.refreshBuffAttr()},e.prototype.update=function(){this.config.buffType==L1BuffType.AFFECTPERIOD&&this._activateFrame%this._periodFrame==0&&this.config.isAffectDudge(this._target,this.caster)&&this.config.isAffectDudge(this._target,this.caster),this.config.buffType==L1BuffType.AFFECTCOND&&this._activateFrame-this._preCondAffectFrame>=this._condPeriodFrame&&this.config.isAffectDudge(this._target,this.caster)&&(this.config.isAffectDudge(this._target,this.caster),this._preCondAffectFrame=this._activateFrame),this._activateFrame+=1},e.prototype.isLifeEnd=function(){return 0==this._durationFrame?!1:this._activateFrame>this._durationFrame},e}();window.L1Buff=n,__reflect(n.prototype,"L1Buff",[])},function(e,t){var n=function(){function e(e,t,n,a,o,s,l,c,u,f,h,p,g,d){void 0===t&&(t="测试效果描述"),void 0===n&&(n=1e3),void 0===a&&(a=500),void 0===o&&(o=r.ATTRCHANGE),void 0===s&&(s=i.NORMAL),void 0===l&&(l=""),void 0===c&&(c={}),void 0===u&&(u={}),void 0===f&&(f=function(){}),void 0===h&&(h=function(){return!0}),void 0===p&&(p=!0),void 0===g&&(g=!0),void 0===d&&(d=1e3),this.id=e,this.descr=t,this.duration=n,this.period=a,this.buffType=o,this.status=s,this.name=l,this.attrAddAbs=c,this.attrAddRatio=u,this.affectFunc=f,this.isAffectDudge=h,this.canBeClear=p,this.isGood=g,this.condCd=d}return e}();window.L1BuffConfig=n,__reflect(n.prototype,"L1BuffConfig",[]);var r;!function(e){e[e.AFFECTPERIOD=0]="AFFECTPERIOD",e[e.AFFECTCOND=1]="AFFECTCOND",e[e.ATTRCHANGE=2]="ATTRCHANGE",e[e.STATUS=3]="STATUS"}(r||(r={})),window.L1BuffType=r;var i;!function(e){e[e.NORMAL=0]="NORMAL",e[e.DIZZ=1]="DIZZ",e[e.SLIENT=2]="SLIENT",e[e.L3=3]="L3",e[e.L4=4]="L4"}(i||(i={})),window.L1BuffStatus=i},function(e,t){var n=function(){function e(){this._deadBuffs=[],this._activateBuffs=new MySet}return Object.defineProperty(e,"Ins",{get:function(){return SceneManager.Ins.curScene.buffManager},enumerable:!1,configurable:!0}),e.prototype.update=function(){for(var e=[],t=0,n=this._activateBuffs.data;t<n.length;t++){var r=n[t];r.update(),r.isLifeEnd()&&(e.push(r),r.removeFromTarget())}for(var i=0,a=e;i<a.length;i++){var r=a[i];this._activateBuffs.remove(r),this._deadBuffs.push(r)}},e.prototype.newBuff=function(e,t,n){var r=null;r=0==this._deadBuffs.length?new L1Buff:this._deadBuffs.pop(),this._activateBuffs.add(r),r.initial(e,t,n)},e.prototype.removeBuff=function(e){e.removeFromTarget(),this._deadBuffs.push(e),this._activateBuffs.remove(e)},e}();window.L1BuffManager=n,__reflect(n.prototype,"L1BuffManager",[])},function(e,t){var n=function(){function e(){this._isFly=!0,this._isAffected=!1,this._toDestFrame=Number.MAX_VALUE,this._contentGroup=new eui.Group,this._circleShape=new egret.Shape,this._contentGroup.addChild(this._circleShape)}return Object.defineProperty(e.prototype,"x",{get:function(){return this._contentGroup.x},set:function(e){this._contentGroup.x=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._contentGroup.y},set:function(e){this._contentGroup.y=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pos",{get:function(){return[this.x,this.y]},set:function(e){this.x=e[0],this.y=e[1]},enumerable:!1,configurable:!0}),e.prototype.initial=function(e,t,n,r,i,a){void 0===n&&(n=null),void 0===i&&(i=null),void 0===a&&(a=null),LayerManager.Ins.gameLayer.addChild(this._contentGroup),this._caster=t,this._config=e,this._targetChar=n,this._posDest=i,this._directRad=a;var o=GameRoot.GameStage.frameRate/1e3;this._lifeDurationFrame=Math.ceil(this._config.lifeTime*o),this._affectPeriodFrame=Math.ceil(this._config.affectPeriod*o),this._flySpeedFrame=this._config.flySpeed*o,this._activateFrame=0,this._toDestFrame=Number.MAX_VALUE,Util.drawAngleCircle(this._circleShape,360,this._config.radius,0,this._config.color,this._config.alpha),this._circleShape.x=this._circleShape.y=0,this.x=r[0],this.y=r[1],this._isFly=!0,this._isAffected=!1,this._config.flyType==L1CrtnFlyType.FIX&&(this._isFly=!1)},e.prototype.update=function(){this._isFly&&(this._config.flyType==L1CrtnFlyType.CHAR&&this.flyTo(this._targetChar.pos),this._config.flyType==L1CrtnFlyType.POSITION&&this.flyTo(this._posDest),this._config.flyType==L1CrtnFlyType.DIRECT&&this.flyToRad(this._directRad));var e=!1;if(this._config.affectContType==L1CrTnAffectContType.CONTINUE&&this._activateFrame%this._affectPeriodFrame==0&&(e=!0),this._config.affectContType==L1CrTnAffectContType.ONECE&&(this._isFly||0!=this._isAffected||(e=!0)),e){var t=this.findAffectTarget();this._config.affectFunc(t,this._caster),this._isAffected=!0}this._activateFrame+=1},e.prototype.findAffectTarget=function(){var e=[];if(this._config.affectTargetSetType==L1CrTnAffectTargetSetType.PRESET)e.push(this._targetChar);else if(this._config.affectTargetSetType==L1CrTnAffectTargetSetType.RANGE){var t=this._caster.oppos;this._config.affectTargetCamp==L1CrtnAffectTargetCamp.SELF&&(t=this._caster.coops);for(var n=0,r=t;n<r.length;n++){var i=r[n];Util.pointDistance(i.pos,this.pos)<this._config.radius&&e.push(i)}}return e},e.prototype.flyTo=function(e){if(this.closeTo(this.pos,e))return this.pos=e,this._isFly=!1,void(this._toDestFrame=this._activateFrame);var t=Util.getRad(this.pos,e);this.flyToRad(t)},e.prototype.closeTo=function(e,t){return Util.pointDistance(e,t)<this._flySpeedFrame+20},e.prototype.flyToRad=function(e){this.x=Math.ceil(this.x+this._flySpeedFrame*Math.sin(e)),this.y=Math.ceil(this.y+this._flySpeedFrame*Math.cos(e))},e.prototype.lifeEnd=function(){LayerManager.Ins.gameLayer.removeChild(this._contentGroup),this._config=null},e.prototype.isLifeEnd=function(){var e=this._toDestFrame;return(this._config.flyType==L1CrtnFlyType.FIX||this._config.flyType==L1CrtnFlyType.DIRECT)&&(e=0),this._activateFrame>this._lifeDurationFrame+e+1},e}();window.L1Creation=n,__reflect(n.prototype,"L1Creation",[])},function(e,t){var n=function(){function e(e,t,n,s,l,c,u,f,h,p,g){void 0===e&&(e=10),void 0===t&&(t=r.FIX),void 0===n&&(n=i.ONECE),void 0===s&&(s=a.RANGE),void 0===l&&(l=o.OTHER),void 0===c&&(c=1e3),void 0===u&&(u=1e3),void 0===f&&(f=1e3),void 0===h&&(h=function(e,t){L1Harm.harm(t,e)}),void 0===p&&(p=.4),void 0===g&&(g=ColorDef.White),this.radius=10,this.flyType=r.FIX,this.affectContType=i.ONECE,this.affectTargetSetType=a.RANGE,this.affectTargetCamp=o.OTHER,this.flySpeed=1e3,this.lifeTime=1e3,this.affectPeriod=1e3,this.alpha=.4,this.radius=e,this.flySpeed=c,this.flyType=t,this.affectContType=n,this.affectTargetSetType=s,this.affectTargetCamp=l,this.lifeTime=u,this.affectPeriod=f,this.affectFunc=h,this.alpha=p,this.color=g}return e}();window.L1CreationConfig=n,__reflect(n.prototype,"L1CreationConfig",[]);var r;!function(e){e[e.FIX=0]="FIX",e[e.POSITION=1]="POSITION",e[e.DIRECT=2]="DIRECT",e[e.CHAR=3]="CHAR"}(r||(r={})),window.L1CrtnFlyType=r;var i;!function(e){e[e.CONTINUE=0]="CONTINUE",e[e.ONECE=1]="ONECE"}(i||(i={})),window.L1CrTnAffectContType=i;var a;!function(e){e[e.PRESET=0]="PRESET",e[e.RANGE=1]="RANGE"}(a||(a={})),window.L1CrTnAffectTargetSetType=a;var o;!function(e){e[e.SELF=0]="SELF",e[e.OTHER=1]="OTHER"}(o||(o={})),window.L1CrtnAffectTargetCamp=o},function(e,t){var n=function(){function e(){this._deadCreations=[],this._activateCreations=new MySet}return Object.defineProperty(e,"Ins",{get:function(){return SceneManager.Ins.curScene.creationManager},enumerable:!1,configurable:!0}),e.prototype.update=function(){for(var e=[],t=0,n=this._activateCreations.data;t<n.length;t++){var r=n[t];r.update(),r.isLifeEnd()&&(r.lifeEnd(),e.push(r))}for(var i=0,a=e;i<a.length;i++){var r=a[i];this._activateCreations.remove(r),this._deadCreations.push(r)}},e.prototype.newCreation=function(e,t,n,r,i,a){void 0===n&&(n=null),void 0===i&&(i=null),void 0===a&&(a=null);var o=null;o=this._deadCreations.length>0?this._deadCreations.pop():new L1Creation,o.initial(e,t,n,r,i,a),this._activateCreations.add(o)},e}();window.L1CreationManager=n,__reflect(n.prototype,"L1CreationManager",[])},function(e,t){var n=function(){function e(){}return e.harm=function(e,t,n){var r=new L1HarmConfig;n||(n=r);for(var i=0,a=t;i<a.length;i++){var o=a[i],s=n.harmFunc(e,o),l=s[0],c=s[1];o.curHp-=c,c>=0&&o.addAngerNumber(10),this.harmFloat(o,c,l)}},e.harmFloat=function(e,t,n){if(e.alive){var r="",i="miss",a=25,o=ColorDef.GhostWhite;if(t=Math.ceil(t),0!=t){a=n?30:25;var s=0>t;i=n?"暴击 ":s?"治疗 ":"",o=s?ColorDef.LimeGreen:n?ColorDef.DarkRed:ColorDef.GhostWhite,r=""+(s?"+":"")+-t}ToastInfoManager.newToast(""+i+r,o,e.y-40,e.x-GameRoot.GameStage.stageWidth/2,-50,0,2500,a,!1,egret.Ease.quadOut)}},e.isRandTrue=function(e){return 100*Math.random()<e},e}();window.L1Harm=n,__reflect(n.prototype,"L1Harm",[])},function(e,t){var n=function(){function e(e){e?this.harmFunc=e:this.harmFunc=function(e,t){var n=L1Harm.isRandTrue(e.critPoint),r=L1Harm.isRandTrue(t.DODGE),i=0;if(!r){var a=n?e.critTime:1;i=e.atk*e.atk/(t.def+e.atk)*a}return[n,i]}}return e}();window.L1HarmConfig=n,__reflect(n.prototype,"L1HarmConfig",[])},function(e,t){var n=function(){function e(e){this.params=e}return Object.defineProperty(e.prototype,"duration",{get:function(){return this.params.duration},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this.params.name},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"buffType",{get:function(){return this.params.buffType},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"attrNumAdd",{get:function(){return this.params.attrNumAdd},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"attrPercAdd",{get:function(){return this.params.attrPercAdd},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"enableDudgeFunc",{get:function(){return this.params.isEnableDudgeFunc},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"skillTriggerTime",{get:function(){return this.params.skillTriggerTime},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"skillTriggerDudgeFunc",{get:function(){return this.params.skillTriggerDudgeFunc},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"triggerSkillCfgId",{get:function(){return this.params.triggerSkillCfgId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"status",{get:function(){return this.params.status},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isShowInPanel",{get:function(){return this.params.isShowInPanel},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isDebuff",{get:function(){return this.params.isDebuff},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"description",{get:function(){return this.params.description},enumerable:!1,configurable:!0}),e}();window.L2BuffCfg=n,__reflect(n.prototype,"L2BuffCfg",[]);var r;!function(e){e[e.HpChange=0]="HpChange",e[e.BuffAdd=1]="BuffAdd",e[e.BuffRemove=2]="BuffRemove",e[e.AfterNormalAttak=3]="AfterNormalAttak",e[e.BeforeNormalAttak=4]="BeforeNormalAttak",e[e.AfterAction=5]="AfterAction",e[e.BeforeAction=6]="BeforeAction"}(r||(r={})),window.L2TriggerTimeType=r;var i;!function(e){e[e.Passive=0]="Passive",e[e.AttrChange=1]="AttrChange",e[e.Status=2]="Status"}(i||(i={})),window.L2BuffType=i;var a;!function(e){e[e.Dizz=0]="Dizz",e[e.Slient=1]="Slient"}(a||(a={})),window.L2BuffStatus=a},function(e,t){var n=function(){function e(e){this.params=e}return Object.defineProperty(e.prototype,"name",{get:function(){return this.params.name},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"imgName",{get:function(){return this.params.imgName},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"atk",{get:function(){return this.params.atk},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"normalAtkSkillId",{get:function(){return this.params.normalAtkSkillId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"def",{get:function(){return this.params.def},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxHp",{get:function(){return this.params.maxHp},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"startTime",{get:function(){return this.params.startTime},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"actionSpeed",{get:function(){return this.params.actionSpeed},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"moveRange",{get:function(){return this.params.moveRange},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"atkRange",{get:function(){return this.params.atkRange},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"harmIncrease",{get:function(){return this.params.harmIncrease},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"harmDecrease",{get:function(){return this.params.harmDecrease},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"injureIncrease",{get:function(){return this.params.injureIncrease},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"injureDecrease",{get:function(){return this.params.injureDecrease},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"skillIds",{get:function(){return this.params.skillIds},enumerable:!1,configurable:!0}),e}();window.L2CharCfg=n,__reflect(n.prototype,"L2CharCfg",[])},function(e,t){var n=function(){function e(e){this.params=e}return Object.defineProperty(e.prototype,"effectRange",{get:function(){return this.params.effectRange},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"castRange",{get:function(){return this.params.castRange},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this.params.name},enumerable:!1,configurable:!0}),e.prototype.castFunc=function(e,t,n){this.params.castFunc(e,t,this,n)},Object.defineProperty(e.prototype,"isNormalAtk",{get:function(){return this.params.isNormalAtk},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"description",{get:function(){return this.params.description},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"coolDown",{get:function(){return this.params.coolDown},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"energyUse",{get:function(){return this.params.energyUse},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"timeBack",{get:function(){return this.params.timeBack},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"targetSelectType",{get:function(){return this.params.targetSelectType},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canCastDudgeFunc",{get:function(){return this.params.canCastDudgeFunc},enumerable:!1,configurable:!0}),e.prototype.canCast=function(e){return this.canCastDudgeFunc?this.canCastDudgeFunc(e,this):[!0,null]},e}();window.L2SkillCfg=n,__reflect(n.prototype,"L2SkillCfg",[]);var r;!function(e){e[e.Cell=0]="Cell",e[e.AlliesCharWithSelf=1]="AlliesCharWithSelf",e[e.AlliesCharWithoutSelf=2]="AlliesCharWithoutSelf",e[e.Auto=3]="Auto",e[e.OpposeChar=4]="OpposeChar"}(r||(r={})),window.L2SkTgtSeltType=r},function(e,t){var n=function(){function e(){}return e.SkillCfg={0:new L2SkillCfg({name:"普通攻击",castFunc:function(e,t,n,r){var i=e.targets[0];t.to({x:i.x,y:i.y,scaleX:1.5,scaleY:1.5},250).call(function(){L2SkillManager.harm(e,i)}).to({x:e.Cell.x,y:e.Cell.y,scaleX:1,scaleY:1},250)},isNormalAtk:!0}),1:new L2SkillCfg({name:"测试技能-1",description:"对距离5以内最近的友方单位增加100的生命",castFunc:function(e,t,n){var r=e.findMinDisAllies(n.castRange);r.hpChange(100)},canCastDudgeFunc:function(e,t){var n=!0,r=e.findMinDisAllies(t.castRange),i=null;return null==r&&(n=!1,i="找不到合适的目标"),[n,i]},coolDown:3,energyUse:2,timeBack:30,castRange:5,targetSelectType:L2SkTgtSeltType.Auto}),3:new L2SkillCfg({name:"一个用来测试可以主动选择目标的技能",description:"选择一个范围5以内的敌方单位，给予一个每回合100伤害的Buff，持续两回合 测试占位。。。。。。。。。",castFunc:function(t,n,r,i){var a=i.targetChar,o=t.x;n.to({x:o+10},100).to({x:o-10},200).to({x:o},100),egret.Tween.get(a).to({alpha:.5},100).to({alpha:1},100);var s=SceneManager.Ins.curScene,l=s.buffManager.newBuff(e.BuffCfg[1],t);s.buffManager.attachBuff2Char(l,a)},castRange:5,targetSelectType:L2SkTgtSeltType.OpposeChar,effectRange:0}),5:new L2SkillCfg({name:"buff调用技能5",castFunc:function(e,t){e.hpChange(200);var n=e.x;t.to({x:n+10},100).to({x:n-10},200).to({x:n},100)}}),6:new L2SkillCfg({name:"buff调用技能6",castFunc:function(e,t){var n=e.x;t.to({x:n+10},100).to({x:n-10},200).to({x:n},100),e.hpChange(-100)}})},e.BuffCfg={0:new L2BuffCfg({duration:2,name:"测试BUFF",buffType:L2BuffType.Passive,isDebuff:!1,triggerSkillCfgId:5,description:"自动行动结束前，治疗自身200生命，持续两回合",skillTriggerTime:L2TriggerTimeType.BeforeAction,skillTriggerDudgeFunc:function(e){return SceneManager.Ins.curScene.timeManager.curChar==e.target?!0:!1}}),1:new L2BuffCfg({duration:2,name:"燃烧",isDebuff:!0,description:"自动行动结束时，造成100伤害，持续两回合",buffType:L2BuffType.Passive,triggerSkillCfgId:6,skillTriggerTime:L2TriggerTimeType.AfterAction,skillTriggerDudgeFunc:function(e){return SceneManager.Ins.curScene.timeManager.curChar==e.target?!0:!1}})},e.CharCfg={0:new L2CharCfg({name:"测试角色",imgName:"7_portrait_png",atk:100,def:20,maxHp:1e3,startTime:50,actionSpeed:0,moveRange:5,atkRange:2,normalAtkSkillId:0,skillIds:[1,3]})},e}();window.L2Config=n,__reflect(n.prototype,"L2Config",[])},function(e,t){var n=function(e){function t(t,n,r){var i=e.call(this)||this;return i.defaultColor=ColorDef.Tan,i.width=t,Util.drawSquar(i,t,i.defaultColor),i.touchEnabled=!0,i.rowX=n,i.colY=r,i.addEventListener(egret.TouchEvent.TOUCH_TAP,i.onTap,i),i}return __extends(t,e),t.prototype.changeColor=function(e){Util.drawSquar(this,this.width,e)},t.prototype.disTo=function(e){return Math.abs(e.colY-this.colY)+Math.abs(e.rowX-this.rowX)},t.prototype.rangeCells=function(e){return SceneManager.Ins.curScene.board.rangeCells(this,e)},t.prototype.getBetweenCells=function(){return SceneManager.Ins.curScene.board.getBetweenCells(this)},t.prototype.onSelect=function(){this.filters||L2Filters.addYellowGlow(this)},t.prototype.unSelect=function(){this.filters=null},t.prototype.onTap=function(){MessageManager.Ins.sendMessage(MessageType.L2CELLTAP,this),MessageManager.Ins.sendMessage(MessageType.L2USEENERGY,this)},t.prototype.release=function(){this["char"]=null},t}(egret.Shape);window.L2Cell=n,__reflect(n.prototype,"L2Cell",[])},function(e,t){var n=function(){function e(){var t=10,n=12;this.maxRowX=t-1,this.maxColY=n-1;var r=[],i=GameRoot.StageWidth/t;this.cellWidth=i;var a=i-e.cellDis;this.realCellWidth=a;for(var o=0;t>o;o++){for(var s=this.getCellX(o),l=[],c=0;n>c;c++){var u=this.getCellY(c),f=new L2Cell(a,o,c);l.push(f),LayerManager.Ins.gameLayer.addChild(f),f.x=s,f.y=u}r.push(l)}this.cells=r}return e.prototype.getCellX=function(e){return e*this.cellWidth},e.prototype.getCellY=function(t){return e.colStartDis+t*this.cellWidth},e.prototype.getBetweenCells=function(e){var t=e.rowX,n=e.colY,r=[];return 0!=t&&r.push(this.cells[t-1][n]),t!=this.maxRowX&&r.push(this.cells[t+1][n]),0!=n&&r.push(this.cells[t][n-1]),n!=this.maxColY&&r.push(this.cells[t][n+1]),r},e.prototype.rangeCells=function(e,t){var n=new MySet,r=new MySet,i=new MySet;for(r.add(e);r.data.length>0;){var a=r.data.pop();if(a.disTo(e)<=t){n.add(a);for(var o=0,s=this.getBetweenCells(a);o<s.length;o++){var l=s[o];!Util.contains(i.data,l)&&l.disTo(e)<=t&&r.add(l)}}i.add(a)}return n.data},e.prototype.resetCellsColor=function(){for(var e=0,t=this.cells;e<t.length;e++)for(var n=t[e],r=0,i=n;r<i.length;r++){var a=i[r];a.changeColor(ColorDef.Tan)}},e.prototype.release=function(){for(var e=0,t=this.cells;e<t.length;e++)for(var n=t[e],r=0,i=n;r<i.length;r++){var a=i[r];a.release()}},e.cellDis=3,e.colStartDis=200,e}();window.L2CellBoard=n,__reflect(n.prototype,"L2CellBoard",[])},function(e,t){var n=function(e){function t(n,i){var a=e.call(this)||this;a.nowTime=0,a.timePrior=100;var o=SceneManager.Ins.curScene,s=o.board.realCellWidth;a.config=n,a.rawAttr=new L2CharAttr(n),a.attr=new L2CharAttr(n),a.camp=i,a.alive=!0,a.hp=0,a.bgWidth=s,a.width=s,a.height=s;var l=new egret.Shape,c=i==r.Player?ColorDef.LimeGreen:ColorDef.DarkRed;Util.drawSquar(l,s,c),a.addChild(l),a.hpMask=new egret.Shape,l.mask=a.hpMask,a.addChild(a.hpMask),a.drawHpCircle(1);var u=s-2*t.hpBoardWidth,f=new eui.Image(n.imgName);f.width=1.6*u,f.height=f.width;var h=(f.width-u)/2;return f.mask=new egret.Rectangle(h,h,u,u),a.addChild(f),f.x=-h+t.hpBoardWidth,f.y=f.x,a.timeBarPort=new L2TimeBarPort(a),a.buffBar=new eui.Group,a.addChild(a.buffBar),a.buffs=new MySet,a.status=new MySet,a.addEventListener(egret.TouchEvent.TOUCH_TAP,a.onTap,a),a}return __extends(t,e),Object.defineProperty(t.prototype,"HP",{get:function(){return this.hp},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Cell",{get:function(){return this.cell},set:function(e){var t=null;null!=this.cell&&(t=this.cell),this.cell=e,null!=t&&(t["char"]=null),null!=e&&(e["char"]=this)},enumerable:!1,configurable:!0}),t.prototype.onSelect=function(){this.filters||L2Filters.addYellowGlow(this)},t.prototype.unSelect=function(){this.filters=null},t.prototype.placeToCell=function(){null!=this.cell&&(this.x=this.cell.x,this.y=this.cell.y)},t.prototype.hpChange=function(e){if(this.alive){e=Math.ceil(e);var t=e+this.hp;return t=Util.clamp(t,0,this.attr.maxHp),this.harmFloat(this.hp-t),this.hp=t,this.drawHpCircle(this.hp/this.attr.maxHp),0!=this.hp&&0>e&&egret.Tween.get(this).to({rotation:-15},60).to({rotation:15},120).to({rotation:0},60),0==this.hp&&(this.alive=!1,this.Cell=null,Util.safeRemoveFromParent(this.timeBarPort),Util.safeRemoveFromParent(this)),this.hp}},t.prototype.hpChangeTo=function(e){var t=e-this.hp;this.hpChange(t)},Object.defineProperty(t.prototype,"NowTime",{get:function(){return this.nowTime},enumerable:!1,configurable:!0}),t.prototype.onTap=function(){MessageManager.Ins.sendMessage(MessageType.L2CHARTAP,this)},t.prototype.setTime=function(e){this.nowTime=e,this.timeBarPort.setTime(e)},t.prototype.highLight=function(){egret.Tween.get(this).to({alpha:.2},250).to({alpha:1},250)},t.prototype.drawCircle=function(e,t,n){var r=-90;t-=90,Util.drawAngleCircle(e,t,n,r)},t.prototype.drawHpCircle=function(e){this.hpMask.x=0,this.hpMask.y=0,this.drawCircle(this.hpMask,360*e,this.bgWidth),this.hpMask.x=this.bgWidth/2,this.hpMask.y=this.bgWidth/2},t.prototype.startAction=function(){var e=this,t=egret.Tween.get(this),n=this.findMinDisOppose();this.targets=[n];var r=SceneManager.Ins.curScene;if(this.isInAtkRange(n))this.normalAtk();else{var i=this.allMovableCells();i.sort(function(t,r){var i=t.disTo(n.cell)-r.disTo(n.cell);return 0==i&&(i=t.disTo(e.cell)-r.disTo(e.cell)),i});var a=i[0];r.isCharMoveEnd=!1,this.moveTo(a,t),t.call(function(){r.isCharMoveEnd=!0,e.isInAtkRange(n)&&e.normalAtk()})}},t.prototype.moveTo=function(e,t){this.Cell=e,t.to({x:e.x,y:e.y},800)},t.prototype.debugNAndP=function(){return this.config.name+" - "+(this.cell.rowX+1)+","+(this.cell.colY+1)},t.prototype.findMinDisOppose=function(){var e=this,t=SceneManager.Ins.curScene,n=this.camp==r.Player?t.enemies:t.players;return n=n.filter(function(e){return 1==e.alive}),n.sort(function(t,n){var r=e.disToChar(t)-e.disToChar(n);return 0!=r?r:t.hp-n.hp}),n[0]},t.prototype.isInAtkRange=function(e){return this.isCellInAtkRange(e.cell)},t.prototype.normalAtk=function(){var e=SceneManager.Ins.curScene;e.skillManager.pushSkill(L2Config.SkillCfg[this.config.normalAtkSkillId],this)},t.prototype.isDizz=function(){return this.status.has(L2BuffStatus.Dizz)},t.prototype.isSlient=function(){return this.status.has(L2BuffStatus.Slient)},t.prototype.refreshBuffAttr=function(){for(var e=[],t=0,n=this.buffs.data;t<n.length;t++){var r=n[t];r.enable&&r.config.buffType==L2BuffType.AttrChange&&e.push(r)}var i={},a={};for(var o in L2AttrNames)i[o]=0,a[o]=0;for(var s=0,l=e;s<l.length;s++){var r=l[s];for(var o in L2AttrNames)o in r.config.attrNumAdd&&(i[o]+=r.config.attrNumAdd[o]),o in r.config.attrPercAdd&&(a[o]+=r.config.attrPercAdd[o])}for(var o in L2AttrNames){var c=this.rawAttr[o]*(1+a[o])+i[o];if(o==L2AttrNames.maxHp){var u=c-this.attr.maxHp;u+this.hp<=0&&(u=1-this.hp),this.hpChange(u)}this.attr[o]=c}},t.prototype.refreshBuffStatus=function(){this.buffs.removeAll();for(var e=[],t=0,n=this.buffs.data;t<n.length;t++){var r=n[t];r.enable&&r.config.buffType==L2BuffType.Status&&e.push(r.config.status)}for(var i=0,a=e;i<a.length;i++){var o=a[i];this.status.add(o)}},t.prototype.isCellInAtkRange=function(e){var t=e.disTo(this.cell);return t<=this.attr.atkRange?!0:!1},t.prototype.allMovableCells=function(){for(var e=this.cell.rangeCells(this.attr.moveRange),t=[],n=0,r=e;n<r.length;n++){var i=r[n];i!=this.cell&&null==i["char"]&&t.push(i)}return t},t.prototype.disToChar=function(e){return this.disToCell(e.cell)},t.prototype.disToCell=function(e){return null==this.cell||null==e?-1:this.cell.disTo(e)},t.prototype.harmFloat=function(e){if(this.alive){var t="",n=25,r=0;e=Math.ceil(e);var i=0>=e;r=i?ColorDef.LimeGreen:ColorDef.Red,t=""+(i?"+":"")+-e,ToastInfoManager.newToast(t,r,this.y+this.width/2,this.x-GameRoot.GameStage.stageWidth/2+this.width/2,-50,0,2500,n,!1,egret.Ease.quadOut)}},t.prototype.endAction=function(){var e=SceneManager.Ins.curScene;MessageManager.Ins.sendMessage(MessageType.L2BuffTriggerTime,[L2TriggerTimeType.AfterAction]);for(var t=new(Array.bind.apply(Array,__spreadArrays([void 0],this.buffs.data))),n=0,r=t;n<r.length;n++){var i=r[n];e.buffManager.changeBuffDuration(i,-1)}},t.prototype.findMinDisAllies=function(e){for(var t=SceneManager.Ins.curScene,n=this.camp==r.Player?t.players:t.enemies,i=1e3,a=null,o=0,s=n;o<s.length;o++){var l=s[o];if(l!=this&&l.alive){var c=l.disToChar(this);i>c&&e>=c&&(a=l,i=c)}}return a},t.prototype.refreshBuffIcon=function(){this.buffBar.removeChildren();for(var e in this.buffs.data){var t=this.buffs.data[e],n=new egret.Shape,r=t.config.isDebuff?ColorDef.Red:ColorDef.LimeGreen;Util.drawSquar(n,10,r),this.buffBar.addChild(n),n.x=2+12*parseInt(e),n.y=2}},t.prototype.release=function(){this.timeBarPort.release(),this.timeBarPort=null,this.hpMask=null,this.cell=null,this.status=null,this.config=null,this.buffs.removeAll(),this.buffs=null,this.buffBar=null},t.hpBoardWidth=3,t}(eui.Group);window.L2Char=n,__reflect(n.prototype,"L2Char",[]);var r;!function(e){e[e.Enemy=1]="Enemy",e[e.Player=-1]="Player"}(r||(r={})),window.L2Camp=r},function(e,t){var n=function(){function e(e){for(var t in L2AttrNames)this[t]=e[t]?e[t]:0}return e}();window.L2CharAttr=n,__reflect(n.prototype,"L2CharAttr",[])},function(e,t){var n;!function(e){e.atk="atk",e.def="def",e.maxHp="maxHp",e.startTime="startTime",e.actionSpeed="atrionSpeed",e.moveRange="moveRange",e.atkRange="atkRange",e.harmIncrease="harmIncrease",e.harmDecrease="harmDecrease",e.injureIncrease="injureIncrease",e.injureDecrease="injureDecrease"}(n||(n={})),window.L2AttrNames=n},function(e,t){var n=function(){function e(){this.energyNum=0}return e.prototype.useEnergy=function(e){return this.energyNum<e?void console.error("使用的能量超过上限"):(this.energyNum-=e,void SceneManager.Ins.curScene.mainUI.removeFires(e))},e.prototype.addEnergy=function(t){this.energyNum+=t;var n=0;this.energyNum>10&&(n=this.energyNum-e.MaxEnergy,this.energyNum=10);var r=SceneManager.Ins.curScene;r.mainUI.addFires(t-n)},e.prototype.removeEnergy=function(e){this.energyNum-=e;var t=0;this.energyNum<0&&(t=this.energyNum,this.energyNum=10),SceneManager.Ins.curScene.mainUI.removeFires(e-t)},e.MaxEnergy=10,e}();window.L2EnergyManager=n,__reflect(n.prototype,"L2EnergyManager",[])},function(e,t){var n=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._resLoad=new ResAsyncLoader,t.energyNum=0,t.isPause=!1,t.isCharMoveEnd=!0,t}return __extends(t,e),t.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this._resLoad.loadGroup("portrait",0,LayerManager.Ins.loadingUI)];case 1:return e.sent(),[2]}})})},t.prototype.initial=function(){this.board=new L2CellBoard,this.players=[],this.enemies=[];for(var e=1;6>e;e++){var t=new L2Char(L2Config.CharCfg[0],1-e%2*2);t.hpChangeTo(t.attr.maxHp),t.camp==L2Camp.Player?this.players.push(t):this.enemies.push(t)}for(var n=1,r=0,i=this.enemies.concat(this.players);r<i.length;r++){var a=i[r];LayerManager.Ins.gameLayer.addChild(a),a.Cell=this.board.cells[n][n],a.placeToCell(),n+=1}this.mainUI=new L2MainUI,LayerManager.Ins.uiLayer.addChild(this.mainUI),this.timeManager=new L2TimeManager,this.energyManager=new L2EnergyManager,this.status=new L2NormalSceneStatus,this.status.initial(),this.skillManager=new L2SkillManager,this.buffManager=new L2BuffManager,this.buffManager.initial();var o=this.buffManager.newBuff(L2Config.BuffCfg[0],null);this.buffManager.attachBuff2Char(o,this.enemies[0]),MessageManager.Ins.addEventListener(MessageType.L2CELLTAP,this.cellTap,this),MessageManager.Ins.addEventListener(MessageType.L2CHARTAP,this.charTap,this),MessageManager.Ins.addEventListener(MessageType.L2TIMEPORTTAP,this.timePortTap,this)},t.prototype.update=function(){if(!this.isPause&&this.isCharMoveEnd&&!this.skillManager.IsInSkillProcess){null!=this.timeManager.curChar&&this.timeManager.afterCharNormalAction();var e=this.timeManager.toNextChar();MessageManager.Ins.sendMessage(MessageType.L2BuffTriggerTime,[L2TriggerTimeType.BeforeAction]),e.startAction()}},Object.defineProperty(t.prototype,"FocusChar",{get:function(){if(null==this.focusChar)for(var e=0,t=this.players;e<t.length;e++){var n=t[e];if(n.alive){this.focusChar=n;break}}return this.focusChar},set:function(e){this.focusChar=e},enumerable:!1,configurable:!0}),t.prototype.charTap=function(e){var t=e.messageContent;this.status.charTap(t)},t.prototype.timePortTap=function(e){var t=e.messageContent;this.status.timePortTap(t)},t.prototype.cellTap=function(e){if(this.isCharMoveEnd&&!this.skillManager.IsInSkillProcess){var t=e.messageContent;this.status.cellTap(t)}},t.prototype.release=function(){for(var e=0,t=this.players.concat(this.enemies);e<t.length;e++){var n=t[e];n.release()}this.players=null,this.enemies=null,this.timeManager.release(),this.timeManager=null,this.mainUI.release(),this.mainUI=null,this.board.release(),this.board=null,this.skillManager.release(),this.skillManager=null,this.buffManager.release(),this.buffManager=null
},t.prototype.releaseResource=function(){this._resLoad.releaseResource()},t.cellDis=2,t.colStartDis=200,t}(IScene);window.L2MainScene=n,__reflect(n.prototype,"L2MainScene",[])},function(e,t){var n=function(){function e(){this.globalTime=0,this.roundNum=1}return e.prototype.getAliveChars=function(){for(var e=SceneManager.Ins.curScene,t=[],n=0,r=e.enemies.concat(e.players);n<r.length;n++){var i=r[n];i.alive&&t.push(i)}return t},e.prototype.toNextChar=function(){for(var e=this.getAliveChars(),t=e.sort(function(e,t){return e.NowTime-t.NowTime}),n=t[0].NowTime,r=[],i=0,a=t;i<a.length;i++){var o=a[i];if(o.NowTime!=n)break;r.push(o)}var s=r.sort(function(e,t){return e.timePrior-t.timePrior}),l=s[0],c=l.NowTime;l.setTime(0);for(var u=0,f=t;u<f.length;u++){var o=f[u];o!=l&&o.setTime(o.NowTime-c)}this.globalTime+=c;var h=SceneManager.Ins.curScene;return h.mainUI.timePointLabel.text=""+this.globalTime,this.curChar=l,l},e.prototype.afterCharNormalAction=function(){var t=this.curChar;if(null==t)return void console.error("不应该出现这种情况");t.endAction();var n=t.attr.actionSpeed,r=e.SpeedM,i=e.defBackTime;t.setTime(Math.ceil(i*(.5+.5*n/(n+r))));for(var a=this.getAliveChars(),o=100,s=0,l=a;s<l.length;s++){var c=l[s];t.NowTime==c.NowTime&&c.timePrior>=o&&(o=t.timePrior+1)}t.timePrior=o,t.timeBarPort.moveToTop(),this.curChar=null,this.roundAdd()},e.prototype.charAddTime=function(e,t,n){void 0===n&&(n=-1)},e.prototype.roundAdd=function(){this.roundNum+=1,this.roundNum%3==0&&SceneManager.Ins.curScene.energyManager.addEnergy(1),SceneManager.Ins.curScene.mainUI.roundLabel.text=""+this.roundNum},e.prototype.release=function(){this.curChar=null},e.SpeedM=100,e.defBackTime=50,e}();window.L2TimeManager=n,__reflect(n.prototype,"L2TimeManager",[])},function(e,t){var n=function(){function e(){}return e.prototype.initial=function(e){void 0===e&&(e=null)},e.prototype.changeTo=function(e,t){void 0===t&&(t=null);var n=SceneManager.Ins.curScene;n.status=e,e.initial(t),this.release()},e.prototype.charTap=function(e){},e.prototype.timePortTap=function(e){SceneManager.Ins.curScene;e["char"].highLight()},e.prototype.disConfirmButtonTap=function(){},e.prototype.confirmButtonTap=function(){},e.prototype.skill1ButtonTap=function(){},e.prototype.skill2ButtonTap=function(){},e.prototype.cellTap=function(e){},e.prototype.commandButtonTap=function(){SceneManager.Ins.curScene;this.changeTo(new L2CmdModSceneStatus)},e.prototype.back=function(){SceneManager.Ins.setScene(new MainScene)},e.prototype.moveButtonTap=function(){},e.prototype.release=function(){},e}();window.IL2MainSceneStatus=n,__reflect(n.prototype,"IL2MainSceneStatus",[])},function(e,t){var n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.initial=function(){var e=SceneManager.Ins.curScene,t=e.mainUI,n=e.FocusChar;e.board.resetCellsColor(),t.selectBarGroup.visible=!1,t.commandButton.visible=!1,t.showInfoImage.visible=!0;var r=n.camp==L2Camp.Player;t.skill1Button.visible=r,t.skill2Button.visible=r,t.moveButton.visible=!1,t.confirmButton.visible=!1,t.disConfirmButton.visible=!1,t.commandModeLabel.visible=!0,t.skillInfoLabel.visible=!1,e.isPause=!0,t.showInfoImage.source=""+n.config.imgName;var i=n.allMovableCells();this.moveableCells=i;for(var a=n.camp==L2Camp.Player?ColorDef.LimeGreen:ColorDef.Orange,o=0,s=i;o<s.length;o++){var l=s[o];l.changeColor(a)}},t.prototype.charTap=function(e){var t=SceneManager.Ins.curScene;t.FocusChar=e,this.initial()},t.prototype.cellTap=function(e){var t=SceneManager.Ins.curScene;if(Util.contains(this.moveableCells,e)||this.back(),Util.contains(this.moveableCells,e)&&t.FocusChar.camp==L2Camp.Player){if(t.energyManager.energyNum<1)return void ToastInfoManager.newRedToast("移动所需能量不足");this.changeTo(new L2MoveSelectSceneStatus,[[e,this.moveableCells]]),this.moveableCells=null}},t.prototype.back=function(){ToastInfoManager.newRedToast("退出指令模式，战斗恢复"),this.changeTo(new L2NormalSceneStatus)},t.prototype.skill1ButtonTap=function(){this.changeToSkillSelect(0)},t.prototype.skill2ButtonTap=function(){this.changeToSkillSelect(1)},t.prototype.changeToSkillSelect=function(e){this.changeTo(new L2SkillSelectStatus,[e])},t}(IL2MainSceneStatus);window.L2CharSelectSceneStatus=n,__reflect(n.prototype,"L2CharSelectSceneStatus",[])},function(e,t){var n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.initial=function(){var e=SceneManager.Ins.curScene,t=e.mainUI;e.board.resetCellsColor(),t.selectBarGroup.visible=!1,t.commandButton.visible=!1,t.showInfoImage.visible=!1,t.skill1Button.visible=!1,t.skill2Button.visible=!1,t.moveButton.visible=!1,t.confirmButton.visible=!1,t.disConfirmButton.visible=!1,t.commandModeLabel.visible=!0,t.skillInfoLabel.visible=!1,e.isPause=!0},t.prototype.charTap=function(e){var t=SceneManager.Ins.curScene;t.FocusChar=e,this.changeTo(new L2CharSelectSceneStatus)},t.prototype.cellTap=function(){this.back()},t.prototype.back=function(){ToastInfoManager.newRedToast("退出指令模式，战斗恢复"),this.changeTo(new L2NormalSceneStatus)},t}(IL2MainSceneStatus);window.L2CmdModSceneStatus=n,__reflect(n.prototype,"L2CmdModSceneStatus",[])},function(e,t){var n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.initial=function(e){var t=e[0],n=SceneManager.Ins.curScene,r=n.mainUI,i=n.FocusChar;this.tapCell=t[0],r.selectBarGroup.visible=!1,r.commandButton.visible=!1,r.showInfoImage.visible=!1,r.skill1Button.visible=!1,r.skill2Button.visible=!1,r.confirmButton.visible=!1,r.disConfirmButton.visible=!1,r.moveButton.visible=!0,r.commandModeLabel.visible=!1,r.skillInfoLabel.visible=!1,n.isPause=!0,this.moveableCells=t[1],i.x=t[0].x,i.y=t[0].y,i.highLight()},t.prototype.cellTap=function(e){Util.contains(this.moveableCells,e)?this.initial([[e,this.moveableCells]]):this.back()},t.prototype.back=function(){var e=SceneManager.Ins.curScene,t=e.FocusChar;t.x=t.Cell.x,t.y=t.Cell.y,this.moveableCells=null,this.changeTo(new L2CharSelectSceneStatus)},t.prototype.moveButtonTap=function(){var e=SceneManager.Ins.curScene;e.energyManager.useEnergy(1),e.FocusChar.Cell=this.tapCell,this.moveableCells=null,this.tapCell=null,this.changeTo(new L2CharSelectSceneStatus)},t}(IL2MainSceneStatus);window.L2MoveSelectSceneStatus=n,__reflect(n.prototype,"L2MoveSelectSceneStatus",[])},function(e,t){var n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.initial=function(){var e=SceneManager.Ins.curScene,t=e.mainUI;e.board.resetCellsColor(),t.selectBarGroup.visible=!1,t.commandButton.visible=!0,t.showInfoImage.visible=!1,t.moveButton.visible=!1,t.skill1Button.visible=!1,t.skill2Button.visible=!1,t.confirmButton.visible=!1,t.disConfirmButton.visible=!1,t.commandModeLabel.visible=!1,t.skillInfoLabel.visible=!1,e.isPause=!1},t.prototype.charTap=function(e){var t=SceneManager.Ins.curScene;t.FocusChar=e,this.changeTo(new L2CharSelectSceneStatus)},t}(IL2MainSceneStatus);window.L2NormalSceneStatus=n,__reflect(n.prototype,"L2NormalSceneStatus",[])},function(e,t){var n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.initial=function(e){var t=SceneManager.Ins.curScene,n=t.mainUI,r=t.FocusChar,i=e[0];this.skillOrder=i;var a=L2Config.SkillCfg[r.config.skillIds[i]];this.skillCfg=a,this.isSelectOver=!1,t.board.resetCellsColor(),n.selectBarGroup.visible=!1,n.commandButton.visible=!1,n.showInfoImage.visible=!1,n.moveButton.visible=!1,n.skill1Button.visible=!1,n.skill2Button.visible=!1,n.confirmButton.visible=!0,n.disConfirmButton.visible=!0,n.commandModeLabel.visible=!1,n.skillInfoLabel.visible=!0,t.isPause=!0,n.skillInfoLabel.text=a.description;for(var o=r.Cell.rangeCells(a.castRange),s=0,l=o;s<l.length;s++){var c=l[s];c.changeColor(ColorDef.Orange)}if(a.targetSelectType==L2SkTgtSeltType.Auto)return void(this.isSelectOver=!0);if(a.targetSelectType==L2SkTgtSeltType.AlliesCharWithoutSelf||a.targetSelectType==L2SkTgtSeltType.AlliesCharWithSelf||a.targetSelectType==L2SkTgtSeltType.OpposeChar){var u=r.camp==L2Camp.Player?t.players:t.enemies,f=r.camp==L2Camp.Player?t.enemies:t.players;switch(this.canSelectCharTargets=[],a.targetSelectType){case L2SkTgtSeltType.AlliesCharWithoutSelf:for(var h=0,p=u;h<p.length;h++){var g=p[h];g!=r&&r.disToChar(g)<=a.castRange&&this.canSelectCharTargets.push(g)}break;case L2SkTgtSeltType.AlliesCharWithSelf:for(var d=0,y=u;d<y.length;d++){var g=y[d];r.disToChar(g)<=a.castRange&&this.canSelectCharTargets.push(g)}break;case L2SkTgtSeltType.OpposeChar:for(var m=0,v=f;m<v.length;m++){var T=v[m];r.disToChar(T)<=a.castRange&&this.canSelectCharTargets.push(T)}}}a.targetSelectType==L2SkTgtSeltType.Cell&&(this.canSelectCellTargets=o)},t.prototype.charTap=function(e){return this.skillCfg.targetSelectType==L2SkTgtSeltType.AlliesCharWithoutSelf||this.skillCfg.targetSelectType==L2SkTgtSeltType.AlliesCharWithSelf||this.skillCfg.targetSelectType==L2SkTgtSeltType.OpposeChar||this.skillCfg.targetSelectType==L2SkTgtSeltType.Cell?this.skillCfg.targetSelectType==L2SkTgtSeltType.Cell?void(Util.contains(this.canSelectCellTargets,e.Cell)&&(this.selectCellTarget&&this.selectCellTarget.unSelect(),this.selectCellTarget=e.Cell,this.selectCellTarget.onSelect(),this.refreshEffectCells(e.Cell),this.isSelectOver=!0)):Util.contains(this.canSelectCharTargets,e)?(this.selectCharTarget&&this.selectCharTarget.unSelect(),this.selectCharTarget=e,e.onSelect(),this.refreshEffectCells(e.Cell),void(this.isSelectOver=!0)):void 0:void 0},t.prototype.refreshEffectCells=function(e){if(this.effectCells)for(var t=0,n=this.effectCells;t<n.length;t++){var r=n[t];r.unSelect()}this.effectCells=e.rangeCells(this.skillCfg.effectRange);for(var i=0,a=this.effectCells;i<a.length;i++){var r=a[i];r.onSelect()}},t.prototype.disConfirmButtonTap=function(){this.back()},t.prototype.cellTap=function(e){this.skillCfg.targetSelectType==L2SkTgtSeltType.Cell&&Util.contains(this.canSelectCellTargets,e)&&(this.selectCellTarget&&this.selectCellTarget.unSelect(),e.onSelect(),this.refreshEffectCells(e),this.selectCellTarget=e,this.isSelectOver=!0)},t.prototype.confirmButtonTap=function(){if(!this.isSelectOver)return void ToastInfoManager.newRedToast("请选择目标后再释放");var e=SceneManager.Ins.curScene,t=e.FocusChar,n=L2Config.SkillCfg[t.config.skillIds[this.skillOrder]],r=n.canCast(t);return r[0]?(e.skillManager.pushSkill(L2Config.SkillCfg[t.config.skillIds[this.skillOrder]],t,{targetChar:this.selectCharTarget,targetCell:this.selectCellTarget}),void this.changeTo(new L2CmdModSceneStatus)):void ToastInfoManager.newRedToast(r[1])},t.prototype.changeTo=function(t,n){if(void 0===n&&(n=null),this.effectCells)for(var r=0,i=this.effectCells;r<i.length;r++){var a=i[r];a.unSelect()}this.selectCellTarget&&this.selectCellTarget.unSelect(),this.selectCharTarget&&this.selectCharTarget.unSelect(),e.prototype.changeTo.call(this,t,n)},t.prototype.back=function(){this.changeTo(new L2CharSelectSceneStatus)},t.prototype.release=function(){this.selectCharTarget=null,this.selectCellTarget=null,this.canSelectCharTargets=null,this.canSelectCellTargets=null,this.effectCells=null,this.skillCfg=null},t}(IL2MainSceneStatus);window.L2SkillSelectStatus=n,__reflect(n.prototype,"L2SkillSelectStatus",[])},function(e,t){var n=function(){function e(){}return e.prototype.initial=function(e,t){this.config=e,this.caster=t,this.duration=e.duration,this.children=[]},e.prototype.attach2Char=function(e){this.target=e,e.buffs.add(this),this.config.buffType==L2BuffType.AttrChange&&e.refreshBuffAttr(),this.config.buffType==L2BuffType.Status&&e.refreshBuffStatus()},Object.defineProperty(e.prototype,"enable",{get:function(){return this.config.enableDudgeFunc?this.config.enableDudgeFunc(this):!0},enumerable:!1,configurable:!0}),e.prototype.removeFromTarget=function(){var e=this.target;e.buffs.remove(this);for(var t=0,n=this.children;t<n.length;t++){var r=n[t];r.removeFromTarget()}this.config.buffType==L2BuffType.Status&&e.refreshBuffStatus(),this.config.buffType==L2BuffType.AttrChange&&e.refreshBuffAttr(),e.refreshBuffIcon()},e.prototype.showBuffName=function(){if(""!=this.config.name){var e=ColorDef.White,t=30;ToastInfoManager.newToast(this.config.name,e,this.target.y-15,this.target.x-GameRoot.GameStage.stageWidth/2+this.target.width/2,-50,0,2e3,t,!0,egret.Ease.quadOut)}},e.prototype.release=function(){this.children=null,this.target=null,this.caster=null,this.config=null},e}();window.L2Buff=n,__reflect(n.prototype,"L2Buff",[])},function(e,t){var n=function(){function e(){}return e.prototype.initial=function(){this.buffPool=[],this.buffs=[],MessageManager.Ins.addEventListener(MessageType.L2BuffTriggerTime,this.buffTrigger,this)},e.prototype.newBuff=function(e,t){var n=this.buffPool.length>0?this.buffPool.pop():new L2Buff;return n.initial(e,t),this.buffs.push(n),n},e.prototype.attachBuff2Char=function(e,t){e.attach2Char(t),t.refreshBuffIcon(),e.showBuffName()},e.prototype.changeBuffDuration=function(e,t){0!=e.duration&&(e.duration+=t,e.duration<=0&&(e.removeFromTarget(),Util.removeObjFromArray(this.buffs,e),e.release(),this.buffPool.push(e)))},e.prototype.buffTrigger=function(e){for(var t=e.messageContent[0],n=0,r=this.buffs;n<r.length;n++){var i=r[n];i.enable&&i.config.buffType==L2BuffType.Passive&&i.config.skillTriggerTime==t&&i.config.skillTriggerDudgeFunc(i,e.messageContent)&&SceneManager.Ins.curScene.skillManager.pushSkill(L2Config.SkillCfg[i.config.triggerSkillCfgId],i.target)}},e.prototype.release=function(){this.buffPool=null;for(var e=0,t=this.buffs;e<t.length;e++){var n=t[e];n.release()}this.buffs=null},e}();window.L2BuffManager=n,__reflect(n.prototype,"L2BuffManager",[])},function(e,t){var n=function(){function e(){this.waitingSkillList=[],this.isInSkillProcess=!1}return Object.defineProperty(e.prototype,"IsInSkillProcess",{get:function(){return this.isInSkillProcess},enumerable:!1,configurable:!0}),e.prototype.pushSkill=function(e,t,n){if(void 0===n&&(n=null),this.waitingSkillList.push([e,t,n]),!this.isInSkillProcess){var r=this.waitingSkillList.shift();this.castSkill(r[0],r[1],r[2])}},e.prototype.castSkill=function(e,t,n){var r=this;this.isInSkillProcess=!0;var i=egret.Tween.get(t);e.castFunc(t,i,n),i.call(function(){if(0==r.waitingSkillList.length)r.isInSkillProcess=!1;else{var e=r.waitingSkillList.shift();r.castSkill(e[0],e[1],e[2])}})},e.prototype.release=function(){this.waitingSkillList=null},e.harm=function(e,t,n){void 0===n&&(n=1),t.hpChange(-(e.attr.atk-t.attr.def)*n*(1+e.attr.harmIncrease-e.attr.harmDecrease+t.attr.injureIncrease-t.attr.injureDecrease))},e}();window.L2SkillManager=n,__reflect(n.prototype,"L2SkillManager",[])}]);